---
title: "REFMAP listening test 1 analysis: Generalised estimating equations for annoyance and noticeability"
output: html_document
date: "2024-06-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

Load packages

```{r}
library(conflicted)
library(MASS)
library(geepack)
library(geefirth)
library(glmtoolbox)
library(lme4)
library(tidyverse)
library(openxlsx)
library(ggeffects)
library(stats)
library(easystats)
library(viridis)
library(ggnewscale)
library(tictoc)
library(cowplot)
library(patchwork)
library(microbenchmark)
# set package parameters
theme_set(theme_bw())

glmcontrol <- lme4::glmerControl(optimizer = 'bobyqa',
                                optCtrl = list(maxfun = 1e6))

```

Set parameters

```{r}

# plot colour scheme

mycolourlist = list(c(0, 102, 255), c(0, 204, 153), c(255, 0, 102), c(74, 111, 152), c(251, 164, 49), c(204, 153, 255), c(90, 192, 255), c(80, 245, 233), c(255, 90, 192), c(164, 201, 242), c(255, 254, 139), c(255, 243, 255))
mycolours = matrix()

for (ii in 1:length(mycolourlist)){
  mycolours[ii] = rgb(mycolourlist[[ii]][1]/255,
                      mycolourlist[[ii]][2]/255,
                      mycolourlist[[ii]][3]/255)
}

# toggle to save plots
saveplots = TRUE

if (saveplots){
  # set output plot directory
  choose.files(caption="Just cancel this", filters=matrix(data=c(" ", " "), ncol=2))  # workaround for bug in RTerm choose.dir
  outFigPath <- utils::choose.dir(caption="Select output folder to save plots")
  
  if (!dir.exists(file.path(outFigPath, "svg"))){dir.create(file.path(outFigPath, "svg"))}
  if (!dir.exists(file.path(outFigPath, "pdf"))){dir.create(file.path(outFigPath, "pdf"))}
  
}

# toggle to save data
savedata = TRUE

if (savedata){
  # set output plot directory
  if (saveplots==FALSE){
    choose.files(caption="Just cancel this", filters=matrix(data=c(" ", " "), ncol=2))  # workaround for bug in RTerm choose.dir
  }
  outDataPath <- utils::choose.dir(caption="Select output folder to save data")
}

set.seed(5419498)


```

# Functions

## GEE Rsquared (Zheng, 2000)

```{r}

geeRsquared <- function(...){
  
  if (length(list(...)) == 1){
      
      model_objects <- insight::ellipsis_info(..., ..., only_models = TRUE)
      model_objects <- model_objects[1]

  } else{

      model_objects <- insight::ellipsis_info(..., only_models = TRUE)
  
  }
  
  # ensure proper object names
  dot_names <- sapply(match.call(expand.dots = FALSE)[["..."]], as.character)
  check_object_names <- insight::compact_character(names(model_objects))
  if ((is.null(check_object_names) ||
    # or if length of names doesn't match number of models
    length(check_object_names) != length(model_objects) ||
    # or if names are "..1", "..2" pattern
    all(grepl("\\.\\.\\d", check_object_names))) &&
    # and length of dot-names must match length of objects
    length(model_objects) == length(dot_names)) {
    names(model_objects) <- dot_names
  }
  
  object_names <- names(model_objects)
  
  m <- mapply(function(.x, .y) {
    dat <- data.frame(rsquare_gee=1 - sum((.x$y - .x$fitted.values)^2, na.rm = T)/sum((.x$y - mean(.x$y, na.rm = T))^2, na.rm = T))
    model_name <- gsub("\"", "", insight::safe_deparse(.y), fixed = TRUE)
    perf_df <- data.frame(Name = model_name, Model = class(.x)[1], dat, stringsAsFactors = FALSE)
    perf_df
  }, model_objects, object_names, SIMPLIFY = FALSE)
  
  dfs <- Reduce(function(x, y) merge(x, y, all = TRUE, sort = FALSE), m)

  return(dfs)
}

```

## Predicting from model objects with new data (such as mean values)

```{r}

predictNew <- function(model, response, newData, fixVars=NULL){
  
  # check response variable is the same length as the newData variables
  if (length(response) != nrow(newData)){
    stop("Response variable must be the same length as the new data")
  }

  # get predictor variables from model
  pred <- insight::find_predictors(model, flatten = TRUE)

  # if fixVars is not null
  if (!is.null(fixVars)){
    # check if fixVars is a list or named vector and convert to dataframe if necessary
    if (is.list(fixVars) | is.vector(fixVars)){
      fixVars <- t(as.data.frame(fixVars))
      # remove redundant rowname
      rownames(fixVars) <- NULL
    }
    
    # remove fixed variables from predictors
    pred <- pred[!pred %in% colnames(fixVars)]
  
  }
  
  # assign columns from newData to dat
  dat <- newData[pred]
  
  # if fixVars is not null
  if (!is.null(fixVars)){
    # add fixed variable columns
    dat <- cbind(dat, fixVars)
  }
  
  if (class(model) == "glmgee"){
    # make predictions with new data
    predictions <- predict(model, newdata=dat, type='response', varest='bias-corrected')
  } else {
    # make predictions with new data
    predictions <- predict(model, newdata=dat, type='response')
  }
  # bind predictions to dat
  predictDat <- cbind(dat, response=response, fit=predictions)

  # return output
  return(predictDat)
}

```

## Compiling GEE GLM model performance parameters

```{r}

geeModelPerformance <- function(..., verbose=FALSE){
  
  if (length(list(...)) == 1){
      
      model_objects <- insight::ellipsis_info(..., ..., only_models = TRUE)
      model_objects <- model_objects[1]

  } else{

      model_objects <- insight::ellipsis_info(..., only_models = TRUE)
  
  }
  
  # ensure proper object names
  dot_names <- sapply(match.call(expand.dots = FALSE)[["..."]], as.character)
  check_object_names <- insight::compact_character(names(model_objects))
  if ((is.null(check_object_names) ||
    # or if length of names doesn't match number of models
    length(check_object_names) != length(model_objects) ||
    # or if names are "..1", "..2" pattern
    all(grepl("\\.\\.\\d", check_object_names))) &&
    # and length of dot-names must match length of objects
    length(model_objects) == length(dot_names)) {
    names(model_objects) <- dot_names
  }
  
  object_names <- names(model_objects)
  
  m <- mapply(function(.x, .y) {
    if (.x$family$link == "identity") {
      R2 <- 1 - sum((.x$y - .x$fitted.values)^2, na.rm = T)/sum((.x$y - mean(.x$y, na.rm = T))^2, na.rm = T)
      PCP <- data.frame(pcp_model=NA, model_ci_low=NA, model_ci_high=NA, lrt_chisq=NA)
      
    } else if (.x$family$link == "logit") {
      R2 <- performance::r2_tjur(.x)
      PCP <- performance::performance_pcp(.x)
      
    } else {
      R2 <- NA
      PCP <- data.frame(pcp_model=NA, model_ci_low=NA, model_ci_high=NA, lrt_chisq=NA)
      
    }
    dat <- data.frame(rsquare_gee=R2,
                      GPAIC=glmtoolbox::AGPC(.x, verbose=FALSE),
                      GPBIC=glmtoolbox::SGPC(.x, verbose=FALSE),
                      ePCP=PCP$pcp_model,
                      ePCP95Lo=PCP$model_ci_low,
                      ePCP95Hi=PCP$model_ci_high,
                      ePCPChiSq=PCP$lrt_chisq
                      )
    # omit NA columns
    dat <- Filter(function(x)!all(is.na(x)), dat)
    
    model_name <- gsub("\"", "", insight::safe_deparse(.y), fixed = TRUE)
    perf_df <- data.frame(Name = model_name, Model = class(.x)[1], dat, stringsAsFactors = FALSE)
    perf_df
  }, model_objects, object_names, SIMPLIFY = FALSE)
  
  dfs <- Reduce(function(x, y) merge(x, y, all = TRUE, sort = FALSE), m)
  
  # print output if verbose input argument is true
  if (verbose){
    print(dfs)
  }

  return(dfs)
}


```

## (Herron) estimated percentage correct predictions (ePCP) for GLMM models

```{r}

glmmPCP <- function(...){
   if (length(list(...)) == 1){
      
      model_objects <- insight::ellipsis_info(..., ..., only_models = TRUE)
      model_objects <- model_objects[1]

  } else{

      model_objects <- insight::ellipsis_info(..., only_models = TRUE)
  
  }
  
  # ensure proper object names
  dot_names <- sapply(match.call(expand.dots = FALSE)[["..."]], as.character)
  check_object_names <- insight::compact_character(names(model_objects))
  if ((is.null(check_object_names) ||
    # or if length of names doesn't match number of models
    length(check_object_names) != length(model_objects) ||
    # or if names are "..1", "..2" pattern
    all(grepl("\\.\\.\\d", check_object_names))) &&
    # and length of dot-names must match length of objects
    length(model_objects) == length(dot_names)) {
    names(model_objects) <- dot_names
  }
  
  object_names <- names(model_objects)
  
  m <- mapply(function(.x, .y) {
    y_full <- .x@resp$y

    n_full <- suppressWarnings(insight::n_obs(.x))

    pr_full <- stats::predict(.x, type = "response")
    
    pcp_full <- (sum(1 - pr_full[y_full == 0]) + sum(pr_full[y_full == 1])) / n_full
    
    dat <- data.frame(ePCP=pcp_full)
    model_name <- gsub("\"", "", insight::safe_deparse(.y), fixed = TRUE)
    perf_df <- data.frame(Name = model_name, Model = class(.x)[1], dat, stringsAsFactors = FALSE)
    perf_df
  }, model_objects, object_names, SIMPLIFY = FALSE)
  
  dfs <- Reduce(function(x, y) merge(x, y, all = TRUE, sort = FALSE), m)

  return(dfs)

}


```

## Formatting GEE parameters

```{r}

geeParams <- function(geeMod, ci=0.95, exponentiate=TRUE, varest='bias-corrected',
                      round=NULL, verbose=TRUE){
  
  geeModParams <- tidy(geeMod, exponentiate=exponentiate, conf.level=ci, conf.int=TRUE, varest=varest)
  
  if (!is.null(round)){
    
    parOut <- tibble(cbind(geeModParams[, names(geeModParams)=='term'], round(geeModParams[, names(geeModParams)!='term'], round)))

  } else{
    
    parOut <- geeModParams
    
  }
  
  
  if (verbose){
    print(parOut)
  }
  return(parOut)
  
}

```

## Compiling Firth-penalised GEE parameters

```{r}

geefirthParams <- function(geefirthMod, ci=0.95, exponentiate=TRUE, verbose=TRUE){

  a = 1 - ci
  
  if (exponentiate){
    parOut <- cbind(data.frame(Odds_Ratio=round(exp(geefirthMod$coefficients$coefficients),
                                              4),
                               OR_WaldCI.lo=paste("[",
                                             round(exp(geefirthMod$coefficients$coefficients - qnorm(a/2,
                                                                                                     lower.tail=FALSE)*geefirthMod$coefficients$std.err),
                                                   4)),
                               OR_WaldCI.hi=paste(round(exp(geefirthMod$coefficients$coefficients + qnorm(a/2,
                                                                                                          lower.tail=FALSE)*geefirthMod$coefficients$std.err),
                                                   4),
                                             "]"),
                             row.names=row.names(geefirthMod$coefficients)),
                  round(subset(geefirthMod$coefficients, select=-c(coefficients)), 4))
  } else{
    parOut <- cbind(round(geefirthMod$coefficients$coefficients, 4),
                    data.frame(WaldCI.lo=paste("[",
                                               round(geefirthMod$coefficients$coefficients - qnorm(a/2,
                                                                                                   lower.tail=FALSE)*geefirthMod$coefficients$std.err, 4)),
                               WaldCI.hi=paste(round(geefirthMod$coefficients$coefficients + qnorm(a/2, lower.tail=FALSE)*geefirthMod$coefficients$std.err,
                                                   4),
                                             "]"),
                               row.names=row.names(geefirthMod$coefficients)),
                  round(subset(geefirthMod$coefficients, select=-c(coefficients)), 4))
  }
  
  
  if (verbose){
    print(parOut)
  }
  return(parOut)
}

```

# Import data and wrangle

## Parts A & B combined

```{r}

subjDataPath <- utils::choose.files(caption=r"(Select refmap_listest1_testdata_BySubj.csv from 03 Experiment\Experiment 1\Analysis\PostProcess)",
                                     filters=matrix(data=c("refmap_listest1_testdata_BySubj.csv", "refmap_listest1_testdata_BySubj.csv"), ncol=2))

subjData <- read.csv(subjDataPath, header=TRUE)

stimDataPath <- utils::choose.files(caption=r"(Select refmap_listest1_testdata_ByStim.csv from 03 Experiment\Experiment 1\Analysis\PostProcess)",
                                     filters=matrix(data=c("refmap_listest1_testdata_ByStim.csv", "refmap_listest1_testdata_ByStim.csv"), ncol=2))

stimData <- read.csv(stimDataPath, header=TRUE)

```

```{r}
# definition of ordinal variable levels
UASLAeqCatsA <- c("No UAS", "42", "48", "54", "60")
SNRCatsA <- c("No UAS", "-16", "-10", "-4", "2", "8")
UASOpCatsA <- c("No UAS", "Flyover", "Landing", "Takeoff")
UASTypeCatsA <- c("No UAS", "H520", "M300", "T150")

# encode factors
subjData$ID. <- factor(subjData$ID.)
subjData$UASLAeq <- factor(subjData$UASLAeq, levels=UASLAeqCatsA, order=TRUE)
subjData$SNRlevel <- factor(subjData$SNRlevel, levels=SNRCatsA, order=TRUE)
subjData$UASOperation <- factor(subjData$UASOperation, levels=UASOpCatsA)
subjData$UASType <- factor(subjData$UASType, levels=UASTypeCatsA)
subjData$AmbientEnv <- factor(subjData$AmbientEnv, levels=c("Park", "Street"))
subjData$AAM_attitude <- factor(subjData$AAM_attitude)
subjData$Home_Area <- factor(subjData$Home_Area)
subjData$Area_soundscape <- factor(subjData$Area_soundscape)
subjData$NationGeo <- factor(subjData$NationGeo)

# recode AAM_attitude to 3 groups
subjData <- subjData |> dplyr::mutate(AAM_attitude3 = case_match(AAM_attitude,
                                                                    "Supportive" ~ "Supportive",
                                                                    c("Ambivalent",
                                                                      "Concerned") ~ "Ambiv_Concern",
                                                                      "Neutral" ~ "Neutral"))
subjData$AAM_attitude3 <- factor(subjData$AAM_attitude3)

# recode AAM_attitude to 2 groups
subjData <- subjData |> dplyr::mutate(AAM_attitude2 = case_match(AAM_attitude,
                                                                    "Supportive" ~ "Supportive",
                                                                    c("Ambivalent",
                                                                      "Concerned",
                                                                      "Neutral") ~ "Ambiv_Concern_Neutral"))
subjData$AAM_attitude2 <- factor(subjData$AAM_attitude2)

# recode AAM_attitude to 2 other groups
subjData <- subjData |> dplyr::mutate(AAM_attitude2_2 = case_match(AAM_attitude,
                                                                    c("Supportive",
                                                                      "Ambivalent") ~ "Support_Ambiv",
                                                                    c("Concerned",
                                                                      "Neutral") ~ "Concern_Neutral"))

subjData$AAM_attitude2_2 <- factor(subjData$AAM_attitude2_2)

# recode NationGeo to 4 groups
subjData <- subjData |> dplyr::mutate(NationGeo4 = case_match(NationGeo,
                                                               "UK" ~ "UK",
                                                               c("Africa",
                                                                 "SouthAsia") ~ "Africa_SAsia",
                                                               c("Australasia",
                                                                 "EastAsia",
                                                                 "Europe",
                                                                 "MidEast",
                                                                 "SouthAmerica") ~ "Other",
                                                               "" ~ "Unspecified"))
subjData$NationGeo4 <- factor(subjData$NationGeo4)

# recode NationGeo to 3 groups
subjData <- subjData |> dplyr::mutate(NationGeo3 = case_match(NationGeo,
                                                                 "UK" ~ "UK",
                                                                 c("Africa",
                                                                   "SouthAsia") ~ "Africa_SAsia",
                                                                 c("Australasia",
                                                                   "EastAsia",
                                                                   "Europe",
                                                                   "MidEast",
                                                                   "SouthAmerica",
                                                                   "") ~ "Other"))
subjData$NationGeo3 <- factor(subjData$NationGeo3)

# recode NationGeo to 2 groups
subjData <- subjData |> dplyr::mutate(NationGeo2 = case_match(NationGeo,
                                                                 "UK" ~ "UK",
                                                                 c("Africa",
                                                                   "SouthAsia",
                                                                   "Australasia",
                                                                   "EastAsia",
                                                                   "Europe",
                                                                   "MidEast",
                                                                   "SouthAmerica",
                                                                   "") ~ "Other"))
subjData$NationGeo2 <- factor(subjData$NationGeo2)


subjData$NationGeo3 <- factor(subjData$NationGeo3)

# recode Area of residence to 2 groups
subjData <- subjData |> dplyr::mutate(Home_Area2 = case_match(Home_Area,
                                                         "Urban" ~ "Urban",
                                                         c("Suburban",
                                                           "Rural") ~ "Suburban_Rural"))
subjData$Home_Area2 <- factor(subjData$Home_Area2)


# recode Area soundscape to 2 groups
subjData <- subjData |> dplyr::mutate(Area_soundscape2 = case_match(Area_soundscape,
                                                                       c("Calm",
                                                                         "Monotonous") ~ "Uneventful",
                                                                       c("Chaotic",
                                                                         "Vibrant") ~ "Eventful"))

subjData$Area_soundscape2 <- factor(subjData$Area_soundscape2)

# create column with Part B TrialNumbers continuing from Part A
subjData$TrialNumberCnt <- subjData$TrialNumber
subjData$TrialNumberCnt[subjData$SessionPart == "B"] <- subjData$TrialNumberCnt[subjData$SessionPart == "B"] + 
                                                              max(subjData$TrialNumber[subjData$SessionPart=="A"])

# ensure that participant ID. 17 TrialNumberCnt starts from 61 (as they had done 60 in Part A)
subjData$TrialNumberCnt[subjData$ID. == 17] <- subjData$TrialNumberCnt[subjData$ID. == 17] - 20

# rescale trial number variables separately for each session part
subjData <- rbind(subjData[subjData$SessionPart == "A", ] |> dplyr::mutate(TrialNumberScl = datawizard::standardise(TrialNumber, scale=TRUE)),
                    subjData[subjData$SessionPart == "B", ] |> dplyr::mutate(TrialNumberScl = datawizard::standardise(TrialNumber, scale=TRUE)))
subjData <- subjData |> dplyr::mutate(TrialNumberCntScl = datawizard::standardise(TrialNumberCnt, scale=TRUE))

# relocate new columns
subjData <- subjData |> dplyr::relocate(TrialNumberCnt, TrialNumberScl,
                                        TrialNumberCntScl, .after=TrialNumber)

# rescale dB variables
subjData <- subjData |> dplyr::mutate(UASLAeqMaxLRScl = datawizard::standardise(UASLAeqMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASLAEMaxLRScl = datawizard::standardise(UASLAEMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASEPNLMaxLRScl = datawizard::standardise(UASEPNLMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(LAELAF50diffScl = datawizard::standardise(LAELAF50diff, scale=FALSE))
subjData <- subjData |> dplyr::mutate(EPNLLAeqdiffScl = datawizard::standardise(EPNLLAeqdiff, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASDisc0p5LAEMaxLRScl = datawizard::standardise(UASDisc0p5LAEMaxLR, scale=FALSE))

stimData <- stimData |> dplyr::mutate(UASLAeqMaxLRScl = datawizard::standardise(UASLAeqMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASLAEMaxLRScl = datawizard::standardise(UASLAEMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASEPNLMaxLRScl = datawizard::standardise(UASEPNLMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(LAELAF50diffScl = datawizard::standardise(LAELAF50diff, scale=FALSE))
stimData <- stimData |> dplyr::mutate(EPNLLAeqdiffScl = datawizard::standardise(EPNLLAeqdiff, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASDisc0p5LAEMaxLRScl = datawizard::standardise(UASDisc0p5LAEMaxLR, scale=FALSE))

# convert detectability dB to log variables
subjData <- subjData |> dplyr::mutate(Detect0p1IntMaxLRLog = Detect0p1dBIntMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p5IntMaxLRLog = Detect0p5dBIntMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p1MaxMaxLRLog = Detect0p1dBMaxMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p5MaxMaxLRLog = Detect0p5dBMaxMaxLR/10)

stimData <- stimData |> dplyr::mutate(Detect0p1IntMaxLRLog = Detect0p1dBIntMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p5IntMaxLRLog = Detect0p5dBIntMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p1MaxMaxLRLog = Detect0p1dBMaxMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p5MaxMaxLRLog = Detect0p5dBMaxMaxLR/10)

# Log other variables
subjData$PartLoudMGLT05ExLog <- log(subjData$PartLoudMGLT05Ex)
subjData$PartLoudMGST05ExLog <- log(subjData$PartLoudMGST05Ex)
subjData$PartLoudMGLTPowAvgLog <- log(subjData$PartLoudMGLTPowAvg)
subjData$PartLoudMGSTPowAvgLog <- log(subjData$PartLoudMGSTPowAvg)

stimData$PartLoudMGLT05ExLog <- log(stimData$PartLoudMGLT05Ex)
stimData$PartLoudMGST05ExLog <- log(stimData$PartLoudMGST05Ex)
stimData$PartLoudMGLTPowAvgLog <- log(stimData$PartLoudMGLTPowAvg)
stimData$PartLoudMGSTPowAvgLog <- log(stimData$PartLoudMGSTPowAvg)

# reorder by participant ID and trial number
subjData <- subjData[with(subjData, order(ID., TrialNumberCnt)), ]

# omit ambient-only stimuli
subjDataNoAmb <- subjData |> dplyr::filter(UASLAeq != "No UAS")
stimDataNoAmb <- stimData |> dplyr::filter(UASLAeq != "No UAS")

# re-encode factors omitting ambient-only stimuli
subjDataNoAmb$SNRlevel <- factor(subjDataNoAmb$SNRlevel, levels=SNRCatsA[2:length(SNRCatsA)], order=TRUE)
subjDataNoAmb$UASOperation <- factor(subjDataNoAmb$UASOperation, levels=UASOpCatsA[2: length(UASOpCatsA)])
subjDataNoAmb$UASType <- factor(subjDataNoAmb$UASType, levels=UASTypeCatsA[2:length(UASTypeCatsA)])
stimDataNoAmb$SNRlevel <- factor(stimDataNoAmb$SNRlevel, levels=SNRCatsA[2:length(SNRCatsA)], order=TRUE)
stimDataNoAmb$UASOperation <- factor(stimDataNoAmb$UASOperation, levels=UASOpCatsA[2: length(UASOpCatsA)])
stimDataNoAmb$UASType <- factor(stimDataNoAmb$UASType, levels=UASTypeCatsA[2:length(UASTypeCatsA)])

```

## Part A noticeability data

```{r}

subjNoticeDataPath <- utils::choose.files(caption=r"(Select refmap_listest1_testdataANoticeFilt_BySubj.csv from 03 Experiment\Experiment 1\Analysis\PostProcess)",
                                     filters=matrix(data=c("refmap_listest1_testdataANoticeFilt_BySubj.csv", "refmap_listest1_testdataANoticeFilt_BySubj.csv"), ncol=2))

subjNoticeData <- read.csv(subjNoticeDataPath, header=TRUE)

stimNoticeDataPath <- utils::choose.files(caption=r"(Select refmap_listest1_testdataANoticeFilt_ByStim.csv from 03 Experiment\Experiment 1\Analysis\PostProcess)",
                                     filters=matrix(data=c("refmap_listest1_testdataANoticeFilt_ByStim.csv", "refmap_listest1_testdataANoticeFilt_ByStim.csv"), ncol=2))

stimNoticeData <- read.csv(stimNoticeDataPath, header=TRUE)

```

```{r}
# definition of ordinal variable levels
UASLAeqCatsA <- c("No UAS", "42", "48", "54", "60")
SNRCatsA <- c("No UAS", "-16", "-10", "-4", "2", "8")
UASOpCatsA <- c("No UAS", "Flyover", "Landing", "Takeoff")
UASTypeCatsA <- c("No UAS", "H520", "M300", "T150")

# encode factors
subjNoticeData$ID. <- factor(subjNoticeData$ID.)
subjNoticeData$UASLAeq <- factor(subjNoticeData$UASLAeq, levels=UASLAeqCatsA, order=TRUE)
subjNoticeData$SNRlevel <- factor(subjNoticeData$SNRlevel, levels=SNRCatsA, order=TRUE)
subjNoticeData$UASOperation <- factor(subjNoticeData$UASOperation, levels=UASOpCatsA)
subjNoticeData$UASType <- factor(subjNoticeData$UASType, levels=UASTypeCatsA)
subjNoticeData$AmbientEnv <- factor(subjNoticeData$AmbientEnv, levels=c("Park", "Street"))
subjNoticeData$AAM_attitude <- factor(subjNoticeData$AAM_attitude)
subjNoticeData$Home_Area <- factor(subjNoticeData$Home_Area)
subjNoticeData$Area_soundscape <- factor(subjNoticeData$Area_soundscape)
subjNoticeData$NationGeo <- factor(subjNoticeData$NationGeo)

# recode AAM_attitude to 3 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(AAM_attitude3 = case_match(AAM_attitude,
                                                                    "Supportive" ~ "Supportive",
                                                                    c("Ambivalent",
                                                                      "Concerned") ~ "Ambiv_Concern",
                                                                      "Neutral" ~ "Neutral"))
subjNoticeData$AAM_attitude3 <- factor(subjNoticeData$AAM_attitude3)

# recode AAM_attitude to 2 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(AAM_attitude2 = case_match(AAM_attitude,
                                                                    "Supportive" ~ "Supportive",
                                                                    c("Ambivalent",
                                                                      "Concerned",
                                                                      "Neutral") ~ "Ambiv_Concern_Neutral"))
subjNoticeData$AAM_attitude2 <- factor(subjNoticeData$AAM_attitude2)

# recode AAM_attitude to 2 other groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(AAM_attitude2_2 = case_match(AAM_attitude,
                                                                    c("Supportive",
                                                                      "Ambivalent") ~ "Support_Ambiv",
                                                                    c("Concerned",
                                                                      "Neutral") ~ "Concern_Neutral"))

subjNoticeData$AAM_attitude2_2 <- factor(subjNoticeData$AAM_attitude2_2)

# recode NationGeo to 4 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(NationGeo4 = case_match(NationGeo,
                                                               "UK" ~ "UK",
                                                               c("Africa",
                                                                 "SouthAsia") ~ "Africa_SAsia",
                                                               c("EastAsia",
                                                                 "Europe",
                                                                 "MidEast",
                                                                 "SouthAmerica") ~ "Other",
                                                               "" ~ "Unspecified"))
subjNoticeData$NationGeo4 <- factor(subjNoticeData$NationGeo4)

# recode NationGeo to 3 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(NationGeo3 = case_match(NationGeo,
                                                                 "UK" ~ "UK",
                                                                 c("Africa",
                                                                   "SouthAsia") ~ "Africa_SAsia",
                                                                 c("EastAsia",
                                                                   "Europe",
                                                                   "MidEast",
                                                                   "SouthAmerica",
                                                                   "") ~ "Other"))
subjNoticeData$NationGeo3 <- factor(subjNoticeData$NationGeo3)

# recode NationGeo to 2 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(NationGeo2 = case_match(NationGeo,
                                                                 "UK" ~ "UK",
                                                                 c("Africa",
                                                                   "SouthAsia",
                                                                   "EastAsia",
                                                                   "Europe",
                                                                   "MidEast",
                                                                   "SouthAmerica",
                                                                   "") ~ "Other"))
subjNoticeData$NationGeo2 <- factor(subjNoticeData$NationGeo2)


subjNoticeData$NationGeo3 <- factor(subjNoticeData$NationGeo3)

# recode Area of residence to 2 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(Home_Area2 = case_match(Home_Area,
                                                         "Urban" ~ "Urban",
                                                         c("Suburban",
                                                           "Rural") ~ "Suburban_Rural"))
subjNoticeData$Home_Area2 <- factor(subjNoticeData$Home_Area2)


# recode Area soundscape to 2 groups
subjNoticeData <- subjNoticeData |> dplyr::mutate(Area_soundscape2 = case_match(Area_soundscape,
                                                                       c("Calm",
                                                                         "Monotonous") ~ "Uneventful",
                                                                       c("Chaotic",
                                                                         "Vibrant") ~ "Eventful"))

subjNoticeData$Area_soundscape2 <- factor(subjNoticeData$Area_soundscape2)

# rescale trial number variable
subjNoticeData <- subjNoticeData |> dplyr::mutate(TrialNumberScl = datawizard::standardise(TrialNumber, scale=TRUE))

# rescale dB variables
subjNoticeData <- subjNoticeData |> dplyr::mutate(UASLAeqMaxLRScl = datawizard::standardise(UASLAeqMaxLR, scale=FALSE))
subjNoticeData <- subjNoticeData |> dplyr::mutate(UASLAEMaxLRScl = datawizard::standardise(UASLAEMaxLR, scale=FALSE))
subjNoticeData <- subjNoticeData |> dplyr::mutate(UASEPNLMaxLRScl = datawizard::standardise(UASEPNLMaxLR, scale=FALSE))
subjNoticeData <- subjNoticeData |> dplyr::mutate(LAELAF50diffScl = datawizard::standardise(LAELAF50diff, scale=FALSE))
subjNoticeData <- subjNoticeData |> dplyr::mutate(EPNLLAeqdiffScl = datawizard::standardise(EPNLLAeqdiff, scale=FALSE))
subjNoticeData <- subjNoticeData |> dplyr::mutate(UASDisc0p5LAEMaxLRScl = datawizard::standardise(UASDisc0p5LAEMaxLR, scale=FALSE))

stimNoticeData <- stimNoticeData |> dplyr::mutate(UASLAeqMaxLRScl = datawizard::standardise(UASLAeqMaxLR, scale=FALSE))
stimNoticeData <- stimNoticeData |> dplyr::mutate(UASLAEMaxLRScl = datawizard::standardise(UASLAEMaxLR, scale=FALSE))
stimNoticeData <- stimNoticeData |> dplyr::mutate(UASEPNLMaxLRScl = datawizard::standardise(UASEPNLMaxLR, scale=FALSE))
stimNoticeData <- stimNoticeData |> dplyr::mutate(LAELAF50diffScl = datawizard::standardise(LAELAF50diff, scale=FALSE))
stimNoticeData <- stimNoticeData |> dplyr::mutate(EPNLLAeqdiffScl = datawizard::standardise(EPNLLAeqdiff, scale=FALSE))
stimNoticeData <- stimNoticeData |> dplyr::mutate(UASDisc0p5LAEMaxLRScl = datawizard::standardise(UASDisc0p5LAEMaxLR, scale=FALSE))

# convert detectability dB to log variables
subjNoticeData <- subjNoticeData |> dplyr::mutate(Detect0p1IntMaxLRLog = Detect0p1dBIntMaxLR/10)
subjNoticeData <- subjNoticeData |> dplyr::mutate(Detect0p5IntMaxLRLog = Detect0p5dBIntMaxLR/10)
subjNoticeData <- subjNoticeData |> dplyr::mutate(Detect0p1MaxMaxLRLog = Detect0p1dBMaxMaxLR/10)
subjNoticeData <- subjNoticeData |> dplyr::mutate(Detect0p5MaxMaxLRLog = Detect0p5dBMaxMaxLR/10)

stimNoticeData <- stimNoticeData |> dplyr::mutate(Detect0p1IntMaxLRLog = Detect0p1dBIntMaxLR/10)
stimNoticeData <- stimNoticeData |> dplyr::mutate(Detect0p5IntMaxLRLog = Detect0p5dBIntMaxLR/10)
stimNoticeData <- stimNoticeData |> dplyr::mutate(Detect0p1MaxMaxLRLog = Detect0p1dBMaxMaxLR/10)
stimNoticeData <- stimNoticeData |> dplyr::mutate(Detect0p5MaxMaxLRLog = Detect0p5dBMaxMaxLR/10)

# Log other variables
subjNoticeData$PartLoudMGLT05ExLog <- log(subjNoticeData$PartLoudMGLT05Ex)
subjNoticeData$PartLoudMGST05ExLog <- log(subjNoticeData$PartLoudMGST05Ex)
subjNoticeData$PartLoudMGLTPowAvgLog <- log(subjNoticeData$PartLoudMGLTPowAvg)
subjNoticeData$PartLoudMGSTPowAvgLog <- log(subjNoticeData$PartLoudMGSTPowAvg)

stimNoticeData$PartLoudMGLT05ExLog <- log(stimNoticeData$PartLoudMGLT05Ex)
stimNoticeData$PartLoudMGST05ExLog <- log(stimNoticeData$PartLoudMGST05Ex)
stimNoticeData$PartLoudMGLTPowAvgLog <- log(stimNoticeData$PartLoudMGLTPowAvg)
stimNoticeData$PartLoudMGSTPowAvgLog <- log(stimNoticeData$PartLoudMGSTPowAvg)

# reorder by participant ID and trial number
subjNoticeData <- subjNoticeData[with(subjNoticeData, order(ID., TrialNumber)), ]

# omit ambient-only stimuli
subjNoticeDataNoAmb <- subjNoticeData |> dplyr::filter(UASLAeq != "No UAS")
stimNoticeDataNoAmb <- stimNoticeData |> dplyr::filter(UASLAeq != "No UAS")

# re-encode factors omitting ambient-only stimuli
subjNoticeDataNoAmb$SNRlevel <- factor(subjNoticeDataNoAmb$SNRlevel, levels=SNRCatsA[2:length(SNRCatsA)], order=TRUE)
subjNoticeDataNoAmb$UASOperation <- factor(subjNoticeDataNoAmb$UASOperation, levels=UASOpCatsA[2: length(UASOpCatsA)])
subjNoticeDataNoAmb$UASType <- factor(subjNoticeDataNoAmb$UASType, levels=UASTypeCatsA[2:length(UASTypeCatsA)])
stimNoticeDataNoAmb$SNRlevel <- factor(stimNoticeDataNoAmb$SNRlevel, levels=SNRCatsA[2:length(SNRCatsA)], order=TRUE)
stimNoticeDataNoAmb$UASOperation <- factor(stimNoticeDataNoAmb$UASOperation, levels=UASOpCatsA[2: length(UASOpCatsA)])
stimNoticeDataNoAmb$UASType <- factor(stimNoticeDataNoAmb$UASType, levels=UASTypeCatsA[2:length(UASTypeCatsA)])

```



Parts A & B combined analysis

# Change in mean annoyance rating

## Categorical variables (AIC and BIC favoured models)

### Initial working correlation structure selection

Note that unstructured and non-stationary (M-dependent) correlation structures are not calculable (numerical errors) 

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABTypeOpLAEEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR + AmbientEnv +
                                                           UASType + UASOperation +
                                                           TrialNumberCntScl + I(UASEvents^-1),
                                                           data=subjDataNoAmb, family=gaussian(link='identity'),
                                                           id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

### Initial model with interaction

```{r}

model1 <- mABTypeOpLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                         UASType + UASOperation +
                                                         TrialNumberCntScl + I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE)

anova(model1, test='score')

model1predict <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLR [all]",
                                                             "UASType [all]",
                                                             "UASOperation [all]",
                                                             "AmbientEnv", "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predict$UASType <- model1predict$group
model1predict$UASOperation <- model1predict$facet
model1predict$AmbientEnv <- model1predict$panel

set.seed(808)

ggplot(data=model1predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.75, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=UASType, shape=UASType), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.075) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASType, shape=UASType), alpha=0.35) +
  
  scale_x_continuous(sec.axis = sec_axis(~ . , name="UAS operation", breaks = NULL, labels = NULL)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), sec.axis = sec_axis(~ . , name="Ambient environment", breaks = NULL, labels = NULL)) +
  scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.2, end = 0.7) +
  scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.2, end = 0.7) +
  scale_shape_manual(values=c(21, 22, 23), guide=FALSE) +

  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
  guides(colour = guide_legend(reverse=FALSE, title="UAS type"), fill = guide_legend(reverse=FALSE, title="UAS type"), shape = guide_legend(reverse=FALSE, title="UAS type")) +
  facet_grid(cols = vars(UASOperation), rows=vars(AmbientEnv))

```

#### without trial sequence

```{r}

model1 <- mABTypeOpLAExEnv1_Q.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                         UASType + UASOperation +
                                                          I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

parameters::model_parameters(model1)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE)

anova(model1, test='score')

model1predict <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLR [all]",
                                                             "UASType [all]",
                                                             "UASOperation [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predict$UASType <- model1predict$group
model1predict$UASOperation <- model1predict$facet
model1predict$AmbientEnv <- model1predict$panel

set.seed(808)

ggplot(data=model1predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.75, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=UASType, shape=UASType), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.075) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASType, shape=UASType), alpha=0.35) +
  
  scale_x_continuous(sec.axis = sec_axis(~ . , name="UAS operation", breaks = NULL, labels = NULL)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), sec.axis = sec_axis(~ . , name="Ambient environment", breaks = NULL, labels = NULL)) +
  scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.2, end = 0.7) +
  scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.2, end = 0.7) +
  scale_shape_manual(values=c(21, 22, 23), guide=FALSE) +

  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
  guides(colour = guide_legend(reverse=FALSE, title="UAS type"), fill = guide_legend(reverse=FALSE, title="UAS type"), shape = guide_legend(reverse=FALSE, title="UAS type")) +
  facet_grid(cols = vars(UASOperation), rows=vars(AmbientEnv))

```

### interaction type and op

```{r}

model1 <- mABTypeOpLAExEnv1_QSq.GEE

model2 <- mABTypexOpLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                         UASType*UASOperation +
                                                         TrialNumberCntScl + I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE,
                    mABTypexOpLAExEnv1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3)) +
  guides(shape=guide_legend(reverse=FALSE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### interaction op and env

```{r}

model1 <- mABTypeOpLAExEnv1_QSq.GEE

model2 <- mABTypeOpxEnvxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                         UASType + UASOperation*AmbientEnv +
                                                         TrialNumberCntScl + I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE,
                    mABTypexOpLAExEnv1_QSq.GEE, mABTypeOpxEnvxLAE1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3)) +
  guides(shape=guide_legend(reverse=FALSE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### interaction op and LAE

```{r}

model1 <- mABTypeOpLAExEnv1_QSq.GEE

model2 <- mABTypeOpxLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                         UASType + UASOperation*UASLAEMaxLR +
                                                         TrialNumberCntScl + I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE,
                    mABTypexOpLAExEnv1_QSq.GEE, mABTypeOpxEnvxLAE1_QSq.GEE,
                    mABTypeOpxLAExEnv1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3)) +
  guides(shape=guide_legend(reverse=FALSE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

model2predictTypePk <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model2, type="bias-corrected"))

model2predictOpPk <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model2, type="bias-corrected"))


model2predictType$AmbientEnv <- model2predictType$facet
model2predictOp$AmbientEnv <- model2predictOp$facet

p1 <- ggplot(data=model2predictTypePk) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model2predictOpPk) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',], aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1, align='v')

p

p1 + p2 + p3 + p4 + plot_layout(nrow = 1)

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p12 <- cowplot::plot_grid(p1, p2, ncol=2, nrow=1, align='hv', rel_heights=c(1, 1))
p34 <- cowplot::plot_grid(p3, p4, ncol=1, nrow=2, align='v', rel_widths=c(1, 1))

p12
p34

p1 + p2

p3 / p4

(p1 | p2) + (p3 / p4)

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 6)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


```

### interaction type and LAE

```{r}

model1 <- mABTypeOpLAExEnv1_QSq.GEE

model2 <- mABOpTypexLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                         UASOperation + UASType*UASLAEMaxLR +
                                                         TrialNumberCntScl + I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE,
                    mABTypexOpLAExEnv1_QSq.GEE, mABTypeOpxEnvxLAE1_QSq.GEE,
                    mABTypeOpxLAExEnv1_QSq.GEE, mABOpTypexLAExEnv1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3)) +
  guides(shape=guide_legend(reverse=FALSE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### interaction type, op and LAE

```{r, fig.width=16, fig.height=5}

model1 <- mABTypeOpLAExEnv1_QSq.GEE

model2 <- mABOpxTypexLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                        UASType*UASLAEMaxLR + UASOperation*UASLAEMaxLR +
                                                         TrialNumberCntScl + I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE,
                    mABTypexOpLAExEnv1_QSq.GEE, mABTypeOpxEnvxLAE1_QSq.GEE,
                    mABTypeOpxLAExEnv1_QSq.GEE, mABOpTypexLAExEnv1_QSq.GEE,
                    mABOpxTypexLAExEnv1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3)) +
  guides(shape=guide_legend(reverse=FALSE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmean',
                                                type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                                margin='marginalmeans',
                                             type='fixed',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### interaction LAE with env, op and events

```{r}

model1 <- mABTypeOpxLAExEnv1_QSq.GEE

model2 <- mABTypeOpxLAExEnvx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv +
                                                        UASType*UASLAEMaxLR + UASOperation*UASLAEMaxLR +
                                                         TrialNumberCntScl + UASLAEMaxLR*I(UASEvents^-1),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpLAExEnv1_QSq.GEE, mABTypeOpLAExEnv1_Q.GEE,
                    mABTypexOpLAExEnv1_QSq.GEE, mABTypeOpxEnvxLAE1_QSq.GEE,
                    mABTypeOpxLAExEnv1_QSq.GEE, mABOpTypexLAExEnv1_QSq.GEE,
                    mABOpxTypexLAExEnv1_QSq.GEE, mABTypeOpxLAExEnvx1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]",
                                                             "UASEvents [all]",
                                                             "AmbientEnv [Park]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8, guide = guide_legend(reverse = TRUE, title="UAS events")) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8, guide = guide_legend(reverse = TRUE, title="UAS events")) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  guides(shape=guide_legend(reverse=TRUE, title="UAS events")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABTypeOpxLAExEnv1_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### use backward stepwise selection on best maximal model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABTypeOpxLAExEnv1_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### plot diagnostics

```{r}

performance::check_collinearity(mABTypeOpxLAExEnv1_QSq.GEE)
performance::check_heteroskedasticity(mABTypeOpxLAExEnv1_QSq.GEE)

residuals(mABTypeOpxLAExEnv1_QSq.GEE, type="deviance", plot.it=TRUE, pch=1)
residuals(mABTypeOpxLAExEnv1_QSq.GEE, type="mahalanobis", plot.it=TRUE, identify=3)

dfbeta(mABTypeOpxLAExEnv1_QSq.GEE, level='clusters', coefs='UASLAEMaxLR', main='UASLAEMaxLR')
dfbeta(mABTypeOpxLAExEnv1_QSq.GEE, level='observations', coefs='UASLAEMaxLR', main='UASLAEMaxLR')

```

## Comparison LAE models

### Working correlation structure selection

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence", "Unstructured")){
  model1 <- mABLAE.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR,
                                             data=subjDataNoAmb, family=gaussian(link='identity'),
                                             id=ID., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### LAE-only model

```{r}

model2 <- mABLAE.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR,
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, shape=AmbientEnv), colour='darkgrey', size=0.5, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, shape=AmbientEnv), size=2, alpha=0.4) +
  
  scale_x_continuous(breaks=seq(55, 80, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_shape_manual(values=c(1, 3)) +

  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")
  


```

### LAE with env

```{r}

model2 <- mABLAEEnv.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR + AmbientEnv,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +

  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, shape=AmbientEnv, colour=AmbientEnv), size=0.5, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), size=2, alpha=0.4) +
  
  scale_x_continuous(breaks=seq(55, 80, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3), guide=guide_legend(reverse = TRUE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")
  


```

### LAE with events

```{r}

model2 <- mABLAE1_Q.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, shape=factor(UASEvents), colour=factor(UASEvents)), size=0.5, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.4) +
  
  scale_x_continuous(breaks=seq(55, 80, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
  guides(colour = guide_legend(reverse = TRUE, title="UAS events"),
         fill = guide_legend(reverse = TRUE, title="UAS events"),
         shape = guide_legend(reverse=TRUE, title="UAS events"))


```


### LAE interaction with env

```{r}

model2 <- mABLAExEnv.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE,
                    mABLAExEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, shape=AmbientEnv, colour=AmbientEnv), size=0.35, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  scale_x_continuous(breaks=seq(55, 80, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = TRUE, title="Amb. env.")) +

  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### LAE interaction with env, and UAS events

```{r}

model2 <- mABLAExEnv1_Q.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE,
                    mABLAExEnv.GEE, mABLAExEnv1_Q.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, shape=AmbientEnv, colour=AmbientEnv), size=0.35, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  scale_x_continuous(breaks=seq(55, 80, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3), guide=guide_legend(reverse = TRUE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

#### with trial sequence

```{r}

model2 <- mABLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLR*AmbientEnv + I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE,
                    mABLAExEnv.GEE, mABLAExEnv1_Q.GEE, mABLAExEnv1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, shape=AmbientEnv, colour=AmbientEnv), size=0.35, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.35) +
  
  scale_x_continuous(breaks=seq(55, 80, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3), guide=guide_legend(reverse = TRUE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

## Comparison Loudness models

### ISO 532-3

```{r}

model2 <- mABNxEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLoudISO3PowAvgBin*AmbientEnv + I(UASEvents^-1) +
                                                  TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE,
                    mABLAExEnv.GEE, mABLAExEnv1_Q.GEE, mABLAExEnv1_QSq.GEE,
                    mABNxEnv1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]", "AmbientEnv", "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dAnnoyance, shape=AmbientEnv, colour=AmbientEnv), size=0.35, alpha=0.035, height=0.05, width=0.05) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), size=1.5, alpha=0.45) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3), guide=guide_legend(reverse = TRUE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(N)^"*"~(`Moore-Glasberg-Schlittenlacher`)~sone)), y="Mean change in annoyance")


```

### Sottek

```{r}

model2 <- mABNhmxEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  UASLoudECMAPowAvgBin*AmbientEnv + I(UASEvents^-1) +
                                                    TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAEEnv.GEE,
                    mABLAExEnv.GEE, mABLAExEnv1_Q.GEE, mABLAExEnv1_QSq.GEE,
                    mABNxEnv1_QSq.GEE, mABNhmxEnv1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dAnnoyance, shape=AmbientEnv, colour=AmbientEnv), size=0.35, alpha=0.035, height=0.05, width=0.05) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), size=1.5, alpha=0.45) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title="Amb. env.")) +
  scale_shape_manual(values=c(1, 3), guide=guide_legend(reverse = TRUE, title="Amb. env.")) +
  
  labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="Mean change in annoyance")


```

## Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABLAExEnv1_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

## UAS information only

### LAE with sharpness

```{r}

model2 <- mABShmLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                   UASSharpAurSHM05ExMaxLR +
                                                 UASLAEMaxLR +
                                                TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### LAE with tonal loudness

```{r}

model2 <- mABTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASTonLdECMAPowAvgBin +
                                                       UASLAEMaxLR +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### LAE with sharpness and tonal loudness

```{r}

model2 <- mABShmTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                   UASSharpAurSHM05ExMaxLR +      
                                                    UASTonLdECMAPowAvgBin +
                                                     UASLAEMaxLR +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### LAE with sharpness and tonal loudness interaction

```{r}

model2 <- mABShmxTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                   UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                     UASLAEMaxLR +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### LAE with impulsiveness, sharpness and tonal loudness

```{r}

model2 <- mABIShmxTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLAEMaxLR +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### using loudness

```{r}

model2 <- mABIShmxTnN1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLoudISO3PowAvgBin +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(N)^"*"~(`Moore-Glasberg-Schlittenlacher`)~sone)), y="Mean change in annoyance")

```

### LAE interaction with events

```{r}

model2 <- mABIShmxTnLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLAEMaxLR*I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")



```


### Check sharpness model

```{r}

model2 <- mABSxTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASLAEMaxLR + I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")



```

### add fluctuation strength

```{r}

model2 <- mABFShmxTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         UASFluctOV10ExMaxLR +
                                                       UASLAEMaxLR + I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### tonal loudness interaction with LAE

```{r}

model2 <- mABShmxTnxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                          UASTonLdECMAPowAvgBin*UASLAEMaxLR +
                                                         I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE,
                    mABShmxTnxLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### sharpness interaction with LAE

```{r}

model2 <- mABTnxShmxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                          UASSharpAurISO305ExMaxLR*UASLAEMaxLR +
                                                         I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE,
                    mABShmxTnxLAE1_QSq.GEE, mABTnxShmxLAE1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

```

### LAE interaction with events, no impulsiveness

```{r}

model2 <- mABShmxTnLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASLAEMaxLR*I(UASEvents^-1) +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE,
                    mABShmxTnxLAE1_QSq.GEE, mABTnxShmxLAE1_QSq.GEE,
                    mABShmxTnLAEx1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")



```


### tonal loudness interaction with events

```{r}

model2 <- mABIShmxTnx1_QLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                          UASImpulsSHMAvgMaxLR +
                                                        UASTonLdECMAPowAvgBin*I(UASEvents^-1) +
                                                          UASLAEMaxLR +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE,
                    mABShmxTnxLAE1_QSq.GEE, mABTnxShmxLAE1_QSq.GEE,
                    mABShmxTnLAEx1_QSq.GEE, mABIShmxTnx1_QLAESq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")



```

### tonal loudness interaction with events, with fluctuation strength

```{r}

model2 <- mABFShmxTnx1_QLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                          UASFluctOV10ExMaxLR +
                                                        UASTonLdECMAPowAvgBin*I(UASEvents^-1) +
                                                          UASLAEMaxLR +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE,
                    mABShmxTnxLAE1_QSq.GEE, mABTnxShmxLAE1_QSq.GEE,
                    mABShmxTnLAEx1_QSq.GEE, mABIShmxTnx1_QLAESq.GEE,
                    mABFShmxTnx1_QLAESq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")



```

### tonal loudness interaction with events, no impulsiveness

```{r}

model2 <- mABShmxTnx1_QLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                        UASTonLdECMAPowAvgBin*I(UASEvents^-1) +
                                                          UASLAEMaxLR +
                                                      TrialNumberCnt,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAE1_Q.GEE,
                    mABShmLAE1_QSq.GEE, mABTnLAE1_QSq.GEE, mABShmTnLAE1_QSq.GEE,
                    mABShmxTnLAE1_QSq.GEE, mABIShmxTnLAE1_QSq.GEE,
                    mABIShmxTnN1_QSq.GEE, mABIShmxTnLAEx1_QSq.GEE,
                    mABSxTnLAE1_QSq.GEE, mABFShmxTnLAE1_QSq.GEE,
                    mABShmxTnxLAE1_QSq.GEE, mABTnxShmxLAE1_QSq.GEE,
                    mABShmxTnLAEx1_QSq.GEE, mABIShmxTnx1_QLAESq.GEE,
                    mABFShmxTnx1_QLAESq.GEE, mABShmxTnx1_QLAESq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")


model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +

  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), size=1.5, alpha=0.35) +

  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone)), y="Mean change in annoyance")



```

### Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABIShmxTnLAEx1_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABIShmxTnLAEx1_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

## UAS and env classification

### Add env to best UAS info-only model 

```{r}

model2 <- mABIShmxTnLAEEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLAEMaxLR + AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                                       data=subjDataNoAmb, family=gaussian(link='identity'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### add LAE-env interaction

```{r}

model2 <- mABIShmxTnLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                                       data=subjDataNoAmb, family=gaussian(link='identity'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE interaction with events

Adding an interaction worsens the fit

```{r}

model2 <- mABIShmxTn1_QxLAExEnvSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + UASLAEMaxLR*I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]", "AmbientEnv", "UASEvents [all]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictTn$UASEvents <- model2predictTn$facet

ggplot(data=model2predictTn) +

  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x="UAS tonal loudness (Sottek), sone", y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))


```

### tonal loudness interaction with env

This model slightly improves the fit, but leads to negative gradients for tonal loudness in the Street environment, which is implausible (although this is complicated by the sharpness interaction).

```{r}

model2 <- mABIShmxTnxEnvxLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASImpulsSHMAvgMaxLR +
                                                       UASLAEMaxLR*AmbientEnv +
                                                         UASTonLdECMAPowAvgBin:AmbientEnv +
                                                      TrialNumberCntScl + UASLAEMaxLR*I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE)


model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]", "AmbientEnv", "UASEvents [all]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictTn$UASEvents <- model2predictTn$facet

ggplot(data=model2predictTn) +

  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x="UAS tonal loudness (Sottek), sone", y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))


```

### omit impulsiveness

```{r}

model2 <- mABShmxTnLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]", "AmbientEnv", "UASEvents [all]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictTn$UASEvents <- model2predictTn$facet

ggplot(data=model2predictTn) +

  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +

  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x="UAS tonal loudness (Sottek), sone", y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))


model2predictS <- ggeffects::predict_response(model2, terms=c("UASSharpAurSHM05ExMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictS$UASEvents <- model2predictS$facet

ggplot(data=model2predictS) +

  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASSharpAurSHM05ExMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASSharpAurSHM05ExMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x="UAS Sharpness (Aures | Sottek), acum", y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))



```

### curvilinear LAE^2 

```{r}

model2 <- mABShmxTnxEnvxLAE21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASLAEMaxLR*AmbientEnv + I(UASLAEMaxLR^2) +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))


```

### no trial sequence 

```{r}

model2 <- mABShmxTnLAExEnv1_Q.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASLAEMaxLR*AmbientEnv +
                                                       I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE)

model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))



```

### substitute loudness for LAE

```{r}

model2 <- mABShmxTnNxEnv1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                       UASLoudISO3PowAvgBin*AmbientEnv +
                                                       I(UASEvents^-1) + TrialNumberCntScl,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


model2predict$UASEvents <- model2predict$facet

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(N)^"*"~(`Moore-Glasberg-Schlittenlacher`)~sone)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE, env interaction with tonal loudness

```{r}

model2 <- mABShmxTnxEnvxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE, env interaction with tonal loudness and sharpness

```{r}

model2 <- mABEnvxShmxTnxEnvxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                           UASSharpAurSHM05ExMaxLR:AmbientEnv +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnxEnvxLAE1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE, env interaction with tonal loudness and impulsiveness

```{r}

model2 <- mABEnvxIShmxTnxEnvxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                           UASImpulsSHMAvgMaxLR*AmbientEnv +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnxEnvxLAE1_QSq.GEE,
                    mABEnvxIShmxTnxEnvxLAE1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE, env interaction with sharpness

```{r}

model2 <- mABEnvxShmxTnEnvxLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASSharpAurSHM05ExMaxLR:AmbientEnv +
                                                       UASLAEMaxLR*AmbientEnv +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnxEnvxLAE1_QSq.GEE,
                    mABEnvxIShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnEnvxLAE1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE, env interaction with sharpness, not with LAE

```{r}

model2 <- mABEnvxShmxTnLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASSharpAurSHM05ExMaxLR*AmbientEnv +
                                                       UASLAEMaxLR +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnxEnvxLAE1_QSq.GEE,
                    mABEnvxIShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnEnvxLAE1_QSq.GEE,
                    mABEnvxShmxTnLAE1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### LAE, env interaction with tonal loudness, with event interaction

```{r}

model2 <- mABShmxTnxEnvxLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                       UASLAEMaxLR*AmbientEnv +
                                                         UASLAEMaxLR:I(UASEvents^-1) +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnxEnvxLAE1_QSq.GEE,
                    mABEnvxIShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnEnvxLAE1_QSq.GEE,
                    mABEnvxShmxTnLAE1_QSq.GEE, mABShmxTnxEnvxLAEx1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABIShmxTnxEnvxLAEx1_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABIShmxTnxEnvxLAEx1_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### examine stepwise-selected model

```{r}

model2 <- mABIShmxTnxEnvLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                             UASImpulsSHMAvgMaxLR +
                                                         UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           UASTonLdECMAPowAvgBin*AmbientEnv +
                                                       UASLAEMaxLR +
                                                      TrialNumberCntScl + I(UASEvents^-1),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABLAE.GEE, mABLAExEnv1_Q.GEE,
                    mABIShmxTnLAEEnv1_QSq.GEE, mABIShmxTnLAExEnv1_QSq.GEE,
                    mABIShmxTn1_QxLAExEnvSq.GEE, mABIShmxTnxEnvxLAEx1_QSq.GEE,
                    mABShmxTnLAExEnv1_QSq.GEE, mABShmxTnxEnvxLAE21_QSq.GEE,
                    mABShmxTnLAExEnv1_Q.GEE, mABShmxTnNxEnv1_QSq.GEE,
                    mABShmxTnxEnvxLAE1_QSq.GEE, mABEnvxShmxTnxEnvxLAE1_QSq.GEE,
                    mABEnvxIShmxTnxEnvxLAE1_QSq.GEE, mABShmxTnxEnvLAE1_QSq.GEE,
                    mABIShmxTnxEnvLAE1_QSq.GEE)

model2predictLAE <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predictLAE to UASEvents
model2predictLAE$UASEvents <- model2predictLAE$facet

set.seed(808)

ggplot(data=model2predictLAE) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predict to UASEvents
model2predict$UASEvents <- model2predict$facet

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  #scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

model2predict <- ggeffects::predict_response(model2, terms=c("UASSharpAurSHM05ExMaxLR [all]", "AmbientEnv", "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

# rename facet in model2predict to UASEvents
model2predict$UASEvents <- model2predict$facet

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=2.5, text = element_text(family = "serif")) +

  geom_jitter(data=subjDataNoAmb, aes(x=UASSharpAurSHM05ExMaxLR, y=dAnnoyance, colour=AmbientEnv, shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +

  ggnewscale::new_scale_colour() +  
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.65) +
  
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_point(data=stimDataNoAmb, aes(x=UASSharpAurSHM05ExMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)), size=1.5, alpha=0.5) +
  
  scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  #scale_x_continuous(breaks=seq(50, 85, by=5)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x=expression(paste(UAS~italic(S)["5"]~","~acum)), y="Change in annoyance") +
  facet_grid(cols = vars(UASEvents))

```

### Check working correlation structure selection with stepwise-selected model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABShmxTnxEnvLAE1_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

## UAS and env level

### Working correlation structure selection

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence", "Unstructured")){
  model1 <- mABdLAELAF50.GEE <- glmtoolbox::glmgee(dAnnoyance ~ LAELAF50diff,
                                             data=subjDataNoAmb, family=gaussian(link='identity'),
                                             id=ID., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### LAELAF50diff model

```{r}

model2 <- mABdLAELAF501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')
  
geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")


```

### LAELAF50diff^2 model

```{r}

model2 <- mABdLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE,
                    mABdLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### with impulsiveness, sharpness and tonal loudness interaction

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABIShmxTndLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                  UASImpulsSHMAvgMaxLR +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE,
                    mABdLAELAF5021_QSq.GEE, mABIShmxTndLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), linewidth=2, alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")


```

### LAELAF50diff interaction with events

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABIShmxTndLAELAF502x1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                  UASImpulsSHMAvgMaxLR +
                                                                TrialNumberCntScl +
                                                                I(LAELAF50diff^2)*I(UASEvents^-1) +
                                                                LAELAF50diff,
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE,
                    mABdLAELAF5021_QSq.GEE, mABIShmxTndLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF502x1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), linewidth=2, alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")


```

### no impulsiveness

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABShmxTndLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE, mABdLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF5021_QSq.GEE, mABIShmxTndLAELAF502x1_QSq.GEE,
                    mABShmxTndLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### with fluctuation strength

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABFShmxTndLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASFluctOV10ExMaxLR + 
                                                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE, mABdLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF5021_QSq.GEE, mABIShmxTndLAELAF502x1_QSq.GEE,
                    mABShmxTndLAELAF5021_QSq.GEE, mABFShmxTndLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### with roughness

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABRShmxTndLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASRoughFZ05ExMaxLR + 
                                                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE, mABdLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF5021_QSq.GEE, mABIShmxTndLAELAF502x1_QSq.GEE,
                    mABShmxTndLAELAF5021_QSq.GEE, mABFShmxTndLAELAF5021_QSq.GEE,
                    mABRShmxTndLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### check roughness model

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABRhmShmxTndLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASRoughECMA10ExBin + 
                                                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE, mABdLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF5021_QSq.GEE, mABIShmxTndLAELAF502x1_QSq.GEE,
                    mABShmxTndLAELAF5021_QSq.GEE, mABFShmxTndLAELAF5021_QSq.GEE,
                    mABRShmxTndLAELAF5021_QSq.GEE, mABRhmShmxTndLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### tonal loudness interaction with LAELAF50diff

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABShmxTnxdLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff*UASTonLdECMAPowAvgBin + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE, mABdLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF5021_QSq.GEE, mABIShmxTndLAELAF502x1_QSq.GEE,
                    mABShmxTndLAELAF5021_QSq.GEE, mABFShmxTndLAELAF5021_QSq.GEE,
                    mABRShmxTndLAELAF5021_QSq.GEE, mABRhmShmxTndLAELAF5021_QSq.GEE,
                    mABShmxTnxdLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### sharpness interaction with LAELAF50diff

```{r}

model1 <- mABdLAELAF5021_QSq.GEE

model2 <- mABTnxShmxdLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                TrialNumberCntScl +
                                                                I(UASEvents^-1) +
                                                                LAELAF50diff*UASSharpAurSHM05ExMaxLR + I(LAELAF50diff^2),
                                               data=subjDataNoAmb, family=gaussian(link='identity'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdLAELAF501_QSq.GEE, mABdLAELAF5021_QSq.GEE,
                    mABIShmxTndLAELAF5021_QSq.GEE, mABIShmxTndLAELAF502x1_QSq.GEE,
                    mABShmxTndLAELAF5021_QSq.GEE, mABFShmxTndLAELAF5021_QSq.GEE,
                    mABRShmxTndLAELAF5021_QSq.GEE, mABRhmShmxTndLAELAF5021_QSq.GEE,
                    mABShmxTnxdLAELAF5021_QSq.GEE, mABTnxShmxdLAELAF5021_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, colour=factor(UASEvents), shape=factor(UASEvents)), size=0.3, alpha=0.035, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)), alpha=0.35) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_shape_manual(values=c(2, 4, 5, 6), guide = guide_legend(reverse = FALSE, title = "UAS events (exp.)")) +
  
  guides(shape=guide_legend(title="UAS events", reverse=TRUE), fill=guide_legend(title="UAS events", reverse=TRUE), colour=guide_legend(title="UAS events", reverse=TRUE)) +
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")

```

### Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABShmxTndLAELAF5021_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABShmxTndLAELAF5021_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```


## UAS and env detailed measurements - spectral level time-series

### Working correlation structure selection

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABDt5i.GEE <- glmtoolbox::glmgee(dAnnoyance ~ Detect0p5IntMaxLRLog,
                                             data=subjDataNoAmb, family=gaussian(link='identity'),
                                             id=ID., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### Detectability model

```{r}

model2 <- mABDt5i1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                                    I(UASEvents^-1) +
                                                                    Detect0p5IntMaxLRLog,
                                                                 data=subjDataNoAmb, family=gaussian(link='identity'),
                                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p5IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

```

### Detectability^2 model

```{r}

model2 <- mABDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                          I(UASEvents^-1) +
                                                          Detect0p5IntMaxLRLog +
                                                          I(Detect0p5IntMaxLRLog^2),
                                                         data=subjDataNoAmb, family=gaussian(link='identity'),
                                                         id=ID., corstr='exchangeable')


geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE, mABDt5i21_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p5IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")


predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+


```


### with fluctuation strength, impulsiveness and sharpness

```{r}

model2 <- mABFIShmDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASFluctOV10ExMaxLR +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p5IntMaxLRLog + I(Detect0p5IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p5IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

#### 0.1 s averaging

```{r}

model2 <- mABFIShmDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASFluctOV10ExMaxLR +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE)

```

### add back tonal loudness

```{r}

model2 <- mABFIShmTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASFluctOV10ExMaxLR +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


# plot correlation between detectability and UAS tonal loudness in stimDataNoAmb

corVal <- cor(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$UASTonLdECMAPowAvgBin)
pVal <- cor.test(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$UASTonLdECMAPowAvgBin)$p.value

ggplot(data=stimDataNoAmb) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12)) +
  
  geom_point(aes(x=Detect0p1IntMaxLRLog, y=UASTonLdECMAPowAvgBin), colour=mycolours[2], size=2.5, shape=2, alpha=0.5) +
  
  scale_x_continuous(breaks=seq(1, 7, by=1), limits=c(0.5, 7)) +
  scale_y_continuous(breaks=seq(0, 2, by=0.25), limits=c(0, 2)) +
  
  labs(x="UAS lg(detectability)", y="UAS tonal loudness (Sottek), sone") +
  # add Pearson correlation text to the plot
  annotate("text", x=1, y=1.75, label=deparse(bquote(italic(r)==.(round(corVal, 3)))), parse=TRUE, size=4, family='serif', hjust=0) +
  # add p-value text to the plot
  if (pVal >= 0.001){
    annotate("text", x=1, y=1.625, label=deparse(bquote(italic(p)==.(round(pVal, 3)))), parse=TRUE, size=4, family='serif', hjust=0)
  } else {
    annotate("text", x=1, y=1.625, label="(italic(p) < 0.001)", parse=TRUE, size=4, family='serif', hjust=0)
  }



corVal <- cor(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$UASTonalECMAAvgMaxLR)
pVal <- cor.test(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$UASTonalECMAAvgMaxLR)$p.value

ggplot(data=stimDataNoAmb) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12)) +
  
  geom_point(aes(x=Detect0p1IntMaxLRLog, y=UASTonalECMAAvgMaxLR), colour=mycolours[3], size=2.5, shape=3, alpha=0.5) +
  
  scale_x_continuous(breaks=seq(1, 7, by=1), limits=c(0.5, 7)) +
  scale_y_continuous(breaks=seq(0, 0.25, by=0.025), limits=c(0, 0.25)) +
  
  labs(x="UAS lg(detectability)", y="UAS tonality (Sottek), tu") +
  # add Pearson correlation text to the plot
  annotate("text", x=1, y=0.2125, label=deparse(bquote(italic(r)==.(round(corVal, 3)))), parse=TRUE, size=4, family='serif', hjust=0) +
  # add p-value text to the plot
  if (pVal >= 0.001){
    annotate("text", x=1, y=0.2, label=deparse(bquote(italic(p)==.(round(pVal, 3)))), parse=TRUE, size=4, family='serif', hjust=0)
  } else {
    annotate("text", x=1, y=0.2, label="(italic(p) < 0.001)", parse=TRUE, size=4, family='serif', hjust=0)
  }



corVal <- cor(stimDataNoAmb$UASLAEMaxLR, stimDataNoAmb$UASTonLdECMAPowAvgBin)
pVal <- cor.test(stimDataNoAmb$UASLAEMaxLR, stimDataNoAmb$UASTonLdECMAPowAvgBin)$p.value

ggplot(data=stimDataNoAmb) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12)) +
  
  geom_point(aes(x=UASLAEMaxLR, y=UASTonLdECMAPowAvgBin), colour=mycolours[4], size=2.5, shape=4, alpha=0.5) +
  
  scale_y_continuous(breaks=seq(0, 2, by=0.25), limits=c(0, 2)) +
  scale_x_continuous(breaks=seq(55, 80, by=5), limits=c(55, 80)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="UAS tonal loudness") +
  # add Pearson correlation text to the plot
  annotate("text", x=56, y=1.75, label=deparse(bquote(italic(r)==.(round(corVal, 3)))), parse=TRUE, size=4, family='serif', hjust=0) +
  # add p-value text to the plot
  if (pVal >= 0.001){
    annotate("text", x=56, y=1.625, label=deparse(bquote(italic(p)==.(round(pVal, 3)))), parse=TRUE, size=4, family='serif', hjust=0)
  } else {
    annotate("text", x=56, y=1.625, label="(italic(p) < 0.001)", parse=TRUE, size=4, family='serif', hjust=0)
  }

```

### tonal loudness interacting with sharpness

```{r}

model2 <- mABFIShmxTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASFluctOV10ExMaxLR +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### tonal loudness and sharpness interaction, no impulsiveness

```{r}

model2 <- mABFShmxTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASFluctOV10ExMaxLR +
                                                     UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### tonal loudness and sharpness interaction, no fluctuation strength

```{r}

model2 <- mABIShmxTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### tonal loudness and sharpness interaction, no fluctuation strength or impulsiveness

```{r}

model2 <- mABShmxTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### only sharpness

```{r}

model2 <- mABShmDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### sharpness and fluctuation strength

```{r}

model2 <- mABFShmDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASFluctOV10ExMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### sharpness and impulsiveness

```{r}

model2 <- mABIShmDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### add intermittency

```{r}

model2 <- mABFIShmDt1i2Ir1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                        UASFluctOV10ExMaxLR +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2) +
                                                      IntermitRatioMaxLR,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### only tonal loudness

```{r}

model2 <- mABTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                        UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE,
                    mABTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```


### tonal loudness, fluctuation strength, impulsiveness

```{r}

model2 <- mABFITnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                        UASFluctOV10ExMaxLR +
                                                     UASImpulsSHMAvgMaxLR +
                                                        UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2) +
                                                      IntermitRatioMaxLR,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE,
                    mABTnDt1i21_QSq.GEE, mABFITnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### tonal loudness, fluctuation strength

```{r}

model2 <- mABFTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                        UASFluctOV10ExMaxLR +
                                                        UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2) +
                                                      IntermitRatioMaxLR,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE,
                    mABTnDt1i21_QSq.GEE, mABFITnDt1i21_QSq.GEE,
                    mABFTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### impulsiveness, sharpness and tonal loudness (no interaction)

```{r}

model2 <- mABIShmTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                     UASImpulsSHMAvgMaxLR +
                                                     UASSharpAurSHM05ExMaxLR +
                                                     UASTonLdECMAPowAvgBin +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2) +
                                                      IntermitRatioMaxLR,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE,
                    mABTnDt1i21_QSq.GEE, mABFITnDt1i21_QSq.GEE,
                    mABFTnDt1i21_QSq.GEE, mABIShmTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### ...

```{r}

model2 <- mABShmxTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                        UASTonLdECMAPowAvgBin +
                                                      Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2) +
                                                     I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE,
                    mABTnDt1i21_QSq.GEE, mABFITnDt1i21_QSq.GEE,
                    mABFTnDt1i21_QSq.GEE, mABIShmTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABFIShmDt1i21_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABFIShmDt1i21_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### examine stepwise-selected model

```{r}


model2 <- mABFDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~  TrialNumberCntScl +
                                                        UASFluctOV10ExMaxLR +
                                                     I(UASEvents^-1) +
                                                     Detect0p1IntMaxLRLog + I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABDt5i1_QSq.GEE,
                    mABDt5i21_QSq.GEE, mABFIShmDt5i21_QSq.GEE,
                    mABFIShmDt1i21_QSq.GEE, mABFIShmTnDt1i21_QSq.GEE,
                    mABFIShmxTnDt1i21_QSq.GEE, mABFShmxTnDt1i21_QSq.GEE,
                    mABIShmxTnDt1i21_QSq.GEE, mABShmxTnDt1i21_QSq.GEE,
                    mABShmDt1i21_QSq.GEE, mABFShmDt1i21_QSq.GEE,
                    mABIShmDt1i21_QSq.GEE, mABFIShmDt1i2Ir1_QSq.GEE,
                    mABTnDt1i21_QSq.GEE, mABFITnDt1i21_QSq.GEE,
                    mABFTnDt1i21_QSq.GEE, mABIShmTnDt1i21_QSq.GEE,
                    mABFDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")


model2predict <- ggeffects::predict_response(model2, terms=c("UASFluctOV10ExMaxLR [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=UASFluctOV10ExMaxLR, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=UASFluctOV10ExMaxLR, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x=expression(paste(UAS~italic(F)["10"]~","~vacil)), y="Change in annoyance")


predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


```

### Reconfirm working correlation structure selection with stepwise-selected model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABFDt1i21_QSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```


## UAS and env detailed measurements - SQMs/audio

### with dI, dShm*dTn

```{r}

model2 <- mABdIdSxdTnDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ dImpulsSHMAvgMaxLR +
                                                          TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             Detect0p5IntMaxLRLog +
                                                           I(Detect0p5IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE)


```

#### 0.1 s averaging

```{r}

model2 <- mABdIdSxdTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ dImpulsSHMAvgMaxLR +
                                                          TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurISO3PowAvgMaxLR [0.4, 0.6, 0.8]",
                                                             "dTonLdECMAPowAvgBin [0.48, 1.08]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.4, text = element_text(family = "serif")) +
  
  # geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  # geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_x_continuous(sec.axis = sec_axis(~ . , name = expression(paste(Tonal~loudness~diff.,",",~Delta,sone)), breaks = NULL, labels = NULL)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='cividis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='cividis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  

  guides(shape=guide_legend(title="UAS events", reverse=TRUE),
         colour=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE),
         fill=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance") +
  facet_grid(cols = vars(facet))
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```

### omit dI

```{r}

model2 <- mABdSxdTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurISO3PowAvgMaxLR [0.4, 0.6, 0.8]",
                                                             "dTonLdECMAPowAvgBin [0.48, 1.08]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.4, text = element_text(family = "serif")) +
  
  # geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +
  
  # geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_x_continuous(sec.axis = sec_axis(~ . , name = expression(paste(Tonal~loudness~diff.,",",~Delta,sone)), breaks = NULL, labels = NULL)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  scale_color_viridis(option='cividis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  scale_fill_viridis(option='cividis', direction=1, discrete=TRUE, begin = 0.1, end = 0.9) +
  

  guides(shape=guide_legend(title="UAS events", reverse=TRUE),
         colour=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE),
         fill=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance") +
  facet_grid(cols = vars(facet))
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### omit dS*Tn interaction

```{r}

model2 <- mABdSdTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE,
                    mABdSdTnDt1i21_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### w/ dF

```{r}

model2 <- mABdFdSdTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dFluctSHM05ExBin +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE,
                    mABdSdTnDt1i21_QSq.GEE, mABdFdSdTnDt1i21_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### check sharpness model

```{r}

model2 <- mABdShmxdTnDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurSHM05ExMaxLR*dTonLdECMAPowAvgBin +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE,
                    mABdSdTnDt1i21_QSq.GEE, mABdFdSdTnDt1i21_QSq.GEE,
                    mABdShmxdTnDt1i21_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### check best performing with LAELAF50diff

```{r}

model2 <- mABdShmxdTndLAELAF5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurSHM05ExMaxLR*dTonLdECMAPowAvgBin +
                                                             LAELAF50diff +
                                                           I(LAELAF50diff^2),
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE,
                    mABdSdTnDt1i21_QSq.GEE, mABdFdSdTnDt1i21_QSq.GEE,
                    mABdShmxdTnDt1i21_QSq.GEE, mABdShmxdTndLAELAF5021_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~italic(L)[AF50],",",~dB)), y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### check best performing with partial loudness

```{r}

model2 <- mABdShmxdTndN1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurSHM05ExMaxLR*dTonLdECMAPowAvgBin +
                                                             PartLoudMGSTPowAvg,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE,
                    mABdSdTnDt1i21_QSq.GEE, mABdFdSdTnDt1i21_QSq.GEE,
                    mABdShmxdTnDt1i21_QSq.GEE, mABdShmxdTndLAELAF5021_QSq.GEE,
                    mABdShmxdTndN1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGSTPowAvg [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=PartLoudMGSTPowAvg, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=PartLoudMGSTPowAvg, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x=expression(paste(Moore,"-",Glasberg~Delta~italic(N)[st]^"*"~","~sone)), y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### check best performing with log partial loudness

```{r}

model2 <- mABdShmxdTndN1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurSHM05ExMaxLR*dTonLdECMAPowAvgBin +
                                                             PartLoudMGSTPowAvgLog,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, mABdIdSxdTnDt5i21_QSq.GEE,
                    mABdIdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSq.GEE,
                    mABdSdTnDt1i21_QSq.GEE, mABdFdSdTnDt1i21_QSq.GEE,
                    mABdShmxdTnDt1i21_QSq.GEE, mABdShmxdTndLAELAF5021_QSq.GEE,
                    mABdShmxdTndN1_QSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGSTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type='bias-corrected'))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=PartLoudMGSTPowAvgLog, y=dAnnoyance, shape=factor(UASEvents)), colour='darkgrey', size=0.3, alpha=0.1, height=0.05, width=0.35) +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.15) +
  
  geom_line(aes(x=x, y=predicted), linewidth=0.5) +
  
  geom_point(data=stimDataNoAmb, aes(x=PartLoudMGSTPowAvgLog, y=dAnnoyMean, shape=factor(UASEvents)), alpha=0.35) +
  
  scale_shape_manual(values=c(2, 4, 5, 6)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +    
  labs(x=expression(paste(lg~"("~Moore,"-",Glasberg~Delta~italic(N)[st]^"*"~")"~","~sone)), y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdSxdTnDt1i21_QSq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```


## UAS w/ env detailed including env class
### best performing

Adds no useful information to the model

```{r}

model2 <- mABdSxdTnDt1i21_QSqEnv.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2) +
                                                            AmbientEnv,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, 
                    mABdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, colour=AmbientEnv, shape=AmbientEnv), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
    
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.45) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```

### substitute partial loudness

```{r}

model2 <- mABdSxdTndN1_QSqEnv.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             PartLoudMGLTPowAvg +
                                                            AmbientEnv,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, 
                    mABdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSqEnv.GEE,
                    mABdSxdTndN1_QSqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dAnnoyance, colour=AmbientEnv, shape=AmbientEnv), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
    
  geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.45) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  labs(x="Partial loudness (Moore-Glasberg), sone", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```

### partial loudness env interaction

```{r}

model2 <- mABdSxdTn1_QSqdNxEnv.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             PartLoudMGLTPowAvg*AmbientEnv,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, 
                    mABdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSqEnv.GEE,
                    mABdSxdTndN1_QSqEnv.GEE, mABdSxdTn1_QSqdNxEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dAnnoyance, colour=AmbientEnv, shape=AmbientEnv), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
    
  geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.45) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  labs(x="Partial loudness (Moore-Glasberg), sone", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```

### detectability with tonal loudness diff env interaction

```{r}

model2 <- mABdSxdTnxEnvDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             dTonLdECMAPowAvgBin:AmbientEnv +
                                                             Detect0p1IntMaxLRLog +
                                                           I(Detect0p1IntMaxLRLog^2) +
                                                            AmbientEnv,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, 
                    mABdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSqEnv.GEE,
                    mABdSxdTndN1_QSqEnv.GEE, mABdSxdTn1_QSqdNxEnv.GEE,
                    mABdSxdTnxEnvDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, colour=AmbientEnv, shape=AmbientEnv), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
    
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.45) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```

### detectability with env interaction

```{r}

model2 <- mABdSxdTnEnvxDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             dTonLdECMAPowAvgBin:AmbientEnv +
                                                             Detect0p1IntMaxLRLog*AmbientEnv +
                                                           I(Detect0p1IntMaxLRLog^2)*AmbientEnv +
                                                            AmbientEnv,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, 
                    mABdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSqEnv.GEE,
                    mABdSxdTndN1_QSqEnv.GEE, mABdSxdTn1_QSqdNxEnv.GEE,
                    mABdSxdTnxEnvDt1i21_QSq.GEE, mABdSxdTnEnvxDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, colour=AmbientEnv, shape=AmbientEnv), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
    
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.45) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```

### detectability with (linear) env interaction

```{r}

model2 <- mABdSxdTnEnvxDt1i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ TrialNumberCntScl +
                                                           I(UASEvents^-1) +
                                                           dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                             dTonLdECMAPowAvgBin:AmbientEnv +
                                                             Detect0p1IntMaxLRLog*AmbientEnv +
                                                           I(Detect0p1IntMaxLRLog^2) +
                                                            AmbientEnv,
                                                     data=subjDataNoAmb, family=gaussian(link='identity'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABTypeOpxLAExEnv1_QSq.GEE, 
                    mABdSxdTnDt1i21_QSq.GEE, mABdSxdTnDt1i21_QSqEnv.GEE,
                    mABdSxdTndN1_QSqEnv.GEE, mABdSxdTn1_QSqdNxEnv.GEE,
                    mABdSxdTnxEnvDt1i21_QSq.GEE, mABdSxdTnEnvxDt1i21_QSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "AmbientEnv",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

set.seed(808)

ggplot(data=model2predict) +
  
  theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
  
  geom_jitter(data=subjDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyance, colour=AmbientEnv, shape=AmbientEnv), size=0.3, alpha=0.05, height=0.05, width=0.35) +
  
  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  scale_shape_manual(values=c(1, 3), guide = guide_legend(reverse = FALSE, title = "Amb. env. (exp.)")) +
  
  ggnewscale::new_scale_colour() +
  
  geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
  
  geom_line(aes(x=x, y=predicted, colour=group), linewidth=0.5) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  scale_fill_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (pred.)")) +
  
  ggnewscale::new_scale_colour() +
    
  geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dAnnoyMean, colour=AmbientEnv, shape=AmbientEnv), alpha=0.45) +

  scale_color_viridis(option='magma', direction=1, discrete=TRUE, begin = 0.2, end = 0.7, guide = guide_legend(reverse = TRUE, title = "Amb. env. (exp.)")) +
  
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +

  labs(x="UAS lg(detectability)", y="Change in annoyance")
  

predictMeans <- predictNew(model=model2, newData=stimDataNoAmb,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)), response=stimDataNoAmb$dAnnoyMean)

r2mean <- cor(predictMeans$response, predictMeans$fit)^2

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance") #+
  # add Rsquared text to the plot
  # annotate("text", x=1, y=8, label=deparse(bquote(italic(R)^2==.(round(r2mean, 3)))), parse=TRUE, size=4, family='serif', hjust=0)


```
### Check working correlation structure selection with maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABdSxdTnDt1i21_QSqEnv.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  geeModelPerformance(model1, verbose=TRUE)

}

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdSxdTnDt1i21_QSqEnv.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```


# Highly annoyed

## Categorical models

### Working correlation structure (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABHLAETypeOpEnvQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR + UASType +
                                                        UASOperation + AmbientEnv + UASEvents + TrialNumberCntScl,
                                                        data=subjDataNoAmb, family=binomial(link='logit'),
                                                        id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### Comparison between GEE-PA and GLMM-SS models with only LAE predictor

#### Timing comparison

```{r}

set.seed(808)

newData <- data.frame(UASLAEMaxLR=seq(55, 100, by=1))
# benchmark timing
testHA <- microbenchmark::microbenchmark(
  
    'GLMM_model' = {model0GLMM <- lme4::glmer(dHighAnnoy ~ UASLAEMaxLR + (1 + UASLAEMaxLR | ID.),
                                                  data=subjDataNoAmb, family=binomial(link='logit'), control=glmcontrol)},
    
    'GEE_model' = {model0GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR,
                                                data=subjDataNoAmb, family=binomial(link='logit'),
                                                id=ID., corstr='exchangeable')},
    
    'GLMMperformance' = {
                        PCP <- glmmPCP(model0GLMM)
                        print(cbind(performance::model_performance(model0GLMM, metrics=c("AICc", "BIC", "R2")), PCP))
                        },
    
    'GEE_performance' = {geeModelPerformance(model0GEE, verbose=TRUE)},
    
    'GLMM_prediction' = {model0GLMMpredict2 <- data.frame(x=newData, fit=predict(model0GLMM, newdata=newData, type='response',
                                  re.form=NA, se.fit=FALSE, allow.new.levels=TRUE))},
    
    'GEE_prediction' = {model0GEEpredict2 <- cbind(data.frame(x=newData), as.data.frame(predict(model0GEE, newdata=newData, type='response',
                                       se.fit=FALSE, varest='bias-corrected')))},
    times=5, unit='s', control=list(order='inorder'))

testHA

glmmVsGEEHA <- data.frame(model=summary(testHA)[1,]$median/summary(testHA)[2,]$median,
                          metrics=summary(testHA)[3,]$median/summary(testHA)[4,]$median,
                          pred=summary(testHA)[5,]$median/summary(testHA)[6,]$median,
                          total=sum(summary(testHA)[1,]$median, summary(testHA)[3,]$median, summary(testHA)[5,]$median)/
                                sum(summary(testHA)[2,]$median, summary(testHA)[4,]$median, summary(testHA)[6,]$median))

print(paste("Model:", glmmVsGEEHA$model))
print(paste("Metrics:", glmmVsGEEHA$metrics))
print(paste("Prediction:", glmmVsGEEHA$pred))
print(paste("Total:", glmmVsGEEHA$total))

microbenchmark:::autoplot.microbenchmark(testHA)
microbenchmark:::boxplot.microbenchmark(testHA)


```

#### Plot comparison

```{r}

set.seed(808)

newData <- data.frame(UASLAEMaxLR=seq(55, 100, by=1))

mABHLAE.LAE <- lme4::glmer(dHighAnnoy ~ UASLAEMaxLR + (1 + UASLAEMaxLR | ID.),
                            data=subjDataNoAmb, family=binomial(link='logit'), control=glmcontrol)

mABHLAE.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR,
                                  data=subjDataNoAmb, family=binomial(link='logit'),
                                  id=ID., corstr='exchangeable')

PCP <- glmmPCP(mABHLAE.LAE)
print(cbind(performance::model_performance(mABHLAE.LAE, metrics=c("AICc", "BIC", "R2")), PCP))

geeModelPerformance(mABHLAE.GEE)

mABHLAE.LAEpredict2 <- data.frame(x=newData, fit=predict(mABHLAE.LAE, newdata=newData, type='response',
                              re.form=NA, se.fit=FALSE, allow.new.levels=TRUE))

mABHLAE.GEEpredict2 <- cbind(data.frame(x=newData), as.data.frame(predict(mABHLAE.GEE, newdata=newData, type='response',
                                   se.fit=FALSE, varest='bias-corrected')))

mABHLAE.LAEpredictAll <- ggeffects::predict_response(mABHLAE.LAE, terms=c("UASLAEMaxLR [55:100]", "ID. [all]"),
                                             type='response', margin='empirical',
                                             bias_correction=TRUE)

p <- ggplot() +
  theme(panel.grid = element_blank(), aspect.ratio=1.35,
        text = element_text(family = "serif"),
        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm")) #+

  # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp),
  #            alpha=0.15)

for (id in unique(mABHLAE.LAEpredictAll$group)){
  p <- p + geom_line(data=mABHLAE.LAEpredictAll[mABHLAE.LAEpredictAll$group==id,], mapping=aes(x=x, y=predicted, colour="GLMM (CS)"), alpha=0.1, linewidth=0.25)
}

p <- p + 
  geom_line(data=mABHLAE.LAEpredict2, mapping=aes(x=UASLAEMaxLR, y=fit, colour="GLMM (CS)"), linewidth=1) +
  
  geom_line(data=mABHLAE.GEEpredict2, aes(x=UASLAEMaxLR, y=fit, colour="GEE (PA)"), linewidth=1) +
  
  scale_x_continuous(breaks=seq(55, 100, by=5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
  scale_colour_manual(values=c("GLMM (CS)"=mycolours[1], "GEE (PA)"=mycolours[2])) +

  guides(colour=guide_legend(title="Method", reverse=TRUE), fill=guide_legend(title="Method", reverse=TRUE)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p

filename <- "PtsABHighAnnoyGLMMVsGEE"

if (saveplots){
  ggsave(filename=paste(filename, ".svg", sep=""), width=4.5, height=4, path=file.path(outFigPath, "svg"))
  unlink(paste(filename, ".svg", sep=""))
  
  ggsave(filename=paste(filename, ".pdf", sep=""), width=4.5, height=4, path=file.path(outFigPath, "pdf"))
  unlink(paste(filename, ".pdf", sep=""))
}


```

### Simple model, no trial sequence, standard events

```{r, fig.width=12, fig.height=5}

model2 <- mABHLAETypeOpEnvQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR + UASType +
                                                  UASOperation + AmbientEnv + UASEvents,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnvQ.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p


```


### with reciprocal events

```{r, fig.width=12, fig.height=5}

model2 <- mABHLAETypeOpEnv1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR + UASType +
                                                  UASOperation + AmbientEnv + I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnvQ.GEE, mABHLAETypeOpEnv1_Q.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p


```

### with trial sequence

```{r}

model2 <- mABHLAETypeOpEnvQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR + UASType +
                                                  UASOperation + AmbientEnv + UASEvents + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnvQ.GEE, mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnvQSq.GEE)



```

### reciprocal events and trial sequence

```{r}

model2 <- mABHLAETypeOpEnv1_QSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR + UASType +
                                                  UASOperation + AmbientEnv +
                                                    I(UASEvents^-1) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnvQ.GEE, mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnvQSq.GEE,
                    mABHLAETypeOpEnv1_QSq.GEE)



```

### with type op interaction

```{r}

model2 <- mABHLAETypexOpEnvQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR +
                                                            UASType*UASOperation +
                                                            AmbientEnv + UASEvents,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnvQ.GEE, mABHLAETypeOpEnvQSq.GEE,
                    mABHLAETypexOpEnvQ.GEE)



```

### with type op interaction, reciprocal events

```{r}

model2 <- mABHLAETypexOpEnv1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLR +
                                                            UASType*UASOperation +
                                                            AmbientEnv + I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnvQ.GEE, mABHLAETypeOpEnvQSq.GEE,
                    mABHLAETypexOpEnvQ.GEE, mABHLAETypexOpEnv1_Q.GEE)



```

#### with LAE env interaction

```{r}

model2 <- mABHTypeOpLAExEnv1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType + UASOperation +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnvQSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE)



```

#### with LAE env and type op interaction

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypexOpLAExEnv1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType*UASOperation +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnvQSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE)


model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p


```

#### with LAE env and type op interaction

```{r}

model2 <- mABHTypexOpxEnvxLAE1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType*UASOperation +
                                                               UASOperation:AmbientEnv +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnvQSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE)



```

#### with LAE env and op interaction

```{r}

model2 <- mABHTypeOpxEnvxLAE1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*AmbientEnv +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE)



```

#### with LAE env and op interaction

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-1),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE)


model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))


p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p


```

##### events standard

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnvQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             UASEvents,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p


```

##### events standard and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnvQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             UASEvents + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") #+

```

##### events reciprocal and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_QSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-1) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.5 and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_QrtSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.5) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.25 and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_Q4rtSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.25) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q4rtSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))
p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.75 and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv3_Q4rtSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.75) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q4rtSq.GEE, mABHTypeOpxLAExEnv3_Q4rtSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))
p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.125 and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_Q8Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.125) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q4rtSq.GEE, mABHTypeOpxLAExEnv3_Q4rtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q8Sq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.0625 and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q4rtSq.GEE, mABHTypeOpxLAExEnv3_Q4rtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q8Sq.GEE, mABHTypeOpxLAExEnv1_Q16Sq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.03125 and with trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_Q32Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.03125) + TrialNumberCntScl,
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q4rtSq.GEE, mABHTypeOpxLAExEnv3_Q4rtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q8Sq.GEE, mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHTypeOpxLAExEnv1_Q32Sq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))
p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

##### events curvilinear ^-0.0625, no trial sequence

```{r, fig.width=16, fig.height=5}

model2 <- mABHTypeOpxLAExEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASType +
                                                               UASOperation*UASLAEMaxLR +
                                                            UASLAEMaxLR*AmbientEnv +
                                                             I(UASEvents^-0.0625),
                                                     data=subjDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHLAETypeOpEnv1_Q.GEE, mABHLAETypeOpEnv1_QSq.GEE,
                    mABHLAETypexOpEnv1_Q.GEE, mABHTypeOpLAExEnv1_Q.GEE,
                    mABHTypexOpLAExEnv1_Q.GEE, mABHTypexOpxEnvxLAE1_Q.GEE,
                    mABHTypeOpxEnvxLAE1_Q.GEE, mABHTypeOpxLAExEnv1_Q.GEE,
                    mABHTypeOpxLAExEnvQ.GEE, mABHTypeOpxLAExEnvQSq.GEE,
                    mABHTypeOpxLAExEnv1_QSq.GEE, mABHTypeOpxLAExEnv1_QrtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q4rtSq.GEE, mABHTypeOpxLAExEnv3_Q4rtSq.GEE,
                    mABHTypeOpxLAExEnv1_Q8Sq.GEE, mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHTypeOpxLAExEnv1_Q32Sq.GEE, mABHTypeOpxLAExEnv1_Q16.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]"),
                                                 type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                               "UASOperation [all]",
                                                                 "UASEvents [1]"),
                                               type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predictEvt <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]",
                                                         "UASEvents [all]",
                                                         "AmbientEnv [Park]",
                                                         "UASOperation [Flyover]"),
                                                type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif"), legend.title=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")


p4 <- ggplot(data=model2predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLR, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(2, 4, 5, 6)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% Highly annoyed")

p <- cowplot::plot_grid(p1, p2, p3, p4, ncol=4, nrow=1)

p

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHTypeOpxLAExEnv1_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

## Comparison loudness models

### working correlation structure

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABHN.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin,
                                            data=subjDataNoAmb, family=binomial(link='logit'),
                                            id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

### basic

```{r}

model2 <- mABHN.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin,
                                         data=subjDataNoAmb, family=binomial(link='logit'),
                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE)

```

```{r}

model2 <- mABHNhm.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin,
                                         data=subjDataNoAmb, family=binomial(link='logit'),
                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE)

```

### with env

```{r}

model2 <- mABHNEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin +
                                              AmbientEnv,
                                               data=subjDataNoAmb, family=binomial(link='logit'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNEnv.GEE)

```

### with events

```{r}

model2 <- mABHNEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin +
                                              AmbientEnv + I(UASEvents^-0.0625),
                                               data=subjDataNoAmb, family=binomial(link='logit'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNEnv.GEE,
                    mABHNEnv1_Q16.GEE)

```

### with events and trial sequence

```{r}

model2 <- mABHNEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin +
                                              AmbientEnv + I(UASEvents^-0.0625) +
                                                TrialNumberCnt,
                                               data=subjDataNoAmb, family=binomial(link='logit'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNEnv.GEE,
                    mABHNEnv1_Q16.GEE, mABHNEnv1_Q16Sq.GEE)

```

### with env loudness interaction

```{r}

model2 <- mABHNxEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin*AmbientEnv +
                                                      I(UASEvents^-0.0625) + TrialNumberCntScl,
                                               data=subjDataNoAmb, family=binomial(link='logit'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNEnv.GEE,
                    mABHNEnv1_Q16.GEE, mABHNEnv1_Q16Sq.GEE, mABHNxEnv1_Q16Sq.GEE)

```

### with env loudness interaction, no trial sequence

```{r}

model2 <- mABHNxEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin*AmbientEnv +
                                                      I(UASEvents^-0.0625),
                                               data=subjDataNoAmb, family=binomial(link='logit'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNEnv.GEE,
                    mABHNEnv1_Q16.GEE, mABHNEnv1_Q16Sq.GEE, mABHNxEnv1_Q16Sq.GEE,
                    mABHNxEnv1_Q16.GEE)

```

### with env loudness interaction, no trial sequence

```{r}

model2 <- mABHNhmxEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                      I(UASEvents^-0.0625),
                                               data=subjDataNoAmb, family=binomial(link='logit'),
                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNEnv.GEE,
                    mABHNEnv1_Q16.GEE, mABHNEnv1_Q16Sq.GEE, mABHNxEnv1_Q16Sq.GEE,
                    mABHNxEnv1_Q16.GEE, mABHNhmxEnv1_Q16.GEE)

```

### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHNhmxEnv1_Q16.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

## UAS info only

### with sharpness and tonal loudness

```{r}

model2 <- mABHSTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                  UASTonLdECMAPowAvgBin + UASSharpAurISO305ExMaxLR +
                                                  I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                  family=binomial(link='logit'),
                                                  id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE)


```

### with sharpness and tonal loudness interaction

```{r}

model2 <- mABHSxTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                  UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                  I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                  family=binomial(link='logit'),
                                                  id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE)


```

### with fluctuation strength, sharpness and tonal loudness interaction

```{r}

model2 <- mABHFSxTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     UASFluctOV10ExMaxLR +
                                                  UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                  I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                  family=binomial(link='logit'),
                                                  id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE,
                    mABHFSxTnN1_Q16.GEE)


```

### with impulsiveness, sharpness and tonal loudness interaction

```{r}

model2 <- mABHISxTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     UASImpulsSHMPowAvgMaxLR +
                                                  UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                  I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                  family=binomial(link='logit'),
                                                  id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE,
                    mABHFSxTnN1_Q16.GEE, mABHISxTnN1_Q16.GEE)


```

#### with trial sequence

```{r}

model2 <- mABHISxTnN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                      UASImpulsSHMPowAvgMaxLR +
                                                      UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                      I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=binomial(link='logit'),
                                                      id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE,
                    mABHFSxTnN1_Q16.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnN1_Q16Sq.GEE)


```

#### check preferred sharpness

```{r}

model2 <- mABHIShmxTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                      UASImpulsSHMPowAvgMaxLR +
                                                    UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                    I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                    family=binomial(link='logit'),
                                                    id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE,
                    mABHFSxTnN1_Q16.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnN1_Q16Sq.GEE, mABHIShmxTnN1_Q16.GEE)

```

### with fluctuation strength and impulsiveness

```{r}

model2 <- mABHFISxTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                 UASFluctOV10ExMaxLR + UASImpulsSHMPowAvgMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE,
                    mABHFSxTnN1_Q16.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnN1_Q16Sq.GEE, mABHIShmxTnN1_Q16.GEE,
                    mABHFISxTnN1_Q16.GEE)


```

### with all SQMs

```{r}

model2 <- mABHFIRSxTnN1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                 UASFluctOV10ExMaxLR + UASImpulsSHMPowAvgMaxLR +
                                                   UASRoughFZ05ExMaxLR +
                                                   UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHN.GEE, mABHNhm.GEE, mABHNEnv.GEE,
                    mABHNhmxEnv1_Q16.GEE, mABHSTnN1_Q16.GEE, mABHSxTnN1_Q16.GEE,
                    mABHFSxTnN1_Q16.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnN1_Q16Sq.GEE, mABHIShmxTnN1_Q16.GEE,
                    mABHFISxTnN1_Q16.GEE, mABHFIRSxTnN1_Q16.GEE)


```

### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHISxTnN1_Q16.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHISxTnN1_Q16.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')


```

## UAS and env classification

### with impulsiveness, sharpness and tonal loudness interaction

```{r}

model2 <- mABHISxTnNxEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                       UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


```

### no impulsiveness

```{r}

model2 <- mABHSxTnNxEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')


geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


```

### with impulsiveness and fluctuation strength

```{r}

model2 <- mABHFISxTnNxEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                           UASFluctOV10ExMaxLR +
                                                          UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')


geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))



```

### with just fluctuation strength

```{r}

model2 <- mABHFSxTnNxEnv1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                           UASFluctOV10ExMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')


geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE, mABHFSxTnNxEnv1_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))

```

### with trial sequence

```{r}

model2 <- mABHISxTnNxEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                          UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE, mABHFSxTnNxEnv1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


```

### tonal loudness interaction with env

```{r}

model2 <- mABHISxTnxEnvNxEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                          UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE, mABHFSxTnNxEnv1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16Sq.GEE, mABHISxTnxEnvNxEnv1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


```

### env interaction with tonal loudness and sharpness 

```{r}

model2 <- mABHIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                          UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                           UASSharpAurISO305ExMaxLR:AmbientEnv +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE, mABHFSxTnNxEnv1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16Sq.GEE, mABHISxTnxEnvNxEnv1_Q16Sq.GEE,
                    mABHIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


```

### env interaction with tonal loudness, sharpness and impulsiveness 

```{r}

model2 <- mABHEnvxIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                          UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                           UASSharpAurISO305ExMaxLR:AmbientEnv +
                                                           UASImpulsSHMPowAvgMaxLR:AmbientEnv +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE, mABHFSxTnNxEnv1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16Sq.GEE, mABHISxTnxEnvNxEnv1_Q16Sq.GEE,
                    mABHIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE,
                    mABHEnvxIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

### Check working correlation structure for maximal model (unstructured throws NaN warnings)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')


```

### stepwise-selected model

```{r}

model2 <- mABHIEnvxSxTnxEnvNxEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*AmbientEnv +
                                                          UASImpulsSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                           UASTonLdECMAPowAvgBin:AmbientEnv +
                                                           UASSharpAurISO305ExMaxLR:AmbientEnv,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHISxTnN1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16.GEE, mABHSxTnNxEnv1_Q16.GEE,
                    mABHFISxTnNxEnv1_Q16.GEE, mABHFSxTnNxEnv1_Q16.GEE,
                    mABHISxTnNxEnv1_Q16Sq.GEE, mABHISxTnxEnvNxEnv1_Q16Sq.GEE,
                    mABHIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE,
                    mABHEnvxIEnvxSxTnxEnvNxEnv1_Q16Sq.GEE,
                    mABHIEnvxSxTnxEnvNxEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group
model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed") +
        facet_grid(cols = vars(AmbientEnv))


model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudECMAPowAvgBin [all]",
                                                             "UASSharpAurISO305ExMaxLR [1.6, 2.0, 2.4, 2.8]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

model2predict$UASSharpAurISO305ExMaxLR <- model2predict$group

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurISO305ExMaxLR),
                   shape=1, alpha=0.35, size=2) +
        
        scale_color_viridis(option='magma', discrete=FALSE, begin = 0.1, end = 0.8) +
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (exp.)", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +
  
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
        
        guides(colour=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE),
               fill=guide_legend(title="UAS Sharpness (Aures), acum (pred.)", reverse=TRUE)) +
      
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(Sottek)~sone)), y="% Highly annoyed")


predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


```

### Check working correlation structure for stepwise-selected model (unstructured throws NaN warnings)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHIEnvxSxTnxEnvNxEnv.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

## UAS and env level

### LAE LAF50 diff

#### working correlation structure

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABHdLAELAF50.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff,
                                            data=subjDataNoAmb, family=binomial(link='logit'),
                                            id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

#### with events

```{r}

model2 <- mABHdLAELAF501_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### curvilinear LAELAF50diff

```{r}

model2 <- mABHdLAELAF5021_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                 I(LAELAF50diff^2) +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with tonal loudness

```{r}

model2 <- mABHTndLAELAF501_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                 UASTonLdECMAPowAvgBin +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with sharpness

```{r}

model2 <- mABHSdLAELAF501_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                 UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with tonal loudness and sharpness

```{r}

model2 <- mABHSTndLAELAF501_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                 UASTonLdECMAPowAvgBin +
                                                 UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with tonal loudness and sharpness interaction

```{r}

model2 <- mABHSxTndLAELAF501_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE, mABHSxTndLAELAF501_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add impulsiveness

```{r}

model2 <- mABHISxTndLAELAF501_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                             UASImpulsSHMPowAvgMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE, mABHSxTndLAELAF501_Q16.GEE,
                    mABHISxTndLAELAF501_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add curvilinear LAELAF50diff

```{r}

model2 <- mABHSxTndLAELAF5021_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                             I(LAELAF50diff^2) +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE, mABHSxTndLAELAF501_Q16.GEE,
                    mABHISxTndLAELAF501_Q16.GEE, mABHSxTndLAELAF5021_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]",
                                                             "UASTonLdECMAPowAvgBin [0.5]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add fluctuation strength

```{r}

model2 <- mABHFSxTndLAELAF5021_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                             I(LAELAF50diff^2) +
                                                               UASFluctOV10ExMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE, mABHSxTndLAELAF501_Q16.GEE,
                    mABHISxTndLAELAF501_Q16.GEE, mABHSxTndLAELAF5021_Q16.GEE,
                    mABHFSxTndLAELAF5021_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]",
                                                             "UASTonLdECMAPowAvgBin [0.5]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with impulsiveness

```{r}

model2 <- mABHISxTndLAELAF5021_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                             I(LAELAF50diff^2) +
                                                               UASImpulsSHMPowAvgMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE, mABHSxTndLAELAF501_Q16.GEE,
                    mABHISxTndLAELAF501_Q16.GEE, mABHSxTndLAELAF5021_Q16.GEE,
                    mABHFSxTndLAELAF5021_Q16.GEE, mABHISxTndLAELAF5021_Q16.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]",
                                                             "UASTonLdECMAPowAvgBin [0.5]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### best performing with trial sequence

```{r}

model2 <- mABHSxTndLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                             I(LAELAF50diff^2) +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                 data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHdLAELAF50.GEE,
                    mABHdLAELAF501_Q16.GEE, mABHdLAELAF5021_Q16.GEE,
                    mABHTndLAELAF501_Q16.GEE, mABHSdLAELAF501_Q16.GEE,
                    mABHSTndLAELAF501_Q16.GEE, mABHSxTndLAELAF501_Q16.GEE,
                    mABHISxTndLAELAF501_Q16.GEE, mABHSxTndLAELAF5021_Q16.GEE,
                    mABHFSxTndLAELAF5021_Q16.GEE, mABHISxTndLAELAF5021_Q16.GEE,
                    mABHSxTndLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "UASEvents [all]",
                                                             "UASTonLdECMAPowAvgBin [0.5]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-Amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```


### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHSxTndLAELAF5021_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHSxTndLAELAF5021_Q16Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')


```

## UAS and env detailed measurements - spectral level time-series

### Detectability

#### working correlation structure

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABHDt1i.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog,
                                            data=subjDataNoAmb, family=binomial(link='logit'),
                                            id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

#### with events

```{r}

model2 <- mABHDt1i1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### detectability^2

```{r}

model2 <- mABHDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                 I(Detect0p1IntMaxLRLog^2) +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### detectability^2 with trial sequence

```{r}

model2 <- mABHDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                 I(Detect0p1IntMaxLRLog^2) +
                                                 I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                 data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHDt1i21_Q16Sq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### 1/detectability

```{r}

model2 <- mABH1_Dt1i1_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                 I(Detect0p1IntMaxLRLog^-1) +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABH1_Dt1i1_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with tonal loudness

```{r}

model2 <- mABHTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                 UASTonLdECMAPowAvgBin +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with tonal loudness and sharpness

```{r}

model2 <- mABHSTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                 UASTonLdECMAPowAvgBin +
                                                 UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### with tonal loudness and sharpness interaction

```{r}

model2 <- mABHSxTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add impulsiveness

```{r}

model2 <- mABHISxTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                        UASImpulsSHMPowAvgMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add fluctuation strength

```{r}

model2 <- mABHFSxTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                        UASFluctOV10ExMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add roughness

```{r}

model2 <- mABHRSxTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                        UASRoughFZ05ExMaxLR +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE, mABHRSxTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                            vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans',
                                             vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### check roughness

```{r}

model2 <- mABHRhmSxTnDt1i21_Q16.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                        UASRoughECMA10ExBin +
                                                 UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                 I(UASEvents^-0.0625), data=subjDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE, mABHRSxTnDt1i21_Q16.GEE,
                    mABHRhmSxTnDt1i21_Q16.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### best performing with trial sequence

```{r}

model2 <- mABHSxTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE, mABHRSxTnDt1i21_Q16.GEE,
                    mABHRhmSxTnDt1i21_Q16.GEE, mABHSxTnDt1i21_Q16Sq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### best performing with interaction detect*tonal loudness 

```{r}

model2 <- mABHSxTnxDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog*UASTonLdECMAPowAvgBin +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE, mABHRSxTnDt1i21_Q16.GEE,
                    mABHRhmSxTnDt1i21_Q16.GEE, mABHSxTnDt1i21_Q16Sq.GEE,
                    mABHSxTnxDt1i21_Q16Sq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### best performing with interaction detect*sharpness 

```{r}

model2 <- mABHTnxSxDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog*UASSharpAurISO305ExMaxLR +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE, mABHRSxTnDt1i21_Q16.GEE,
                    mABHRhmSxTnDt1i21_Q16.GEE, mABHSxTnDt1i21_Q16Sq.GEE,
                    mABHSxTnxDt1i21_Q16Sq.GEE, mABHTnxSxDt1i21_Q16Sq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### Check working correlation structure for maximal model (unstructured throws NaN warnings)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHSxTnxDt1i21_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHSxTnxDt1i21_Q16Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### examine stepwise-selected model


```{r}

model2 <- mABHSTnxDt1i1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog*UASTonLdECMAPowAvgBin +
                                                       UASSharpAurISO305ExMaxLR +
                                                       I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                       data=subjDataNoAmb,
                                                       family=binomial(link='logit'),
                                                       id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i21_Q16.GEE, mABH1_Dt1i1_Q16.GEE,
                    mABHTnDt1i21_Q16.GEE, mABHSTnDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16.GEE, mABHISxTnDt1i21_Q16.GEE,
                    mABHFSxTnDt1i21_Q16.GEE, mABHRSxTnDt1i21_Q16.GEE,
                    mABHRhmSxTnDt1i21_Q16.GEE, mABHSxTnDt1i21_Q16Sq.GEE,
                    mABHSxTnxDt1i21_Q16Sq.GEE, mABHSTnxDt1i1_Q16Sq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASEvents [all]",
                                                             "UASTonLdECMAPowAvgBin [1.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictTn <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictTn) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS events", reverse=TRUE),
               fill=guide_legend(title="UAS events", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS Tonal Loudness (Sottek), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```


### Check working correlation structure for step-wise-selected model (non-st-m singular and unstructured throws NaN warnings)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHSTnxDt1i1_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

## UAS and env detailed measurements - SQMs/audio

### Sharpness difference

```{r}

model2 <- mABHdShmDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### Roughness difference

```{r}

model2 <- mABHdRDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                         dRoughFZ10ExMaxLR +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dRoughFZ10ExMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dRoughFZ10ExMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dRoughFZ10ExMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Roughness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### Sharpness and tonal loudness difference

```{r}

model2 <- mABHdShmdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                         dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "Detect0p1IntMaxLRLog [1, 2, 3, 4, 5]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictdS$dSharpAurSHMPowAvgMaxLR <- model2predictdS$group

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.5, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=Detect0p1IntMaxLRLog,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +
  
        scale_color_viridis(option='cividis', discrete=FALSE, begin = 0.1, end = 0.8) +
        
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        ggnewscale::new_scale_colour() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='cividis', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_fill_viridis(option='cividis', discrete=TRUE, begin = 0.1, end = 0.8) +
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=FALSE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=FALSE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### Sharpness and tonal loudness difference interaction

```{r}

model2 <- mABHdShmxdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### Sharpness and tonal loudness difference without detectability

```{r}

model2 <- mABHdShmdTn1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~
                                                         dSharpAurSHMPowAvgMaxLR +
                                                           dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE)

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdRdShmdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdRhmdShmdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                           dRoughECMA10ExBin +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 



```

### fluctuation strength, roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdFdRdShmdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                           dFluctSHM10ExBin +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### impulsiveness, roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdRdShmdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### impulsiveness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdShmdTnDt1i21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ Detect0p1IntMaxLRLog +
                                                         I(Detect0p1IntMaxLRLog^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS lg(Detectability)", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with LAELAF50diff, impulsiveness, roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with EPNLLAeqdiff, impulsiveness, roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ EPNLLAeqdiff +
                                                         I(EPNLLAeqdiff^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("EPNLLAeqdiff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=EPNLLAeqdiff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~EPNL-amb.~italic(L)[Aeq],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with LAELAeqdiff, impulsiveness, roughness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAeqdiff +
                                                         I(LAELAeqdiff^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAeqdiff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0.1, 0.2, 0.3, 0.4, 0.5]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiff, y=dHighAnnoyProp,
                                           shape=factor(UASEvents),
                                           colour=dSharpAurSHMPowAvgMaxLR),
                   alpha=0.35, size=2) +
  
        scale_color_viridis(option='viridis', discrete=FALSE, begin = 0.1, end = 0.8) +  
  
        guides(colour=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
  
        ggnewscale::new_scale_colour() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(fill=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE),
               colour=guide_legend(title=expression(paste(Sharpness~diff.,",",~Delta,acum)), reverse=TRUE),
               shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[Aeq],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with LAELAF50diff, sharpness and tonal loudness difference interaction

```{r}

model2 <- mABHdShmxdTndLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with LAELAF50diff, roughness sharpness and tonal loudness difference

```{r}

model2 <- mABHdRdShmdTndLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with LAELAF50diff, impulsiveness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdShmdTndLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with partial loudness, roughness, impulsiveness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdRdShmdTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with log partial loudness, roughness, impulsiveness, sharpness and tonal loudness difference

```{r}

model2 <- mABHdIdRdShmdTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness with absolute SQMs sharpness and tonal loudness interaction

```{r}

model2 <- mABHSxTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                           UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASSharpAurISO305ExMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="UAS sharpness (Aures), acum", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### LAELAF50diff with impulsiveness absolute, sharpness and tonal loudness difference

```{r}

model2 <- mABHIdShmdTndLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           UASImpulsSHMPowAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```


### log partial loudness, with impulsiveness absolute, sharpness and tonal loudness difference

```{r}

model2 <- mABHIdShmdTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                           UASImpulsSHMPowAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### tonal loudness interaction with LAELAF50diff

```{r}

model2 <- mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                           dTonLdECMAPowAvgBin*LAELAF50diff +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "dSharpAurSHMPowAvgMaxLR [0]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")

```

### log partial loudness, with sharpness and tonal loudness difference interaction

```{r}

model2 <- mABHdShmxdTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp,
                                           colour=factor(UASEvents),
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           shape=factor(UASEvents)),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
 
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness, with absolute sharpness and tonal loudness interaction and fluctuation strength

```{r}

model2 <- mABHFSxTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                        UASFluctOV10ExMaxLR +
                                                          UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)[italic(T)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness, interaction with tonal loudness

```{r}

model2 <- mABHSTnxdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog*UASTonLdECMAPowAvgBin +
                                                          UASSharpAurISO305ExMaxLR +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)[italic(T)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness, impusiveness, and sharpness interaction with tonal loudness

```{r}

model2 <- mABHISxTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                        UASImpulsSHMAvgMaxLR +
                                                          UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)[italic(T)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness only

```{r}

model2 <- mABHdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness with tonal loudness

```{r}

model2 <- mABHTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                    UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)[italic(T)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness interaction with sharpness, and tonal loudness-sharpness interaction

```{r}

model2 <- mABHTnxSxdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog*UASSharpAurISO305ExMaxLR +
                                                    UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE, mABHTnxSxdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(ln,"(",Part.~loud.~italic(N)[lt]^"*"~")"~","~sone)), y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Ton.~loud.~italic(T)[italic(N)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### log partial loudness with sharpness diff, and tonal loudness-sharpness interaction

```{r}

model2 <- mABHSxTndSdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                    UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE, mABHTnxSxdN1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(ln,"(",Part.~loud.~italic(N)[lt]^"*"~")"~","~sone)), y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Ton.~loud.~italic(T)[italic(N)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### omit sharpness

```{r}

model2 <- mABHdSTndN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                         UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE, mABHTnxSxdN1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE, mABHdSTndN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(ln,"(",Part.~loud.~italic(N)[lt]^"*"~")"~","~sone)), y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Ton.~loud.~italic(T)[italic(N)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add roughness diff

```{r}

model2 <- mABHdRSxTndSdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                        dRoughFZ05ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE, mABHTnxSxdN1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE, mABHdSTndN1_Q16Sq.GEE,
                    mABHdRSxTndSdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(ln,"(",Part.~loud.~italic(N)[lt]^"*"~")"~","~sone)), y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Ton.~loud.~italic(T)[italic(N)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

#### add fluct. str. diff

```{r}

model2 <- mABHdFSxTndSdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                        dFluctSHM10ExBin +
                                                         dSharpAurSHMPowAvgMaxLR +
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE, mABHTnxSxdN1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE, mABHdSTndN1_Q16Sq.GEE,
                    mABHdRSxTndSdN1_Q16Sq.GEE, mABHdFSxTndSdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(ln,"(",Part.~loud.~italic(N)[lt]^"*"~")"~","~sone)), y="% Highly annoyed")

model2predict <- ggeffects::predict_response(model2, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_color_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='viridis', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(2, 4, 5, 6)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(shape=guide_legend(title="UAS events", reverse=TRUE)) +
        
        labs(x=expression(paste(Ton.~loud.~italic(T)[italic(N)]^"*"~","~sone)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.6)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### based on CRF VI analysis

```{r}

model2 <- mABHdSxdTndLAeqLAF90N1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAeqLAF90diff +
                                                                    UASLoudISO3PowAvgBin +
                                                               dSharpAurISO3PowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHIdShmdTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTnxdLAELAF5021_Q16Sq.GEE,
                    mABHdShmxdTndN1_Q16Sq.GEE,
                    mABHFSxTndN1_Q16Sq.GEE, mABHSTnxdN1_Q16Sq.GEE,
                    mABHISxTndN1_Q16Sq.GEE, mABHdN1_Q16Sq.GEE,
                    mABHTndN1_Q16Sq.GEE, mABHTnxSxdN1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE, mABHdSTndN1_Q16Sq.GEE,
                    mABHdRSxTndSdN1_Q16Sq.GEE, mABHdFSxTndSdN1_Q16Sq.GEE,
                    mABHdSxdTndLAeqLAF90N1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMAPowAvgBin [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dTonLdECMAPowAvgBin, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        labs(x=expression(paste(Delta~italic(T)[italic(N)]^"*"~","~sone)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurISO3PowAvgMaxLR [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurISO3PowAvgMaxLR, y=dHighAnnoyProp),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Delta~italic(S)^"*"~","~acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 


```

### Check working correlation structure for maximal model (non-stationary(1) and unstructured are singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHSxTndSdN1_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHSxTndSdN1_Q16Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')


```


## UAS and env detailed measurements with env - SQMs/audio

### log partial loudness model


```{r}

model2 <- mABHSxTndSdN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                             dSharpAurSHMPowAvgMaxLR +
                                                           UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) +
                                                        AmbientEnv +
                                                        TrialNumberCnt,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.2, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.2, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(ln,"(",Part.~loud.~italic(N)[lt]^"*"~")"~","~sone)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.2, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.2, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~Delta~italic(S)^"*"~","~acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### LAELAF50diff model

```{r}

model2 <- mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dImpulsSHMAvgMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHSxTndSdN1_Q16SqEnv.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### omit impulsiveness diff

```{r}

model2 <- mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### omit impulsiveness and roughness diff

```{r}

model2 <- mABHdShmdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### add fluctuation diff

```{r}

model2 <- mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dFluctSHM10ExBin +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### add fluctuation diff

```{r}

model2 <- mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dFluctOV10ExMaxLR +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR + dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### add sharpness tonal loudness diff interaction

```{r}

model2 <- mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                           dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### omit roughness

```{r}

model2 <- mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAF50diff +
                                                         I(LAELAF50diff^2) +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("LAELAF50diff [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=LAELAF50diff, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE]-amb.~italic(L)[AF50],",",~dB)), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### substitute log partial loudness

```{r}

model2 <- mABHdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvgLog +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvgLog [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvgLog, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### substitute partial loudness

```{r}

model2 <- mABHdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```


### with roughness diff

```{r}

model2 <- mABHdRdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                                  dRoughFZ10ExMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with impulsiveness diff

```{r}

model2 <- mABHdIdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                                  dImpulsSHMAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE, mABHDt1i.GEE,
                    mABHDt1i1_Q16.GEE, mABHDt1i21_Q16.GEE,
                    mABHSxTnDt1i21_Q16Sq.GEE, mABHdShmDt1i21_Q16Sq.GEE,
                    mABHdRDt1i21_Q16Sq.GEE, mABHdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdShmxdTnDt1i21_Q16Sq.GEE, mABHdShmdTn1_Q16Sq.GEE,
                    mABHdRdShmdTnDt1i21_Q16Sq.GEE, mABHdRhmdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdFdRdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTnDt1i21_Q16Sq.GEE,
                    mABHdIdShmdTnDt1i21_Q16Sq.GEE, mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndEPNLLAeq21_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAeq21_Q16Sq.GEE,
                    mABHdShmxdTndLAELAF5021_Q16Sq.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndN1_Q16Sq.GEE, mABHSxTndN1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with fluctuation strength absolute and impulsiveness diff

```{r}

model2 <- mABHFdIdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                                  UASFluctOV10ExMaxLR +
                                                                  dImpulsSHMAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with impulsiveness absolute

```{r}

model2 <- mABHIdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                                  UASImpulsSHMPowAvgMaxLR +
                                                         dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                         I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                           AmbientEnv,
                                                         data=subjDataNoAmb,
                                                         family=binomial(link='logit'),
                                                         id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with roughness difference and impulsiveness absolute

```{r}

model2 <- mABHIdRdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                               UASImpulsSHMPowAvgMaxLR +
                                                                 dRoughFZ10ExMaxLR +
                                                               dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                                 AmbientEnv,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### with sharpness and tonal loudness interaction

```{r}

model2 <- mABHSdShmxdTndN1_Q16SqEnv.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg +
                                                               UASImpulsSHMPowAvgMaxLR +
                                                                 dRoughFZ10ExMaxLR +
                                                                 UASSharpAurISO305ExMaxLR +
                                                               dSharpAurSHMPowAvgMaxLR*dTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl +
                                                                 AmbientEnv,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHSdShmxdTndN1_Q16SqEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLTPowAvg [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=PartLoudMGLTPowAvg, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x="Partial loudness (Moore-Glasberg), sone", y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 

```

### based on CRF VI analysis

#### loudness x env, F, dR, SxTn, dS

```{r}

model2 <- mABHFdRShmxTndShmNxEnv1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin*AmbientEnv +
                                                                  UASFluctOV10ExMaxLR +
                                                                 dRoughFZ05ExMaxLR +
                                                                 UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                                               dSharpAurSHMPowAvgMaxLR +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHSdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdRShmdShmxTnN1_Q16SqEnv.GEE,
                    mABHFdRShmxTndShmNxEnv1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*")), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 


```

#### loudness, F, dR, S, Tn x env, dSxTn

```{r}

model2 <- mABHFdRShmdShmxTnxEnvN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin +
                                                                  UASFluctOV10ExMaxLR +
                                                                 dRoughFZ05ExMaxLR +
                                                                 UASSharpAurSHM05ExMaxLR +
                                                                   UASTonLdECMAPowAvgBin*AmbientEnv +
                                                               dSharpAurSHMPowAvgMaxLR*UASTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHSdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdRShmdShmxTnN1_Q16SqEnv.GEE,
                    mABHFdRShmxTndShmNxEnv1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*")), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 


```

#### dN, N, F, dR, S, Tn x env, dSxTn

```{r}

model2 <- mABHFdRShmdShmxTnxEnvNdN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ PartLoudMGLTPowAvg + 
                                                                     UASLoudISO3PowAvgBin +
                                                                  UASFluctOV10ExMaxLR +
                                                                 dRoughFZ05ExMaxLR +
                                                                 UASSharpAurSHM05ExMaxLR +
                                                                   UASTonLdECMAPowAvgBin*AmbientEnv +
                                                               dSharpAurSHMPowAvgMaxLR*UASTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHSdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdRShmdShmxTnN1_Q16SqEnv.GEE,
                    mABHFdRShmxTndShmNxEnv1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvN1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvNdN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*")), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 


```

#### N, F, S, Tn x env, dSxTn

```{r}

model2 <- mABHFShmdShmxTnxEnvN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin +
                                                                  UASFluctOV10ExMaxLR +
                                                                 UASSharpAurSHM05ExMaxLR +
                                                                   UASTonLdECMAPowAvgBin*AmbientEnv +
                                                               dSharpAurSHMPowAvgMaxLR*UASTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHSdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdRShmdShmxTnN1_Q16SqEnv.GEE,
                    mABHFdRShmxTndShmNxEnv1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvN1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvNdN1_Q16Sq.GEE,
                    mABHFShmdShmxTnxEnvN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*")), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 


```

### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHFShmdShmxTnxEnvN1_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABHFShmdShmxTnxEnvN1_Q16Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')


```

### examine stepwise-selected model

```{r}

model2 <- mABHdShmxTnxEnvN1_Q16Sq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudISO3PowAvgBin +
                                                                   UASTonLdECMAPowAvgBin*AmbientEnv +
                                                               dSharpAurSHMPowAvgMaxLR*UASTonLdECMAPowAvgBin +
                                                               I(UASEvents^-0.0625) + TrialNumberCntScl,
                                                               data=subjDataNoAmb,
                                                               family=binomial(link='logit'),
                                                               id=ID., corstr='exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypeOpxLAExEnv1_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16Sq.GEE,
                    mABHdIdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdFovdRdShmdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdRdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndLAELAF5021_Q16SqEnv.GEE,
                    mABHdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdShmxdTndN1_Q16SqEnv.GEE,
                    mABHIdRdShmxdTndN1_Q16SqEnv.GEE,
                    mABHSdShmxdTndN1_Q16SqEnv.GEE,
                    mABHFdRShmdShmxTnN1_Q16SqEnv.GEE,
                    mABHFdRShmxTndShmNxEnv1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvN1_Q16Sq.GEE,
                    mABHFdRShmdShmxTnxEnvNdN1_Q16Sq.GEE,
                    mABHFShmdShmxTnxEnvN1_Q16Sq.GEE,
                    mABHdShmxTnxEnvN1_Q16Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [all]",
                                                             "AmbientEnv [all]",
                                                             "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +

        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*")), y="% Highly annoyed")

model2predictdS <- ggeffects::predict_response(model2, terms=c("dSharpAurSHMPowAvgMaxLR [all]",
                                                               "AmbientEnv [all]",
                                                               "UASEvents [1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predictdS) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp,
                                           colour=AmbientEnv,
                                           shape=AmbientEnv),
                   alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
 
        scale_color_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_fill_viridis(option='magma', discrete=TRUE, begin = 0.1, end = 0.8) +  
        scale_shape_manual(values=c(1, 3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
               fill=guide_legend(title="Amb. env.", reverse=TRUE),
               shape=guide_legend(title="Amb. env.", reverse=TRUE)) +
        
        labs(x=expression(paste(Sharpness~diff.,",",~Delta,acum)), y="% Highly annoyed")

predictProbs <- predictNew(model=model2, newData=stimDataNoAmb,
                          response=stimDataNoAmb$dHighAnnoyProp,
                          fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed") 




```

### Check working correlation structure for stepwise-selected model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABHdShmxTnxEnvN1_Q16Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

### ANOVA for stepwise-selected model

```{r}

anova(mABHdShmxTnxEnvN1_Q16Sq.GEE, test='score')

```

# Noticeability

## Categorical variables

### Initial working correlation structure (unstructured is singular)

Tests indicate M should 1

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  model1 <- mABNLAETypeOpEnvQ.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + UASType +
                                                        UASOperation + AmbientEnv,
                                                        data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                        id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

### Comparison between GEE-PA and GLMM-SS models with only LAE predictor

#### Timing comparison

```{r}

set.seed(85464)
newData <- data.frame(UASLAEMaxLR=seq(50, 95, by=1), AmbientEnv="Park", UASOperation="Flyover")
# benchmark timing
testNo <- microbenchmark::microbenchmark(
  
    'GLMM_model' = {model0GLMM <- lme4::glmer(UAS_noticed ~ UASLAEMaxLR + UASOperation + AmbientEnv + (1 | ID.),
                                                  data=subjNoticeDataNoAmb, family=binomial(link='logit'), control=glmcontrol)},
    
    'GEE_model' = {model0GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + UASOperation + AmbientEnv,
                                            data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                            id=ID., corstr='Stationary-M-dependent(1)')},
    
    'GLMM_metrics' = {
                        PCP <- glmmPCP(model0GLMM)
                        print(cbind(performance::model_performance(model0GLMM, metrics=c("AICc", "BIC", "R2")), PCP))
                        },
    
    'GEE_metrics' = {geeModelPerformance(model0GEE, verbose=TRUE)},
    
    'GLMM_prediction' = {model0GLMMpredict2 <- data.frame(x=newData, fit=predict(model0GLMM, newdata=newData, type='response',
                                  re.form=NA, se.fit=FALSE, allow.new.levels=TRUE))},
    
    'GEE_prediction' = {model0GEEpredict2 <- cbind(data.frame(x=newData), as.data.frame(predict(model0GEE, newdata=newData, type='response',
                                       se.fit=FALSE, varest='bias-corrected')))},
    times=5, unit='s', control=list(order='inorder'))

testNo

glmmVsGEENot <- data.frame(model=summary(testNo)[1,]$median/summary(testNo)[2,]$median,
                           metrics=summary(testNo)[3,]$median/summary(testNo)[4,]$median,
                           pred=summary(testNo)[5,]$median/summary(testNo)[6,]$median,
                           total=sum(summary(testNo)[1,]$median, summary(testNo)[3,]$median, summary(testNo)[5,]$median)/
                                 sum(summary(testNo)[2,]$median, summary(testNo)[4,]$median, summary(testNo)[6,]$median))

print(paste("Model:", glmmVsGEENot$model))
print(paste("Metrics:", glmmVsGEENot$metrics))
print(paste("Prediction:", glmmVsGEENot$pred))
print(paste("Total:", glmmVsGEENot$total))

microbenchmark:::autoplot.microbenchmark(testNo)
microbenchmark:::boxplot.microbenchmark(testNo)


```

#### Plot comparison

```{r}

set.seed(85464)

newData <- data.frame(UASLAEMaxLR=seq(45, 85, by=1), AmbientEnv="Street", UASOperation="Flyover")

mABNoLAEEnvOp.LAE <- lme4::glmer(UAS_noticed ~ UASLAEMaxLR + UASOperation + AmbientEnv + (1 | ID.),
                            data=subjNoticeDataNoAmb, family=binomial(link='logit'), control=glmcontrol)

mABNoLAEEnvOp.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + UASOperation + AmbientEnv,
                                  data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                  id=ID., corstr='Stationary-M-dependent(1)')

PCP <- glmmPCP(mABNoLAEEnvOp.LAE)
print(cbind(performance::model_performance(mABNoLAEEnvOp.LAE, metrics=c("AICc", "BIC", "R2")), PCP))

geeModelPerformance(mABNoLAEEnvOp.GEE, verbose=TRUE)

mABNoLAEEnvOp.LAEpredict2 <- data.frame(x=newData, fit=predict(mABNoLAEEnvOp.LAE, newdata=newData, type='response',
                                 re.form=NA, se.fit=FALSE, allow.new.levels=TRUE))

mABNoLAEEnvOp.GEEpredict2 <- cbind(data.frame(x=newData), as.data.frame(predict(mABNoLAEEnvOp.GEE, newdata=newData, type='response',
                                   se.fit=FALSE, varest='bias-corrected')))

mABNoLAEEnvOp.LAEpredictAll <- ggeffects::predict_response(mABNoLAEEnvOp.LAE, terms=c("UASLAEMaxLR [45:85]",
                                                                          "ID. [all]",
                                                                          "AmbientEnv [Street]",
                                                                          "UASOperation [Flyover]"),
                                                           type='response', margin='empirical',
                                                           bias_correction=TRUE)

p <- ggplot() +
  theme(panel.grid = element_blank(), aspect.ratio=1.35,
        text = element_text(family = "serif"),
        plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm")) #+

    
  # geom_point(data=stimNoticeDataNoAmb[which(stimNoticeDataNoAmb$AmbientEnv=="Street" & stimNoticeDataNoAmb$UASOperation=="Flyover"),], aes(x=UASLAEMaxLR, y=NoticedPropFilt),
  #            alpha=0.15)

for (id in unique(mABNoLAEEnvOp.LAEpredictAll$group)){
  p <- p + geom_line(data=mABNoLAEEnvOp.LAEpredictAll[mABNoLAEEnvOp.LAEpredictAll$group==id,], mapping=aes(x=x, y=predicted, colour="GLMM (CS)"), alpha=0.1, linewidth=0.25)
}

p <- p + 
  geom_line(data=mABNoLAEEnvOp.LAEpredict2, mapping=aes(x=x.UASLAEMaxLR, y=fit, colour="GLMM (CS)"), linewidth=1) +
  
  geom_line(data=mABNoLAEEnvOp.GEEpredict2, aes(x=x.UASLAEMaxLR, y=fit, colour="GEE (PA)"), linewidth=1) +
  
  scale_x_continuous(breaks=seq(45, 85, by=5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
  
  scale_colour_manual(values=c("GLMM (CS)"=mycolours[3], "GEE (PA)"=mycolours[4])) +

  guides(colour=guide_legend(title="Method", reverse=TRUE), fill=guide_legend(title="Method", reverse=TRUE)) +
  
  labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p

filename <- "PtANoticeGLMMVsGEE"

if (saveplots){
  ggsave(filename=paste(filename, ".svg", sep=""), width=4.5, height=4, path=file.path(outFigPath, "svg"))
  unlink(paste(filename, ".svg", sep=""))
  
  ggsave(filename=paste(filename, ".pdf", sep=""), width=4.5, height=4, path=file.path(outFigPath, "pdf"))
  unlink(paste(filename, ".pdf", sep=""))
}

```

### Simple model, no trial sequence

```{r, fig.width=12, fig.height=5}

model2 <- mABNoLAETypeOpEnv.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + UASType +
                                                      UASOperation + AmbientEnv,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASType [all]"),
                                                 type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASOperation [all]"),
                                               type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                                type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p


```

#### with trial sequence

```{r, fig.width=12, fig.height=5}

model2 <- mABNoLAETypeOpEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + UASType +
                                                      UASOperation + AmbientEnv + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE)


```

### LAE env interaction

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypeOpLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType + UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE)


```

### LAE env and LAE op interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypeOpxLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType + UASLAEMaxLR*UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE)


```

### LAE env and LAE type interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoOpTypexLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASOperation + UASLAEMaxLR*UASType + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE)


```


### LAE env op interaction

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypeEnvxLAExOpSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~
                                                           UASType + UASLAEMaxLR*UASOperation*AmbientEnv + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE)


```

### LAE env, LAE op and op type interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpxLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation + UASLAEMaxLR:UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASType [all]"),
                                                 type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASOperation [all]"),
                                               type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                                type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p

```


### LAE env and op type interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE)


```

### LAE env, LAE op, op type, and type env interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoEnvxTypexOpxLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation +
                                                            UASLAEMaxLR:UASOperation +
                                                            UASType:AmbientEnv +
                                                            TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE,
                    mABNoEnvxTypexOpxLAExEnvSq.GEE)


```

### LAE env, LAE op, op type, and op env interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpxLAExEnvxOpSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation +
                                                            UASLAEMaxLR:UASOperation +
                                                            UASOperation:AmbientEnv +
                                                            TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE,
                    mABNoEnvxTypexOpxLAExEnvSq.GEE, mABNoTypexOpxLAExEnvxOpSq.GEE)


```

### best performing without trial sequence

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpxLAExEnv.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation + UASLAEMaxLR:UASOperation,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')
geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE,
                    mABNoEnvxTypexOpxLAExEnvSq.GEE, mABNoTypexOpxLAExEnvxOpSq.GEE,
                    mABNoTypexOpxLAExEnv.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASType [all]"),
                                                 type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASOperation [all]"),
                                               type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                                type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p

```

### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNoTypexOpxLAExEnvSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

## Correlation structure refit

The exchangeable correlation structure is now highlighted as better than stationary-m-dependent(1), so the models are all refitted with this structure, expecting the simple model (no interactions, as the fit is worse with exchangeable structure compared with stationary-m-dependent(1).

### LAE env interaction

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypeOpLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType + UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE)


```

### LAE env and LAE op interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypeOpxLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType + UASLAEMaxLR*UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE)


```

### LAE env and LAE type interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoOpTypexLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASOperation + UASLAEMaxLR*UASType + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE)


```


### LAE env op interaction

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypeEnvxLAExOpSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~
                                                           UASType + UASLAEMaxLR*UASOperation*AmbientEnv + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE)


```

### LAE env, LAE op and op type interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpxLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation + UASLAEMaxLR:UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASType [all]"),
                                                 type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASOperation [all]"),
                                               type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                                type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p

```


### LAE env and op type interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE)


```

### LAE env, LAE op, op type, and type env interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoEnvxTypexOpxLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation +
                                                            UASLAEMaxLR:UASOperation +
                                                            UASType:AmbientEnv +
                                                            TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE,
                    mABNoEnvxTypexOpxLAExEnvSq.GEE)


```

### LAE env, LAE op, op type, and op env interactions

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpxLAExEnvxOpSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation +
                                                            UASLAEMaxLR:UASOperation +
                                                            UASOperation:AmbientEnv +
                                                            TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE,
                    mABNoEnvxTypexOpxLAExEnvSq.GEE, mABNoTypexOpxLAExEnvxOpSq.GEE)


```

### best performing without trial sequence

```{r, fig.width=12, fig.height=5}

model2 <- mABNoTypexOpxLAExEnv.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv +
                                                           UASType*UASOperation + UASLAEMaxLR:UASOperation,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')
geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoLAETypeOpEnv.GEE, mABNoLAETypeOpEnvSq.GEE,
                    mABNoTypeOpLAExEnvSq.GEE, mABNoTypeOpxLAExEnvSq.GEE,
                    mABNoOpTypexLAExEnvSq.GEE, mABNoTypeEnvxLAExOpSq.GEE,
                    mABNoTypexOpxLAExEnvSq.GEE, mABNoTypexOpLAExEnvSq.GEE,
                    mABNoEnvxTypexOpxLAExEnvSq.GEE, mABNoTypexOpxLAExEnvxOpSq.GEE,
                    mABNoTypexOpxLAExEnv.GEE)

model2predictType <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASType [all]"),
                                                 type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictOp <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "UASOperation [all]"),
                                               type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predictEnv <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                                type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

p1 <- ggplot(data=model2predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(7, 8, 9)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p2 <- ggplot(data=model2predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(10, 11, 12)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p3 <- ggplot(data=model2predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
              
              geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

p <- cowplot::plot_grid(p1, p2, p3, ncol=3, nrow=1)

p

```

### Reconfirm working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNoTypexOpxLAExEnvSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABNoTypexOpxLAExEnvSq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

## Comparison LAE models

### LAE only

```{r}

model2 <- mABNoLAE.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE)

```

#### with trial sequence

```{r}

model2 <- mABNoLAESq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE)

```

### LAE + Env

When including ambient env as a predictor, the model is badly formed with the exchangeable correlation structure, so the stationary-m-dependent(1) structure is used.

```{r}

model2 <- mABNoLAEEnv.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR + AmbientEnv,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(55, 80, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

```

### LAE * Env

When including the LAE interaction with ambient env, the model performs best with the exchangeable correlation structure.

```{r}

model2 <- mABNoLAExEnv.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(55, 80, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

```

### LAE * env with trial sequence

```{r}

model2 <- mABNoLAExEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLAEMaxLR*AmbientEnv + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLAEMaxLR [55:80]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASLAEMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(55, 80, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="% UAS noticed")

```

## Loudness comparison models

### ISO 532-3 loudness * env with trial sequence (stationary-m-dependent(1) correlation structure)

```{r}

model2 <- mABNoN3xEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLoudISO3PowAvgBin*AmbientEnv + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., maxit=1000, corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO3PowAvgBin [3:15]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASLoudISO3PowAvgBin, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(3, 15, by=3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)^"*"~(`Moore-Glasberg-Schlittenlacher`)~sone)), y="% UAS noticed")

```

### ISO 532-1 loudness * env with trial sequence (stationary-m-dependent(1) correlation structure)

```{r}

model2 <- mABNoN1xEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASLoudISO105ExMaxLR*AmbientEnv + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASLoudISO105ExMaxLR [3:20]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASLoudISO105ExMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
        
        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(3, 20, by=3)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~italic(N)[5]~(Zwicker)~sone)), y="% UAS noticed")

```

## UAS info only

### PNL with trial sequence

```{r}

model2 <- mABNoPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
        
 
        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNLT with trial sequence

```{r}

model2 <- mABNoPNLTSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLTmaxMaxLR + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLTmaxMaxLR [55:90]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLTmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(55, 90, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLTM, dB", y="% UAS noticed")

```

### PNL with tonal loudness

```{r}

model2 <- mABNoTnPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASTonLdECMA05ExBin + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with intermittency ratio (stationary-m-dependent(1) correlation structure)

```{r}

model2 <- mABNoIrPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 IntermitRatioMaxLR + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with sharpness

```{r}

model2 <- mABNoSPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASSharpAurISO305ExMaxLR + TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with sharpness and tonal loudness

```{r}

model2 <- mABNoSTnPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASSharpAurISO305ExMaxLR +
                                                   UASTonLdECMA05ExBin +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with sharpness and tonal loudness interaction

```{r}

model2 <- mABNoSxTnPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASSharpAurISO305ExMaxLR*UASTonLdECMA05ExBin +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with fluctuation strength

```{r}

model2 <- mABNoFPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASFluctOV10ExMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable', maxit=1000)

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE, mABNoFPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with fluctuation strength and sharpness

```{r}

model2 <- mABNoFSPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASFluctOV10ExMaxLR +
                                                 UASSharpAurISO305ExMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE, mABNoFPNLSq.GEE, mABNoFSPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with impulsiveness

```{r}

model2 <- mABNoIPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASImpulsSHMAvgMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE, mABNoFPNLSq.GEE, mABNoFSPNLSq.GEE,
                    mABNoIPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with fluctuation strength and impulsiveness

```{r}

model2 <- mABNoFIPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASFluctOV10ExMaxLR +
                                                 UASImpulsSHMAvgMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE, mABNoFPNLSq.GEE, mABNoFSPNLSq.GEE,
                    mABNoIPNLSq.GEE, mABNoFIPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with fluctuation strength and impulsiveness interaction

```{r}

model2 <- mABNoFxIPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASFluctOV10ExMaxLR*UASImpulsSHMAvgMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE, mABNoFPNLSq.GEE, mABNoFSPNLSq.GEE,
                    mABNoIPNLSq.GEE, mABNoFIPNLSq.GEE, mABNoFxIPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### PNL with roughness

```{r}

model2 <- mABNoRPNLSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                 UASRoughFZ05ExMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLSq.GEE, mABNoPNLTSq.GEE, mABNoTnPNLSq.GEE,
                    mABNoIrPNLSq.GEE, mABNoSPNLSq.GEE, mABNoSTnPNLSq.GEE,
                    mABNoSxTnPNLSq.GEE, mABNoFPNLSq.GEE, mABNoFSPNLSq.GEE,
                    mABNoIPNLSq.GEE, mABNoFIPNLSq.GEE, mABNoFxIPNLSq.GEE,
                    mABNoRPNLSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### Check working correlation structure for maximal model (unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence", "Non-Stationary-M-dependent")){
  model1 <- stats::update(mABNoFPNLSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABNoFPNLSq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

## UAS and env classification

### PNL with env interaction

```{r}

model2 <- mABNoPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with tonal loudness

```{r}

model2 <- mABNoTnPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                     UASTonLdECMA05ExBin +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with sharpness

```{r}

model2 <- mABNoSPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                     UASSharpAurISO305ExMaxLR +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with tonal loudness and sharpness

```{r}

model2 <- mABNoSTnPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                        UASSharpAurISO305ExMaxLR +
                                                        UASTonLdECMA05ExBin +
                                                   TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with tonal loudness and sharpness interaction

```{r}

model2 <- mABNoSxTnPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
  
        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```


#### with tonal loudness and fluctuation strength

```{r}

model2 <- mABNoFTnPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin +
                                                      UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with tonal loudness, fluctuation strength and impulsiveness

```{r}

model2 <- mABNoFITnPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin +
                                                        UASImpulsSHMAvgMaxLR +
                                                      UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with tonal loudness, fluctuation strength and roughness

```{r}

model2 <- mABNoFRTnPNLxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin +
                                                        UASRoughDW05ExMaxLR +
                                                      UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with tonal loudness interaction with env, fluctuation strength

```{r}

model2 <- mABNoFPNLxEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin +
                                                      UASTonLdECMA05ExBin*AmbientEnv +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE,
                    mABNoFPNLxEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.35, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with env interaction with tonal loudness and fluctuation strength

```{r}

model2 <- mABNoEnvxFPNLxEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin*AmbientEnv +
                                                      UASTonLdECMA05ExBin*AmbientEnv +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE,
                    mABNoFPNLxEnvxTnSq.GEE, mABNoEnvxFPNLxEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.4, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

#### with env interaction with sharpness, tonal loudness and fluctuation strength

```{r}

model2 <- mABNoFxEnvxSPNLxEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin*AmbientEnv +
                                                        UASSharpAurISO305ExMaxLR*AmbientEnv +
                                                      UASTonLdECMA05ExBin*AmbientEnv +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE,
                    mABNoFPNLxEnvxTnSq.GEE, mABNoEnvxFPNLxEnvxTnSq.GEE,
                    mABNoFxEnvxSPNLxEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.4, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

####  with sharpness, and env interaction with tonal loudness and fluctuation strength

```{r}

model2 <- mABNoFxEnvSPNLxEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin*AmbientEnv +
                                                        UASSharpAurISO305ExMaxLR +
                                                      UASTonLdECMA05ExBin*AmbientEnv +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE,
                    mABNoFPNLxEnvxTnSq.GEE, mABNoEnvxFPNLxEnvxTnSq.GEE,
                    mABNoFxEnvxSPNLxEnvxTnSq.GEE, mABNoFxEnvSPNLxEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.4, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

####  with sharpness, fluctuation strength, and env interaction with tonal loudness

```{r}

model2 <- mABNoFSPNLxEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR*AmbientEnv +
                                                      UASFluctSHM05ExBin +
                                                        UASSharpAurISO305ExMaxLR +
                                                      UASTonLdECMA05ExBin*AmbientEnv +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE,
                    mABNoFPNLxEnvxTnSq.GEE, mABNoEnvxFPNLxEnvxTnSq.GEE,
                    mABNoFxEnvxSPNLxEnvxTnSq.GEE, mABNoFxEnvSPNLxEnvxTnSq.GEE,
                    mABNoFSPNLxEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.4, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")

```

### Check working correlation structure for maximal model (Non-Stationary-M-dependent is singular and unstructured is not positive definite)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNoFPNLxEnvxTnSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABNoFPNLxEnvxTnSq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### examine stepwise-selected model

```{r}


model2 <- mABNoFPNLEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ UASPNLmaxMaxLR +
                                                      UASFluctSHM05ExBin +
                                                      UASTonLdECMA05ExBin*AmbientEnv +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoPNLxEnvSq.GEE, mABNoTnPNLxEnvSq.GEE,
                    mABNoSPNLxEnvSq.GEE, mABNoSTnPNLxEnvSq.GEE,
                    mABNoSxTnPNLxEnvSq.GEE, mABNoFTnPNLxEnvSq.GEE,
                    mABNoFITnPNLxEnvSq.GEE, mABNoFRTnPNLxEnvSq.GEE,
                    mABNoFPNLxEnvxTnSq.GEE, mABNoEnvxFPNLxEnvxTnSq.GEE,
                    mABNoFxEnvxSPNLxEnvxTnSq.GEE, mABNoFxEnvSPNLxEnvxTnSq.GEE,
                    mABNoFSPNLxEnvxTnSq.GEE, mABNoFPNLEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("UASPNLmaxMaxLR [50:85]", "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=UASPNLmaxMaxLR, y=NoticedPropFilt, colour=AmbientEnv, shape=AmbientEnv),
                   alpha=0.4, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +

        scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_shape_manual(values=c(1, 3)) +
  
        guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
               fill=guide_legend(title="Amb. env.", reverse=FALSE),
               shape=guide_legend(title="Amb. env.", reverse=FALSE)) +

        scale_x_continuous(breaks=seq(50, 85, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS PNLM, dB", y="% UAS noticed")


```

## UAS and env level

### Initial working correlation structure (unstructured is singular)

Tests indicate M should be 1

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  model1 <- mABNodPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff +
                                                       TrialNumber,
                                                        data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                        id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

### examine initial model

```{r}

model2 <- mABNodPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt), shape=1,
                   alpha=0.4, size=2) +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### add tonal loudness

```{r}

model2 <- mABNoTndPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff +
                                                         UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### add sharpness

```{r}

model2 <- mABNoSdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff +
                                                          UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### sharpness interaction with PNLdiff (stationary-M-dependent)

```{r}

model2 <- mABNoSxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### sharpness interaction with PNLdiff (exchangeable)

```{r}

model2 <- mABNoSxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### tonal loudness interaction with PNLdiff

```{r}

model2 <- mABNoTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### tonal loudness interaction with sharpness and PNLdiff

```{r}

model2 <- mABNoSxTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                            UASSharpAurISO305ExMaxLR*UASTonLdECMA05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

###  with sharpness, tonal loudness interaction and PNLdiff

```{r}

model2 <- mABNoSTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                            UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

###  with sharpness interaction and tonal loudness interaction with PNLdiff (stationary-M-dependent)

```{r}

model2 <- mABNoTnxdPNLLAF50xSSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                            UASSharpAurISO305ExMaxLR*PNLMLAF50diff +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Stationary-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE, mABNoTnxdPNLLAF50xSSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")


model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")


```

### with impulsiveness, sharpness, tonal loudness interaction and PNLdiff (exchangeable)

```{r}

model2 <- mABNoISTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                            UASImpulsSHMAvgMaxLR +
                                                            UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE, mABNoTnxdPNLLAF50xSSq.GEE,
                    mABNoISTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")


```

### with fluctuation strength, sharpness, tonal loudness interaction and PNLdiff

```{r}

model2 <- mABNoFSTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                            UASFluctSHM05ExBin +
                                                            UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE, mABNoTnxdPNLLAF50xSSq.GEE,
                    mABNoISTnxdPNLLAF50Sq.GEE, mABNoFSTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")


```

### with fluctuation strength, roughness, sharpness, tonal loudness interaction and PNLdiff

```{r}

model2 <- mABNoFRSTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                            UASFluctSHM05ExBin +
                                                             UASRoughDW05ExMaxLR +
                                                            UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE, mABNoTnxdPNLLAF50xSSq.GEE,
                    mABNoISTnxdPNLLAF50Sq.GEE, mABNoFSTnxdPNLLAF50Sq.GEE,
                    mABNoFRSTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")


```

### with roughness, sharpness, tonal loudness interaction and PNLdiff

```{r}

model2 <- mABNoRSTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                             UASRoughDW05ExMaxLR +
                                                            UASSharpAurISO305ExMaxLR +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE, mABNoTnxdPNLLAF50xSSq.GEE,
                    mABNoISTnxdPNLLAF50Sq.GEE, mABNoFSTnxdPNLLAF50Sq.GEE,
                    mABNoFRSTnxdPNLLAF50Sq.GEE, mABNoRSTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASSharpAurISO305ExMaxLR), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~italic(S)[Au5]~","~acum)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")


```

### with fluctuation strength, tonal loudness interaction and PNLdiff

```{r}

model2 <- mABNoFTnxdPNLLAF50Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PNLMLAF50diff*UASTonLdECMA05ExBin +
                                                             UASFluctSHM05ExBin +
                                                       TrialNumber,
                                                     data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                                     id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE, 
                    mABNodPNLLAF50Sq.GEE, mABNoTndPNLLAF50Sq.GEE,
                    mABNoSdPNLLAF50Sq.GEE, mABNoSxdPNLLAF50Sq.GEE,
                    mABNoTnxdPNLLAF50Sq.GEE, mABNoSxTnxdPNLLAF50Sq.GEE,
                    mABNoSTnxdPNLLAF50Sq.GEE, mABNoTnxdPNLLAF50xSSq.GEE,
                    mABNoISTnxdPNLLAF50Sq.GEE, mABNoFSTnxdPNLLAF50Sq.GEE,
                    mABNoFRSTnxdPNLLAF50Sq.GEE, mABNoRSTnxdPNLLAF50Sq.GEE,
                    mABNoFTnxdPNLLAF50Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("PNLMLAF50diff [-5:50]", "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PNLMLAF50diff, y=NoticedPropFilt, colour=UASTonLdECMA05ExBin), shape=1,
                   alpha=0.4, size=2) +

        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        ggnewscale::new_scale_color() +
        
        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +

        scale_x_continuous(breaks=seq(-5, 50, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(UAS~PNLM~-~amb.~italic(L)[AF50]~","~dB)), y="% UAS noticed")

```

### Check working correlation structure for maximal model (Non-Stationary-M-dependent and unstructured are singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNoFSTnxdPNLLAF50Sq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABNoFSTnxdPNLLAF50Sq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

## UAS and env detailed measurements - spectral level time-series

### Detectability


#### initial working correlation structure (no-st-m thows NaN warnings and unstructured is singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABNoDt1i.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog,
                                            data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                            id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- mABNoDt5m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog,
                                            data=subjNoticeDataNoAmb, family=binomial(link='logit'),
                                            id=ID., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}

```

#### Detectability only

```{r}

model2 <- mABNoDt1i.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1IntMaxLRLog, y=NoticedPropFilt),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```
### Detectability max

```{r}

model2 <- mABNoDt5m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog, y=NoticedPropFilt),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### Detectability max at 0.1s intervals

```{r}

model2 <- mABNoDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog, y=NoticedPropFilt),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### Detectability^2 at 0.1s intervals

This model improves the fit, but also leads to an over-inflated coefficient for detectability, indicating 'complete separation'

```{r}

model2 <- mABNoDt1m2.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                I(Detect0p1MaxMaxLRLog^2),
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog, y=NoticedPropFilt),
                   shape=1, alpha=0.35, size=2) +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted), linewidth=1) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with tonal loudness

```{r}

model2 <- mABNoTnDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                UASTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with tonal loudness detectability interaction

Again, separation appears to be a problem with this model

```{r}

model2 <- mABNoTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with sharpness, and tonal loudness detectability interaction

```{r}

model2 <- mABNoSTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASTonLdECMA05ExBin +
                                                   UASSharpAurISO305ExMaxLR,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with fluctuation strength, sharpness, and tonal loudness detectability interaction (AR1)

```{r}

model2 <- mABNoFSTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASTonLdECMA05ExBin +
                                                    UASFluctSHM05ExBin +
                                                   UASSharpAurISO305ExMaxLR,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with fluctuation strength, sharpness, and tonal loudness detectability interaction (exchangeable)

```{r}

model2 <- mABNoFSTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASTonLdECMA05ExBin +
                                                    UASFluctSHM05ExBin +
                                                   UASSharpAurISO305ExMaxLR,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with fluctuation strength, sharpness, no interaction tonal loudness with detectability (AR1)

```{r}

model2 <- mABNoFSTnDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                    UASFluctSHM05ExBin +
                                                   UASSharpAurISO305ExMaxLR +
                                                     UASTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with impulsiveness fluctuation strength, sharpness, no interaction tonal loudness with detectability (AR1)

```{r}

model2 <- mABNoFISTnDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                    UASFluctSHM05ExBin +
                                                    UASImpulsSHMAvgMaxLR +
                                                   UASSharpAurISO305ExMaxLR +
                                                     UASTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent(1)')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### with fluctuation strength, sharpness, tonal loudness interaction with detectability (exchangeable)

```{r}

model2 <- mABNoFSTnxDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASTonLdECMA05ExBin +
                                                    UASFluctSHM05ExBin +
                                                   UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```


#### no tonal loudness interaction (AR1)

```{r}

model2 <- mABNoFSTnDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                    UASFluctSHM05ExBin +
                                                   UASSharpAurISO305ExMaxLR +
                                                     UASTonLdECMA05ExBin +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

#### tonal loudness sharpness interaction (AR1)

```{r}

model2 <- mABNoFSxTnDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                    UASFluctSHM05ExBin +
                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMA05ExBin +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### detectability sharpness interaction (AR1)

```{r}

model2 <- mABNoFTnSxDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASSharpAurISO305ExMaxLR +
                                                    UASFluctSHM05ExBin +
                                                   UASTonLdECMA05ExBin +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### detectability sharpness and tonal loudness interaction (AR1)

```{r}

model2 <- mABNoFSxDt1mxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASSharpAurISO305ExMaxLR +
                                                    UASFluctSHM05ExBin +
                                                   UASTonLdECMA05ExBin*Detect0p1IntMaxLRLog +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### detectability fluctuation strength interaction (AR1)

```{r}

model2 <- mABNoSTnFxDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASFluctSHM05ExBin +
                                                     UASSharpAurISO305ExMaxLR +
                                                   UASTonLdECMA05ExBin +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### detectability (integrated), interaction with tonal loudness (exchangeable)

```{r}

model2 <- mABNoFSTnxDt1iSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog*UASTonLdECMA05ExBin +
                                                     UASFluctSHM05ExBin +
                                                       UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### detectability 0.5s (integrated), interaction with tonal loudness (exchangeable)

```{r}

model2 <- mABNoFSTnxDt5iSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5IntMaxLRLog*UASTonLdECMA05ExBin +
                                                     UASFluctSHM05ExBin +
                                                       UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE,
                    mABNoFSTnxDt5iSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5IntMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### detectability 0.1s (integrated), interaction with tonal loudness, no sharpness (exchangeable)

```{r}

model2 <- mABNoFTnxDt1iSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog*UASTonLdECMA05ExBin +
                                                     UASFluctSHM05ExBin +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE,
                    mABNoFSTnxDt5iSq.GEE, mABNoFTnxDt1iSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```


### detectability 0.1s (integrated), interaction with tonal loudness, no fluctuation strength (exchangeable)

```{r}

model2 <- mABNoSTnxDt1iSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog*UASTonLdECMA05ExBin +
                                                     UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE,
                    mABNoFSTnxDt5iSq.GEE, mABNoFTnxDt1iSq.GEE,
                    mABNoSTnxDt1iSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### best performing with detectability^2 (AR1)

```{r}

model2 <- mABNoFSTnxDt1i2Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog*UASTonLdECMA05ExBin +
                                                      I(Detect0p1IntMaxLRLog^2) +
                                                     UASFluctSHM05ExBin +
                                                     UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE,
                    mABNoFSTnxDt5iSq.GEE, mABNoFTnxDt1iSq.GEE,
                    mABNoSTnxDt1iSq.GEE, mABNoFSTnxDt1i2Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### best performing with max detectability

```{r}

model2 <- mABNoFSTnxDt1m2Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*UASTonLdECMA05ExBin +
                                                     UASFluctSHM05ExBin +
                                                     UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE,
                    mABNoFSTnxDt5iSq.GEE, mABNoFTnxDt1iSq.GEE,
                    mABNoSTnxDt1iSq.GEE, mABNoFSTnxDt1i2Sq.GEE,
                    mABNoFSTnxDt1m2Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### best performing with 0.5 s detectability

```{r}

model2 <- mABNoFSTnxDt5i2Sq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5IntMaxLRLog*UASTonLdECMA05ExBin +
                                                     UASFluctSHM05ExBin +
                                                     UASSharpAurISO305ExMaxLR +
                                                     TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNoTnDt1m.GEE, mABNoTnxDt1m.GEE, mABNoSTnxDt1m.GEE,
                    mABNoFSTnxDt1m.GEE, mABNoFSTnDt1m.GEE, mABNoFISTnDt1m.GEE,
                    mABNoFSTnxDt1mSq.GEE, mABNoFSTnDt1mSq.GEE, mABNoFSxTnDt1mSq.GEE,
                    mABNoFTnSxDt1mSq.GEE, mABNoFSxDt1mxTnSq.GEE,
                    mABNoSTnFxDt1mSq.GEE, mABNoFSTnxDt1iSq.GEE,
                    mABNoFSTnxDt5iSq.GEE, mABNoFTnxDt1iSq.GEE,
                    mABNoSTnxDt1iSq.GEE, mABNoFSTnxDt1i2Sq.GEE,
                    mABNoFSTnxDt1m2Sq.GEE, mABNoFSTnxDt5i2Sq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5IntMaxLRLog [all]",
                                                             "UASTonLdECMA05ExBin [0.8:2.4, by=0.4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=UASTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(UAS~tonal~italic(N)[italic(T)]^"*"~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### Check working correlation structure for maximal model (Non-Stationary-M-dependent singular and unstructured not positive definite )

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNoFSTnxDt1iSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABNoFSTnxDt1iSq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

## UAS and env detailed measurements - SQMs/audio

### detectability with tonal loudness diff

```{r}


model2 <- mABNodTnDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### detectability with tonal loudness and sharpness diff

```{r}


model2 <- mABNodSdTnDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                 dSharpAurISO305ExMaxLR +
                                                   dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### detectability interaction with tonal loudness diff

```{r}


model2 <- mABNodTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### detectability with tonal loudness diff interaction with sharpness diff

```{r}


model2 <- mABNodSxdTnDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```


### detectability interaction with tonal loudness diff interaction with sharpness diff

```{r}


model2 <- mABNodSxdTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')


geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodSxdTnxDt1m.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### roughness diff, detectability interaction with tonal loudness diff interaction with sharpness diff

```{r}


model2 <- mABNodRdSxdTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### detectability interaction with roughness diff and tonal loudness diff interaction with sharpness diff

```{r}


model2 <- mABNodSxdTnxDt1mxdR.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin*Detect0p1MaxMaxLRLog,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### detectability interaction with tonal loudness diff interaction with sharpness diff and roughness diff

```{r}

model2 <- mABNodRxTndSxdTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin*dTonLdECMA05ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### fluct str diff, roughness diff, detectability interaction with tonal loudness diff interaction with sharpness diff

```{r}

model2 <- mABNodFdRdSxdTnxDt1m.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt)

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### best performing with trial sequence

```{r}

model2 <- mABNodFdRdSxdTnxDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelfth <- mABNodFdRdSxdTnxDt1mSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, verbose=FALSE)

cbind(data.frame(Odds_Ratio=exp(mABNodFdRdSxdTnxDt1mSq.GEEFth$coefficients$coefficients),
                 row.names=row.names(mABNodFdRdSxdTnxDt1mSq.GEEFth$coefficients)),
      mABNodFdRdSxdTnxDt1mSq.GEEFth$coefficients)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### integrated detectability

```{r}

model2 <- mABNodFdRdSxdTnxDt1iSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1IntMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1IntMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1IntMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1IntMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1IntMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### 0.5s detectability

```{r}

model2 <- mABNodFdRdSxdTnxDt5mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e3,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodFdRdSxdTnxDt5mSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, verbose=FALSE)


geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### 0.5s detectability, omit interaction with tonal loudness

```{r}

model2 <- mABNodFdRdSxdTnDt5mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### 0.5s detectability, omit sharpness interaction with tonal loudness (AR1)

```{r}

model2 <- mABNodFdRdSdTnDt5mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog +
                                                    dSharpAurISO305ExMaxLR + 
                                                      dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE,
                    mABNodFdRdSdTnDt5mSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### partial loudness substitute for detectability (AR1)

#### no interaction with tonal loudness

```{r}

model2 <- mABNodFdRdSdTndNSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PartLoudMGLT05Ex +
                                                    dSharpAurISO305ExMaxLR + 
                                                      dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE,
                    mABNodFdRdSdTnDt5mSq.GEE, mABNodFdRdSdTndNSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLT05Ex [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PartLoudMGLT05Ex,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 40, by=2)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "PartLoudMGLT05Ex [0:25, by=5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=PartLoudMGLT05Ex),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 25, by=5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

#### log partial loudness

```{r}

model2 <- mABNodFdRdSdTndNSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PartLoudMGLT05ExLog +
                                                    dSharpAurISO305ExMaxLR + 
                                                      dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE,
                    mABNodFdRdSdTnDt5mSq.GEE, mABNodFdRdSdTndNSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLT05ExLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PartLoudMGLT05ExLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 40, by=2)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "PartLoudMGLT05ExLog [-2:3, by=1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=PartLoudMGLT05ExLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(-6, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

#### log partial loudness interaction with tonal loudness

```{r}
subjNoticeDataNoAmb$PartLoudMGLT05ExLog <- log(subjNoticeDataNoAmb$PartLoudMGLT05Ex)
stimNoticeDataNoAmb$PartLoudMGLT05ExLog <- log(stimNoticeDataNoAmb$PartLoudMGLT05Ex)

model2 <- mABNodFdRdSdTnxdNSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ PartLoudMGLT05ExLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e4,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='AR-M-dependent')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE,
                    mABNodFdRdSdTnDt5mSq.GEE, mABNodFdRdSdTndNSq.GEE,
                    mABNodFdRdSdTnxdNSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("PartLoudMGLT05ExLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=PartLoudMGLT05ExLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 40, by=2)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "PartLoudMGLT05ExLog [-2:3, by=1]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=PartLoudMGLT05ExLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Part.~loud.~Delta,italic(N)[",5"]~","~sone)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(-6, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loud.~diff.~Delta,italic(N)[italic(T)~",5"]~","~sone)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### Check working correlation structure for maximal model (Non-Stationary-M-dependent and unstructured singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNodFdRdSxdTnxDt5mSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

### use backward stepwise selection on best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABNodFdRdSxdTnxDt5mSq.GEE,
                                       criterion='sgpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### examine stepwise-selected model

```{r}

model2 <- mABNodFdSxdTnxDt5mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e3,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodFdSxdTnxDt5mSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')


geefirthParams(modelFth, exponentiate=TRUE, verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE,
                    mABNodFdRdSdTnDt5mSq.GEE, mABNodFdRdSdTndNSq.GEE,
                    mABNodFdSxdTnxDt5mSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 

```

### check 0.1s detectability

```{r}

model2 <- mABNodFdSxdTnxDt1mSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e3,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodFdSxdTnxDt1mSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p1MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, verbose=FALSE)


geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnDt5mSq.GEE,
                    mABNodFdRdSdTnDt5mSq.GEE, mABNodFdRdSdTndNSq.GEE,
                    mABNodFdSxdTnxDt5mSq.GEE, mABNodFdSxdTnxDt1mSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p1MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p1MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed")

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p1MaxMaxLRLog [0:4]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p1MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed")


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### Check working correlation structure for stepwise-selected model (Non-Stationary-M-dependent and unstructured singular)

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent", "Stationary-M-dependent",
                 "Independence")){
  model1 <- stats::update(mABNodFdSxdTnxDt5mSq.GEE, formula=.~., corstr=corstr)
  
  print(corstr)
  
  geeModelPerformance(model1, verbose=TRUE)
}


```

## UAS and env detailed measurements with env - SQMs/audio 

### best performing with env

```{r}

model2 <- mABNodFdRdSxdTnxDt5mEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      AmbientEnv +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e3,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodFdRdSxdTnxDt5mEnvSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      AmbientEnv +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, exponentiate=TRUE, verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnxDt5mEnvSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed") +
        facet_grid(cols=vars(AmbientEnv))

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), y="% UAS noticed") +
        facet_grid(cols=vars(AmbientEnv))


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### detectability interacting with env instead of tonal loudness diff

```{r}

model2 <- mABNodFdRdSxdTnDt5mxEnvSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog*AmbientEnv +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e3,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodFdRdSxdTnDt5mxEnvSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p5MaxMaxLRLog*AmbientEnv +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, exponentiate=TRUE, verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnxDt5mEnvSq.GEE,
                    mABNodFdRdSxdTnDt5mxEnvSq.GEE)


model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed") +
        facet_grid(cols=vars(AmbientEnv))

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)[italic(T)~",5"]~","~acum)), y="% UAS noticed") +
        facet_grid(cols=vars(AmbientEnv))


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```

### env interacting with tonal loudness diff

```{r}

model2 <- mABNodFdRdSxdTnxDt5mEnvxTnSq.GEE <- glmtoolbox::glmgee(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                                dTonLdECMA05ExBin*AmbientEnv +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                              maxit=1e3,
                                                 family=binomial(link='logit'),
                                                 id=ID., corstr='Exchangeable')

geeParams(model2, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

modelFth <- mABNodFdRdSxdTnxDt5mEnvxTnSq.GEEFth <- geefirth::geefirth(UAS_noticed ~ Detect0p5MaxMaxLRLog*dTonLdECMA05ExBin +
                                                                dTonLdECMA05ExBin*AmbientEnv +
                                                    dSharpAurISO305ExMaxLR*dTonLdECMA05ExBin +
                                                      dRoughECMA05ExBin +
                                                      dFluctSHM10ExBin +
                                                      TrialNumber,
                                              data=subjNoticeDataNoAmb,
                                                 id=ID., corstr='exchangeable')

geefirthParams(modelFth, exponentiate=TRUE, verbose=FALSE)

geeModelPerformance(mABNoTypexOpxLAExEnvSq.GEE, mABNoLAE.GEE, mABNoLAESq.GEE,
                    mABNoLAEEnv.GEE, mABNoLAExEnv.GEE,
                    mABNoLAExEnvSq.GEE, mABNoN3xEnvSq.GEE, mABNoN1xEnvSq.GEE,
                    mABNoDt1i.GEE, mABNoDt5m.GEE, mABNoDt1m.GEE, mABNoDt1m2.GEE,
                    mABNodTnDt1m.GEE, mABNodSdTnDt1m.GEE, mABNodTnxDt1m.GEE,
                    mABNodSxdTnDt1m.GEE, mABNodSxdTnxDt1m.GEE,
                    mABNodRdSxdTnxDt1m.GEE, mABNodSxdTnxDt1mxdR.GEE,
                    mABNodRxTndSxdTnxDt1m.GEE, mABNodFdRdSxdTnxDt1m.GEE,
                    mABNodFdRdSxdTnxDt1mSq.GEE, mABNodFdRdSxdTnxDt1iSq.GEE,
                    mABNodFdRdSxdTnxDt5mSq.GEE, mABNodFdRdSxdTnxDt5mEnvSq.GEE,
                    mABNodFdRdSxdTnDt5mxEnvSq.GEE, mABNodFdRdSxdTnxDt5mEnvxTnSq.GEE)

model2predict <- ggeffects::predict_response(model2, terms=c("Detect0p5MaxMaxLRLog [all]",
                                                             "dTonLdECMA05ExBin [0:2, by=0.5]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=Detect0p5MaxMaxLRLog,
                                                 y=NoticedPropFilt,
                                                 colour=dTonLdECMA05ExBin),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE),
               fill=guide_legend(title=expression(paste(Tonal~loudness~diff.~Delta,italic(N)["5"]~","~acum)), reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x="UAS lg(Detectability)", y="% UAS noticed") +
        facet_grid(cols=vars(AmbientEnv))

model2predict <- ggeffects::predict_response(model2, terms=c("dTonLdECMA05ExBin [all]",
                                                             "Detect0p5MaxMaxLRLog [0:4]",
                                                             "AmbientEnv [all]"),
                                             type='fixed', margin='marginalmeans', vcov=vcov(model2, type="bias-corrected"))

model2predict$AmbientEnv <- model2predict$facet

ggplot(data=model2predict) +
        theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif")) +
        
        geom_point(data=stimNoticeDataNoAmb, aes(x=dTonLdECMA05ExBin,
                                                 y=NoticedPropFilt,
                                                 colour=Detect0p5MaxMaxLRLog),
                   shape=1, alpha=0.35, size=2) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
               
        ggnewscale::new_scale_color() +

        geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
        
        geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
  
        scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
        scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
  
        guides(colour=guide_legend(title="UAS lg(Detectability)", reverse=TRUE),
               fill=guide_legend(title="UAS lg(Detectability)", reverse=TRUE)) +
  
        scale_x_continuous(breaks=seq(0, 6, by=0.5)) +
        scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
        
        labs(x=expression(paste(Tonal~loudness~diff.~Delta,italic(N)[italic(T)~",5"]~","~acum)), y="% UAS noticed") +
        facet_grid(cols=vars(AmbientEnv))


predictProbs <- predictNew(model=model2, newData=stimNoticeDataNoAmb,
                           response=stimNoticeDataNoAmb$NoticedPropFilt,
                           fixVars=c(TrialNumber=40))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10)) +
  
  labs(x="% UAS noticed (test)", y="Predicted % UAS noticed") 


```





















