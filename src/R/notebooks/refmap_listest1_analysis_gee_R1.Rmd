---
title: "REFMAP listening test 1 analysis: Generalised estimating equations for annoyance"
output: html_document
date: "2025-01-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

Load packages

```{r}
library(conflicted)
library(MASS)
library(geepack)
# library(geefirth)
library(glmtoolbox)
library(lme4)
library(tidyverse)
library(openxlsx)
library(ggeffects)
library(stats)
library(easystats)
library(viridis)
library(ggnewscale)
library(patchwork)
library(microbenchmark)
# set package parameters
theme_set(theme_bw())

lmcontrol <- lme4::lmerControl(optimizer = 'bobyqa',
                               optCtrl = list(maxfun = 1e6))
glmcontrol <- lme4::glmerControl(optimizer = 'bobyqa',
                                optCtrl = list(maxfun = 1e6))

```

Set parameters

```{r}

# plot colour scheme

mycolourlist = list(c(0, 102, 255), c(0, 204, 153), c(255, 0, 102), c(74, 111, 152), c(251, 164, 49), c(204, 153, 255), c(90, 192, 255), c(80, 245, 233), c(255, 90, 192), c(164, 201, 242), c(255, 254, 139), c(255, 243, 255))
mycolours = matrix()

for (ii in 1:length(mycolourlist)){
  mycolours[ii] = rgb(mycolourlist[[ii]][1]/255,
                      mycolourlist[[ii]][2]/255,
                      mycolourlist[[ii]][3]/255)
}

# toggle to save plots
saveplots = TRUE

if (saveplots){
  # set output plot directory
  choose.files(caption="Just cancel this", filters=matrix(data=c(" ", " "), ncol=2))  # workaround for bug in RTerm choose.dir
  outFigPath <- utils::choose.dir(caption="Select output folder to save plots")
  
  if (!dir.exists(file.path(outFigPath, "svg"))){dir.create(file.path(outFigPath, "svg"))}
  if (!dir.exists(file.path(outFigPath, "pdf"))){dir.create(file.path(outFigPath, "pdf"))}
  
}

# toggle to save data
savedata = TRUE

if (savedata){
  # set output plot directory
  if (saveplots==FALSE){
    choose.files(caption="Just cancel this", filters=matrix(data=c(" ", " "), ncol=2))  # workaround for bug in RTerm choose.dir
  }
  outDataPath <- utils::choose.dir(caption="Select output folder to save data")
}

set.seed(5419498)


```

# Functions

## GEE Rsquared (Zheng, 2000)

```{r}

geeRsquared <- function(...){
  
  if (length(list(...)) == 1){
      
      model_objects <- insight::ellipsis_info(..., ..., only_models = TRUE,
                                              verbose=FALSE)
      model_objects <- model_objects[1]

  } else{

      model_objects <- insight::ellipsis_info(..., only_models = TRUE,
                                              verbose=FALSE)
  
  }
  
  # ensure proper object names
  dot_names <- sapply(match.call(expand.dots = FALSE)[["..."]], as.character)
  check_object_names <- insight::compact_character(names(model_objects))
  if ((is.null(check_object_names) ||
    # or if length of names doesn't match number of models
    length(check_object_names) != length(model_objects) ||
    # or if names are "..1", "..2" pattern
    all(grepl("\\.\\.\\d", check_object_names))) &&
    # and length of dot-names must match length of objects
    length(model_objects) == length(dot_names)) {
    names(model_objects) <- dot_names
  }
  
  object_names <- names(model_objects)
  
  m <- mapply(function(.x, .y) {
    SSE <- sum((.x$y - .x$fitted.values)^2, na.rm = T)
    SST <- sum((.x$y - mean(.x$y, na.rm = T))^2, na.rm = T)
    DFE <- .x$df.residual
    DFT <- length(.x$y) - 1
    r2 = 1 - SSE/SST
    r2a = 1 - (SSE/SST)*(DFT/DFE)
    dat <- data.frame(R2=r2, adjR2=r2a)
    model_name <- gsub("\"", "", insight::safe_deparse(.y), fixed = TRUE)
    perf_df <- data.frame(Name = model_name, Model = class(.x)[1], dat, stringsAsFactors = FALSE)
    perf_df
  }, model_objects, object_names, SIMPLIFY = FALSE)
  
  dfs <- Reduce(function(x, y) merge(x, y, all = TRUE, sort = FALSE), m)

  return(dfs)
}

```

## Predicting from model objects with new data (such as mean values)

```{r}

predictNew <- function(model, response, newData, fixVars=NULL){
  
  # check response variable is the same length as the newData variables
  if (length(response) != nrow(newData)){
    stop("Response variable must be the same length as the new data")
  }

  # get predictor variables from model
  pred <- insight::find_predictors(model, flatten = TRUE)

  # if fixVars is not null
  if (!is.null(fixVars)){
    # check if fixVars is a list or named vector and convert to dataframe if necessary
    if (is.list(fixVars) | is.vector(fixVars)){
      fixVars <- t(as.data.frame(fixVars))
      # remove redundant rowname
      rownames(fixVars) <- NULL
    }
    
    # remove fixed variables from predictors
    pred <- pred[!pred %in% colnames(fixVars)]
  
  }
  
  # assign columns from newData to dat
  dat <- newData[pred]
  
  # if fixVars is not null
  if (!is.null(fixVars)){
    # add fixed variable columns
    dat <- cbind(dat, fixVars)
  }
  
  if (class(model) == "glmgee"){
    # make predictions with new data
    predictions <- predict(model, newdata=dat, type='response', varest='bias-corrected')
  } else {
    # make predictions with new data
    predictions <- predict(model, newdata=dat, type='response')
  }
  # bind predictions to dat
  predictDat <- cbind(dat, response=response, fit=predictions)

  # include rownames
  rownames(predictDat) <- newData$X
  
  # return output
  return(predictDat)
}

```

## Compiling GEE GLM model performance parameters

```{r}

geeModelPerformance <- function(..., verbose=FALSE){
  
  if (length(list(...)) == 1){
      
      model_objects <- insight::ellipsis_info(..., ..., only_models = TRUE,
                                              verbose=FALSE)
      model_objects <- model_objects[1]

  } else{

      model_objects <- insight::ellipsis_info(..., only_models = TRUE,
                                              verbose=FALSE)
  
  }
  
  # ensure proper object names
  dot_names <- sapply(match.call(expand.dots = FALSE)[["..."]], as.character)
  check_object_names <- insight::compact_character(names(model_objects))
  if ((is.null(check_object_names) ||
    # or if length of names doesn't match number of models
    length(check_object_names) != length(model_objects) ||
    # or if names are "..1", "..2" pattern
    all(grepl("\\.\\.\\d", check_object_names))) &&
    # and length of dot-names must match length of objects
    length(model_objects) == length(dot_names)) {
    names(model_objects) <- dot_names
  }
  
  object_names <- names(model_objects)
  
  m <- mapply(function(.x, .y) {
    if (.x$family$link == "identity") {
      r2 <- geeRsquared(.x)
      R2 <- r2$R2
      adjR2 <- r2$adjR2
      D <- NA
      Lloss <- NA
      PCP <- data.frame(pcp_model=NA, model_ci_low=NA, model_ci_high=NA, lrt_chisq=NA)
      
    } else if (.x$family$link == "logit") {
      R2 <- NA
      adjR2 <- NA
      D <- performance::r2_tjur(.x)
      Lloss <- performance::performance_logloss(.x)
      PCP <- performance::performance_pcp(.x)
      
    } else {
      R2 <- NA
      adjR2 <- NA
      D <- NA
      Lloss <- NA
      PCP <- data.frame(pcp_model=NA, model_ci_low=NA, model_ci_high=NA, lrt_chisq=NA)
      
    }
    dat <- data.frame(R2=R2,
                      adjR2=adjR2,
                      D=D,
                      GPAIC=glmtoolbox::AGPC(.x, verbose=FALSE),
                      GPSBIC=glmtoolbox::SGPC(.x, verbose=FALSE),
                      Lloss=Lloss,
                      ePCP=PCP$pcp_model,
                      ePCP95Lo=PCP$model_ci_low,
                      ePCP95Hi=PCP$model_ci_high,
                      ePCPChiSq=PCP$lrt_chisq
                      )
    # omit NA columns
    dat <- Filter(function(x)!all(is.na(x)), dat)
    
    model_name <- gsub("\"", "", insight::safe_deparse(.y), fixed = TRUE)
    perf_df <- data.frame(Name = model_name, Model = class(.x)[1], dat, stringsAsFactors = FALSE)

  }, model_objects, object_names, SIMPLIFY = FALSE)
  
  # merge dataframes
  dfs <- tibble(Reduce(function(x, y) merge(x, y, all = TRUE, sort = FALSE), m))
  
  # add AIC and SBIC weights
  dfs$wGPAIC <- format(round(exp(-0.5*(dfs$GPAIC - min(dfs$GPAIC)))/sum(exp(-0.5*(dfs$GPAIC - min(dfs$GPAIC)))),
                           6),
                     scientific=FALSE, format=f, digits=6)
  dfs$wGPSBIC <- format(round(exp(-0.5*(dfs$GPSBIC - min(dfs$GPSBIC)))/sum(exp(-0.5*(dfs$GPSBIC - min(dfs$GPSBIC)))),
                           6),
                     scientific=FALSE, format=f, digits=6)
  
  # move columns
  dfs <- dfs |> dplyr::relocate(wGPAIC, .after=GPAIC)
  dfs <- dfs |> dplyr::relocate(wGPSBIC, .after=GPSBIC)
  
  # print output if verbose input argument is true
  if (verbose){
    print(dfs)
  }

  return(dfs)
}


```

## (Herron) estimated percentage correct predictions (ePCP) for GLMM models

```{r}

glmmPCP <- function(...){
   if (length(list(...)) == 1){
      
      model_objects <- insight::ellipsis_info(..., ..., only_models = TRUE)
      model_objects <- model_objects[1]

  } else{

      model_objects <- insight::ellipsis_info(..., only_models = TRUE)
  
  }
  
  # ensure proper object names
  dot_names <- sapply(match.call(expand.dots = FALSE)[["..."]], as.character)
  check_object_names <- insight::compact_character(names(model_objects))
  if ((is.null(check_object_names) ||
    # or if length of names doesn't match number of models
    length(check_object_names) != length(model_objects) ||
    # or if names are "..1", "..2" pattern
    all(grepl("\\.\\.\\d", check_object_names))) &&
    # and length of dot-names must match length of objects
    length(model_objects) == length(dot_names)) {
    names(model_objects) <- dot_names
  }
  
  object_names <- names(model_objects)
  
  m <- mapply(function(.x, .y) {
    y_full <- .x@resp$y

    n_full <- suppressWarnings(insight::n_obs(.x))

    pr_full <- stats::predict(.x, type = "response")
    
    pcp_full <- (sum(1 - pr_full[y_full == 0]) + sum(pr_full[y_full == 1])) / n_full
    
    dat <- data.frame(ePCP=pcp_full)
    model_name <- gsub("\"", "", insight::safe_deparse(.y), fixed = TRUE)
    perf_df <- data.frame(Name = model_name, Model = class(.x)[1], dat, stringsAsFactors = FALSE)

  }, model_objects, object_names, SIMPLIFY = FALSE)
  
  dfs <- Reduce(function(x, y) merge(x, y, all = TRUE, sort = FALSE), m)

  return(dfs)

}


```

## Formatting GEE parameters

```{r}

geeParams <- function(geeMod, ci=0.95, exponentiate=TRUE, varest='bias-corrected',
                      round=NULL, verbose=TRUE){
  
  geeModParams <- tidy(geeMod, exponentiate=exponentiate, conf.level=ci, conf.int=TRUE, varest=varest)
  
  if (!is.null(round)){
    
    parOut <- tibble(cbind(geeModParams[, names(geeModParams)=='term'], round(geeModParams[, names(geeModParams)!='term'], round)))

  } else{
    
    parOut <- geeModParams
    
  }
  
  
  if (verbose){
    print(parOut)
  }
  return(parOut)
  
}

```

## Compiling Firth-penalised GEE parameters

```{r}

geefirthParams <- function(geefirthMod, ci=0.95, exponentiate=TRUE, verbose=TRUE){

  a = 1 - ci
  
  if (exponentiate){
    parOut <- cbind(data.frame(Odds_Ratio=round(exp(geefirthMod$coefficients$coefficients),
                                              4),
                               OR_WaldCI.lo=paste("[",
                                             round(exp(geefirthMod$coefficients$coefficients - qnorm(a/2,
                                                                                                     lower.tail=FALSE)*geefirthMod$coefficients$std.err),
                                                   4)),
                               OR_WaldCI.hi=paste(round(exp(geefirthMod$coefficients$coefficients + qnorm(a/2,
                                                                                                          lower.tail=FALSE)*geefirthMod$coefficients$std.err),
                                                   4),
                                             "]"),
                             row.names=row.names(geefirthMod$coefficients)),
                  round(subset(geefirthMod$coefficients, select=-c(coefficients)), 4))
  } else{
    parOut <- cbind(round(geefirthMod$coefficients$coefficients, 4),
                    data.frame(WaldCI.lo=paste("[",
                                               round(geefirthMod$coefficients$coefficients - qnorm(a/2,
                                                                                                   lower.tail=FALSE)*geefirthMod$coefficients$std.err, 4)),
                               WaldCI.hi=paste(round(geefirthMod$coefficients$coefficients + qnorm(a/2, lower.tail=FALSE)*geefirthMod$coefficients$std.err,
                                                   4),
                                             "]"),
                               row.names=row.names(geefirthMod$coefficients)),
                  round(subset(geefirthMod$coefficients, select=-c(coefficients)), 4))
  }
  
  
  if (verbose){
    print(parOut)
  }
  return(parOut)
}

```

## Assign nearest numbers from list

```{r}

numberSnap <- function(numbersIn, numberList, rangeVal){
  
  numberList<-sort(numberList)          # need them sorted
  rangeVal <- rangeVal*1.000001                             # avoid rounding issues
  nearest <- findInterval(numbersIn, numberList - rangeVal) # index of nearest
  nearest <- c(-Inf, numberList)[nearest + 1]  # value of nearest
  diff <- numbersIn - nearest                           # compute errors
  snap <- diff <= rangeVal                               # only snap near numbers
  
  numbersOut <- numbersIn
  numbersOut[snap] <- nearest[snap]                      # snap values to nearest
  
  return(numbersOut)
  
}


```

## Rescale ggplot tick marks fo variables

```{r}

rescaleTicks <- function(dataVar, dataVarScl, sep=3, ax='x'){
  
  if (ax == 'x'){
    outAx <- scale_x_continuous(breaks=seq(floor(min(dataVar)),
                                           ceiling(max(dataVar)),
                                           by=sep) -
                                  (max(dataVar) - max(dataVarScl)),
                                labels=seq(floor(min(dataVar)),
                                           ceiling(max(dataVar)),
                                           by=sep))

  } else if (ax == 'y'){
    outAx <- scale_y_continuous(breaks=seq(floor(min(dataVar)),
                                           ceiling(max(dataVar)),
                                           by=sep) -
                                  (max(dataVar) - max(dataVarScl)),
                                labels=seq(floor(min(dataVar)),
                                           ceiling(max(dataVar)),
                                           by=sep))
  } else {
    stop("Invalid axis argument")
  }
 
  return(outAx) 
}


```

# Import data and wrangle

## Parts A & B combined

```{r}


subjDataPath <- utils::choose.files(caption=r"(Select refmap_listest1_testdata_BySubj.csv from 03 Experiment\Experiment 1\Analysis\PostProcess)",
                                     filters=matrix(data=c("refmap_listest1_testdata_BySubj.csv", "refmap_listest1_testdata_BySubj.csv"), ncol=2))

subjData <- read.csv(subjDataPath, header=TRUE)

stimDataPath <- utils::choose.files(caption=r"(Select refmap_listest1_testdata_ByStim.csv from 03 Experiment\Experiment 1\Analysis\PostProcess)",
                                     filters=matrix(data=c("refmap_listest1_testdata_ByStim.csv", "refmap_listest1_testdata_ByStim.csv"), ncol=2))

stimData <- read.csv(stimDataPath, header=TRUE)

```

```{r}
# definition of ordinal variable levels
UASLAeqCatsA <- c("No UAS", "42", "48", "54", "60")
SNRCatsA <- c("No UAS", "-16", "-10", "-4", "2", "8")
UASOpCatsA <- c("No UAS", "Flyover", "Landing", "Takeoff")
UASTypeCatsA <- c("No UAS", "H520", "M300", "T150")

# encode factors
subjData$ID. <- factor(subjData$ID.)
subjData$UASLAeq <- factor(subjData$UASLAeq, levels=UASLAeqCatsA, order=TRUE)
subjData$SNRlevel <- factor(subjData$SNRlevel, levels=SNRCatsA, order=TRUE)
subjData$UASOperation <- factor(subjData$UASOperation, levels=UASOpCatsA)
subjData$UASType <- factor(subjData$UASType, levels=UASTypeCatsA)
subjData$AmbientEnv <- factor(subjData$AmbientEnv, levels=c("Park", "Street"))
subjData$AAM_attitude <- factor(subjData$AAM_attitude)
subjData$Home_Area <- factor(subjData$Home_Area)
subjData$Area_soundscape <- factor(subjData$Area_soundscape)
subjData$NationGeo <- factor(subjData$NationGeo)
subjData$NativeLang <- factor(subjData$NativeLang)


# re-reference AAM_attitude
subjData$AAM_attitude <- factor(subjData$AAM_attitude) |> relevel(ref="Supportive")

# recode AAM_attitude to 3 groups
subjData <- subjData |> dplyr::mutate(AAM_attitude3 = case_match(AAM_attitude,
                                                                    "Supportive" ~ "Supportive",
                                                                      "Neutral" ~ "Neutral",
                                                                    c("Ambivalent",
                                                                      "Concerned") ~ "Ambiv_Concern"))
subjData$AAM_attitude3 <- factor(subjData$AAM_attitude3, levels=c("Supportive", "Neutral", "Ambiv_Concern")) |>
                          relevel(subjData$AAM_attitude3, ref="Supportive")

# recode AAM_attitude to 2 groups
subjData <- subjData |> dplyr::mutate(AAM_attitude2 = case_match(AAM_attitude,
                                                                    "Supportive" ~ "Supportive",
                                                                    c("Ambivalent",
                                                                      "Concerned",
                                                                      "Neutral") ~ "Ambiv_Concern_Neutral"))
subjData$AAM_attitude2 <- factor(subjData$AAM_attitude2) |> relevel(subjData$AAM_attitude2, ref="Supportive")

# recode AAM_attitude to 2 other groups
subjData <- subjData |> dplyr::mutate(AAM_attitude2_2 = case_match(AAM_attitude,
                                                                    c("Supportive",
                                                                      "Ambivalent") ~ "Support_Ambiv",
                                                                    c("Concerned",
                                                                      "Neutral") ~ "Concern_Neutral"))

subjData$AAM_attitude2_2 <- factor(subjData$AAM_attitude2_2) |> relevel(subjData$AAM_attitude2_2, ref="Support_Ambiv")

# recode NationGeo to 4 groups
subjData <- subjData |> dplyr::mutate(NationGeo4 = case_match(NationGeo,
                                                               "UK" ~ "UK",
                                                               c("Africa",
                                                                 "SouthAsia") ~ "Africa_SAsia",
                                                               c("Australasia",
                                                                 "EastAsia",
                                                                 "Europe",
                                                                 "MidEast",
                                                                 "SouthAmerica") ~ "Other",
                                                               "" ~ "Unspecified"))
subjData$NationGeo4 <- factor(subjData$NationGeo4) |> relevel(subjData$NationGeo4, ref="UK")

# recode NationGeo to 3 groups
subjData <- subjData |> dplyr::mutate(NationGeo3 = case_match(NationGeo,
                                                                 "UK" ~ "UK",
                                                                 c("Africa",
                                                                   "SouthAsia") ~ "Africa_SAsia",
                                                                 c("Australasia",
                                                                   "EastAsia",
                                                                   "Europe",
                                                                   "MidEast",
                                                                   "SouthAmerica",
                                                                   "") ~ "Other"))

subjData$NationGeo3 <- factor(subjData$NationGeo3) |> relevel(subjData$NationGeo3, ref="UK")

# recode NationGeo to 2 groups
subjData <- subjData |> dplyr::mutate(NationGeo2 = case_match(NationGeo,
                                                                 "UK" ~ "UK",
                                                                 c("Africa",
                                                                   "SouthAsia",
                                                                   "Australasia",
                                                                   "EastAsia",
                                                                   "Europe",
                                                                   "MidEast",
                                                                   "SouthAmerica",
                                                                   "") ~ "Other"))

subjData$NationGeo2 <- factor(subjData$NationGeo2) |> relevel(subjData$NationGeo2, ref="UK")


# recode Area of residence to 2 groups
subjData <- subjData |> dplyr::mutate(Home_Area2 = case_match(Home_Area,
                                                         "Urban" ~ "Urban",
                                                         c("Suburban",
                                                           "Rural") ~ "Suburban_Rural"))

subjData$Home_Area2 <- factor(subjData$Home_Area2) |> relevel(subjData$Home_Area2, ref="Urban")


# recode Area soundscape to 2 groups
subjData <- subjData |> dplyr::mutate(Area_soundscape2 = case_match(Area_soundscape,
                                                                       c("Calm",
                                                                         "Monotonous") ~ "Uneventful",
                                                                       c("Chaotic",
                                                                         "Vibrant") ~ "Eventful"))

subjData$Area_soundscape2 <- factor(subjData$Area_soundscape2)

# create column with Part B TrialNumbers continuing from Part A
subjData$TrialNumberCnt <- subjData$TrialNumber
subjData$TrialNumberCnt[subjData$SessionPart == "B"] <- subjData$TrialNumberCnt[subjData$SessionPart == "B"] + 
                                                              max(subjData$TrialNumber[subjData$SessionPart=="A"])

# ensure that participant ID. 17 TrialNumberCnt starts from 61 (as they had done 60 in Part A)
subjData$TrialNumberCnt[subjData$ID. == 17] <- subjData$TrialNumberCnt[subjData$ID. == 17] - 20

# rescale trial number variables separately for each session part
subjData <- rbind(subjData[subjData$SessionPart == "A", ] |> dplyr::mutate(TrialNumberScl = datawizard::standardise(TrialNumber, scale=TRUE)),
                    subjData[subjData$SessionPart == "B", ] |> dplyr::mutate(TrialNumberScl = datawizard::standardise(TrialNumber, scale=TRUE)))
subjData <- subjData |> dplyr::mutate(TrialNumberCntScl = datawizard::standardise(TrialNumberCnt, scale=TRUE))

# relocate new columns
subjData <- subjData |> dplyr::relocate(TrialNumberCnt, TrialNumberScl,
                                        TrialNumberCntScl, .after=TrialNumber)

# rescale variables
subjData <- subjData |> dplyr::mutate(UASLAeqMaxLRScl = datawizard::standardise(UASLAeqMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASLAEMaxLRScl = datawizard::standardise(UASLAEMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASEPNLMaxLRScl = datawizard::standardise(UASEPNLMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(LAELAF50diffScl = datawizard::standardise(LAELAF50diff, scale=FALSE))
subjData <- subjData |> dplyr::mutate(LAELAeqdiffScl = datawizard::standardise(LAELAeqdiff, scale=FALSE))
subjData <- subjData |> dplyr::mutate(EPNLLAeqdiffScl = datawizard::standardise(EPNLLAeqdiff, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASDisc0p5LAEMaxLRScl = datawizard::standardise(UASDisc0p5LAEMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(UASDisc0p5PAEMaxLR = 2e-5*10^(UASDisc0p5LAEMaxLR/20))
subjData <- subjData |> dplyr::mutate(UASLoudECMAPowAvgBinScl = datawizard::standardise(UASLoudECMAPowAvgBin, scale=FALSE))
subjData <- subjData |> dplyr::mutate(IntermitRatioC2MaxLRScl = IntermitRatioC2MaxLR/100)
subjData <- subjData |> dplyr::mutate(IntermitRatioC3MaxLRScl = IntermitRatioC3MaxLR/100)
subjData <- subjData |> dplyr::mutate(IntermitRatioC5MaxLRScl = IntermitRatioC5MaxLR/100)
subjData <- subjData |> dplyr::mutate(AmbLAeqMaxLRScl = datawizard::standardise(AmbLAeqMaxLR, scale=FALSE))
subjData <- subjData |> dplyr::mutate(AmbLAF50ExMaxLRScl = datawizard::standardise(AmbLAF50ExMaxLR, scale=FALSE))


stimData <- stimData |> dplyr::mutate(UASLAeqMaxLRScl = datawizard::standardise(UASLAeqMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASLAEMaxLRScl = datawizard::standardise(UASLAEMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASEPNLMaxLRScl = datawizard::standardise(UASEPNLMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(LAELAF50diffScl = datawizard::standardise(LAELAF50diff, scale=FALSE))
stimData <- stimData |> dplyr::mutate(LAELAeqdiffScl = datawizard::standardise(LAELAeqdiff, scale=FALSE))
stimData <- stimData |> dplyr::mutate(EPNLLAeqdiffScl = datawizard::standardise(EPNLLAeqdiff, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASDisc0p5LAEMaxLRScl = datawizard::standardise(UASDisc0p5LAEMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(UASDisc0p5PAEMaxLR = 2e-5*10^(UASDisc0p5LAEMaxLR/20))
stimData <- stimData |> dplyr::mutate(UASLoudECMAPowAvgBinScl = datawizard::standardise(UASLoudECMAPowAvgBin, scale=FALSE))
stimData <- stimData |> dplyr::mutate(IntermitRatioC2MaxLRScl = IntermitRatioC2MaxLR/100)
stimData <- stimData |> dplyr::mutate(IntermitRatioC3MaxLRScl = IntermitRatioC3MaxLR/100)
stimData <- stimData |> dplyr::mutate(IntermitRatioC5MaxLRScl = IntermitRatioC5MaxLR/100)
stimData <- stimData |> dplyr::mutate(AmbLAeqMaxLRScl = datawizard::standardise(AmbLAeqMaxLR, scale=FALSE))
stimData <- stimData |> dplyr::mutate(AmbLAF50ExMaxLRScl = datawizard::standardise(AmbLAF50ExMaxLR, scale=FALSE))

# convert detectability dB to log variables
subjData <- subjData |> dplyr::mutate(Detect0p1IntMaxLRLog = Detect0p1dBIntMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p5IntMaxLRLog = Detect0p5dBIntMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p1MaxMaxLRLog = Detect0p1dBMaxMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p5MaxMaxLRLog = Detect0p5dBMaxMaxLR/10)
subjData <- subjData |> dplyr::mutate(Detect0p1IntMaxLRLogScl = datawizard::standardise(Detect0p1IntMaxLRLog, scale=FALSE))
subjData <- subjData |> dplyr::mutate(Detect0p5IntMaxLRLogScl = datawizard::standardise(Detect0p5IntMaxLRLog, scale=FALSE))
subjData <- subjData |> dplyr::mutate(Detect0p1MaxMaxLRLogScl = datawizard::standardise(Detect0p1MaxMaxLRLog, scale=FALSE))
subjData <- subjData |> dplyr::mutate(Detect0p5MaxMaxLRLogScl = datawizard::standardise(Detect0p5MaxMaxLRLog, scale=FALSE))

stimData <- stimData |> dplyr::mutate(Detect0p1IntMaxLRLog = Detect0p1dBIntMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p5IntMaxLRLog = Detect0p5dBIntMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p1MaxMaxLRLog = Detect0p1dBMaxMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p5MaxMaxLRLog = Detect0p5dBMaxMaxLR/10)
stimData <- stimData |> dplyr::mutate(Detect0p1IntMaxLRLogScl = datawizard::standardise(Detect0p1IntMaxLRLog, scale=FALSE))
stimData <- stimData |> dplyr::mutate(Detect0p5IntMaxLRLogScl = datawizard::standardise(Detect0p5IntMaxLRLog, scale=FALSE))
stimData <- stimData |> dplyr::mutate(Detect0p1MaxMaxLRLogScl = datawizard::standardise(Detect0p1MaxMaxLRLog, scale=FALSE))
stimData <- stimData |> dplyr::mutate(Detect0p5MaxMaxLRLogScl = datawizard::standardise(Detect0p5MaxMaxLRLog, scale=FALSE))

# Log other variables
subjData$PartLoudMGLT05ExLog <- log(subjData$PartLoudMGLT05Ex)
subjData$PartLoudMGST05ExLog <- log(subjData$PartLoudMGST05Ex)
subjData$PartLoudMGLTPowAvgLog <- log(subjData$PartLoudMGLTPowAvg)
subjData$PartLoudMGSTPowAvgLog <- log(subjData$PartLoudMGSTPowAvg)

stimData$PartLoudMGLT05ExLog <- log(stimData$PartLoudMGLT05Ex)
stimData$PartLoudMGST05ExLog <- log(stimData$PartLoudMGST05Ex)
stimData$PartLoudMGLTPowAvgLog <- log(stimData$PartLoudMGLTPowAvg)
stimData$PartLoudMGSTPowAvgLog <- log(stimData$PartLoudMGSTPowAvg)

# reorder by participant ID and trial number
subjData <- subjData[with(subjData, order(ID., TrialNumberCnt)), ]

# omit ambient-only stimuli
subjDataNoAmb <- subjData |> dplyr::filter(UASLAeq != "No UAS")
stimDataNoAmb <- stimData |> dplyr::filter(UASLAeq != "No UAS")

# re-encode factors omitting ambient-only stimuli
subjDataNoAmb$SNRlevel <- factor(subjDataNoAmb$SNRlevel, levels=SNRCatsA[2:length(SNRCatsA)], order=TRUE)
subjDataNoAmb$UASOperation <- factor(subjDataNoAmb$UASOperation, levels=UASOpCatsA[2: length(UASOpCatsA)])
subjDataNoAmb$UASType <- factor(subjDataNoAmb$UASType, levels=UASTypeCatsA[2:length(UASTypeCatsA)])
stimDataNoAmb$SNRlevel <- factor(stimDataNoAmb$SNRlevel, levels=SNRCatsA[2:length(SNRCatsA)], order=TRUE)
stimDataNoAmb$UASOperation <- factor(stimDataNoAmb$UASOperation, levels=UASOpCatsA[2: length(UASOpCatsA)])
stimDataNoAmb$UASType <- factor(stimDataNoAmb$UASType, levels=UASTypeCatsA[2:length(UASTypeCatsA)])

```

# Parts A + B standardised trial indexing plot

```{r, 6.4, fig.height=4}

dataFrame <- subjData |> group_by(TrialNumberScl) |> summarise(dAnnoyance = mean(dAnnoyance))

ggplot(data=dataFrame, mapping=aes(TrialNumberScl, dAnnoyance)) + geom_point(color=mycolours[1], alpha=0.3) +
       geom_smooth(formula = y ~ x, method = "lm", alpha=0.3, color=mycolours[1]) +
       theme(text = element_text(family = "serif"), panel.grid=element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255))) + 
       labs(x="Trial number (standardised)", y="Change in annoyance rating\n(rel. to baseline)") + scale_y_continuous(n.breaks=10, limits=c(-4, 7))

```

```{r, 6.4, fig.height=4}

dataFrame <- subjData |> group_by(TrialNumberCntScl) |> summarise(dAnnoyance = mean(dAnnoyance))

ggplot(data=dataFrame, mapping=aes(TrialNumberCntScl, dAnnoyance)) + geom_point(color=mycolours[1], alpha=0.3) +
       geom_smooth(formula = y ~ x, method = "lm", alpha=0.3, color=mycolours[1]) +
       theme(text = element_text(family = "serif"), panel.grid=element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255))) + 
       labs(x="Trial number (standardised)", y="Change in annoyance rating\n(rel. to baseline)") + scale_y_continuous(n.breaks=10, limits=c(-4, 7))

```

# Change in mean annoyance rating - Parts A & B combined analysis

## Categorical variables

### Initial working correlation structure selection for maximal model based on information from ANOVA

Non-stationary and unstructured are numerically unstable

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~  UASLAEMaxLRScl*UASType*UASOperation +
                                 UASLAEMaxLRScl*AmbientEnv +
                                 UASType*UASOperation*AmbientEnv +
                                 UASLAEMaxLRScl*I(UASEvents^-1) +
                                 TrialNumberCntScl,
                                 maxit=2e3,                                 
                                 data=subjDataNoAmb, family=gaussian(link='identity'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*UASType*UASOperation +
                               UASLAEMaxLRScl*AmbientEnv +
                               UASType*UASOperation*AmbientEnv +
                               UASLAEMaxLRScl*I(UASEvents^-1) +
                               TrialNumberCntScl,
                               data=subjDataNoAmb, family=gaussian(link='identity'),
                               id=ID., corstr='exchangeable')
geeModelPerformance(modelMax, verbose=TRUE)

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}

model1 <- mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                      UASLAEMaxLRScl*UASType +
                                                                      UASLAEMaxLRScl*UASOperation +
                                                                      UASLAEMaxLRScl*AmbientEnv +
                                                                      UASType*UASOperation*AmbientEnv +
                                                                      TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASType [T150, H520]",
                                                                 "UASLAEMaxLRScl [10]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))



model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover'),],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dAnnoyMean,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title="UAS LAE", reverse=TRUE)) +  
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x="Number of UAS flyover events", y="Mean change in annoyance")

p5

```

### fit stepwise-selected model but with a log(events) term

```{r}

model1 <- mABEnvxTypexOpxLAExEnvlgQxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                                                      UASLAEMaxLRScl*UASType +
                                                                      UASLAEMaxLRScl*UASOperation +
                                                                      UASLAEMaxLRScl*AmbientEnv +
                                                                      UASType*UASOperation*AmbientEnv +
                                                                      TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypexOpxLAExEnvlgQxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASType [T150, H520]",
                                                                 "UASLAEMaxLRScl [10]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))



model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover'),],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dAnnoyMean,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title="UAS LAE", reverse=TRUE)) +  
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=TRUE),
                     fill=guide_legend(title="UAS type", reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x="Number of UAS flyover events", y="Mean change in annoyance")

p5

```

### refine stepwise model - omit 3-way interaction of env with UAS Type and Op

```{r}

model1 <- mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                      UASLAEMaxLRScl*UASType +
                                                                      UASLAEMaxLRScl*UASOperation +
                                                                      UASLAEMaxLRScl*AmbientEnv +
                                                                      UASType:UASOperation +
                                                                      UASType:AmbientEnv +
                                                                      UASOperation:AmbientEnv +
                                                                      TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)


```

### refine maximal model - omit type-op interaction

```{r}

model1 <- mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                      UASLAEMaxLRScl*UASType +
                                                                      UASLAEMaxLRScl*UASOperation +
                                                                      UASLAEMaxLRScl*AmbientEnv +
                                                                      UASType:AmbientEnv +
                                                                      UASOperation:AmbientEnv +
                                                                TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

```

### refine maximal model - omit env-type interaction

```{r}

model1 <- mABEnvxOpTypexLAExEnv1_QxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                      UASLAEMaxLRScl*UASType +
                                                                      UASLAEMaxLRScl*UASOperation +
                                                                      UASLAEMaxLRScl*AmbientEnv +
                                                                      UASOperation:AmbientEnv +
                                                                      TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE, mABEnvxOpTypexLAExEnv1_QxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

```

### refine maximal model - omit env-op interaction

```{r}

model1 <- mABLAExTypeOpxLAExEnv1_QxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                UASLAEMaxLRScl*UASType +
                                                                UASLAEMaxLRScl*UASOperation +
                                                                UASLAEMaxLRScl*AmbientEnv +
                                                                TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE, mABEnvxOpTypexLAExEnv1_QxLAESq.GEE,
                    mABLAExTypeOpxLAExEnv1_QxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

```

### Hybrid stepwise-backward model reselection for favoured model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABLAExTypeOpxLAExEnv1_QxLAESq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

Although the stepwise-selection favours the marginally simpler model omitting LAE\*UAStype interaction, the model including this interaction is retained for the final model due to the apparent importance of this interaction as evident in the charts and in the 84.3 confidence intervals.

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                  UASLAEMaxLRScl*UASType +
                                  UASLAEMaxLRScl*UASOperation +
                                  UASLAEMaxLRScl*AmbientEnv +
                                  TrialNumberCntScl,
                                 data=subjDataNoAmb,
                                 family=gaussian(link='identity'),
                                 id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABLAExTypeOpxLAExEnv1_QxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                  UASLAEMaxLRScl*UASType +
                                                                  UASLAEMaxLRScl*UASOperation +
                                                                  UASLAEMaxLRScl*AmbientEnv +
                                                                  TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE, mABEnvxOpTypexLAExEnv1_QxLAESq.GEE,
                    mABLAExTypeOpxLAExEnv1_QxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dAnnoyMean,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +  
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x="Number of UAS flyover events", y="Mean change in annoyance")

p5


```

### examine final model with log(events) term

```{r}

model1 <- mABLAExTypeOpxLAExEnvlgQxLAESq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                                                  UASLAEMaxLRScl*UASType +
                                                                  UASLAEMaxLRScl*UASOperation +
                                                                  UASLAEMaxLRScl*AmbientEnv +
                                                                  TrialNumberCntScl,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE, mABEnvxOpTypexLAExEnv1_QxLAESq.GEE,
                    mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABLAExTypeOpxLAExEnvlgQxLAESq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2CopyOver <- ggeffects::predict_response(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dAnnoyMean,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8,
                                  breaks=c(73, 79)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(data=model1predictEvt2CopyOver,
                          aes(x=x, ymin=conf.low, ymax=conf.high, fill=group),
                          alpha=0.05) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, colour=group),
                          linewidth=0.5, linetype=3, fill=NA, alpha=0.25) +
              
              geom_line(data=model1predictEvt2CopyOver,
                        aes(x=x, y=predicted, colour=group), linewidth=1, alpha=0.5) +
  
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5,
                        linewidth=1, linetype=3) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9), labels=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x="Number of UAS flyover events", y="Mean change in annoyance")

p5


```

### with personal factors

```{r}

model1 <- mABLAExTypeOpxLAExEnv1_QxLAESqNatAtt.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                  UASLAEMaxLRScl*UASType +
                                                                  UASLAEMaxLRScl*UASOperation +
                                                                  UASLAEMaxLRScl*AmbientEnv +
                                                                  TrialNumberCntScl +
                                                                    NationGeo2 + AAM_attitude2,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.84, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE, mABEnvxOpTypexLAExEnv1_QxLAESq.GEE,
                    mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABLAExTypeOpxLAExEnv1_QxLAESqNatAtt.GEE)

# predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
#                            response=stimDataNoAmb$dAnnoyMean,
#                            fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
# ggplot(data=predictMeans) +
#   theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
#         axis.text=element_text(family = "serif", size=14)) +
#   
#   geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
#   
#   geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
#   
#   scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
#   scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
#   
#   labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


model1predictNat <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "NationGeo2 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictAtt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "AAM_attitude2 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dAnnoyMean,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +  
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x="Number of UAS flyover events", y="Mean change in annoyance")

p5

p6 <- ggplot(data=model1predictNat) +
              theme(panel.grid = element_blank(),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Nat. region", reverse=FALSE),
                     fill=guide_legend(title="Nat. region", reverse=FALSE)) +
  
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p6

p7 <- ggplot(data=model1predictAtt) +
              theme(panel.grid = element_blank(),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="AAM attitude", reverse=TRUE),
                     fill=guide_legend(title="AAM attitude", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p7


```

### personal factors: language

```{r}

model1 <- mABLAExTypeOpxLAExEnv1_QxLAESqNatAttLang.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                                  UASLAEMaxLRScl*UASType +
                                                                  UASLAEMaxLRScl*UASOperation +
                                                                  UASLAEMaxLRScl*AmbientEnv +
                                                                  TrialNumberCntScl +
                                                                    NationGeo2 + AAM_attitude2 +
                                                                    NativeLang,
                                                                data=subjDataNoAmb,
                                                                family=gaussian(link='identity'),
                                                                id=ID.,
                                                                corstr='exchangeable')

geeParams(model1, ci=0.84, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABEnvxTypexOpxLAExEnv1_QxLAESq.GEE, mABTypexEnvxOpxLAExEnv1_QxLAESq.GEE,
                    mABEnvxTypeOpxLAExEnv1_QxLAESq.GEE, mABEnvxOpTypexLAExEnv1_QxLAESq.GEE,
                    mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABLAExTypeOpxLAExEnv1_QxLAESqNatAtt.GEE,
                    mABLAExTypeOpxLAExEnv1_QxLAESqNatAttLang.GEE)

# predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
#                            response=stimDataNoAmb$dAnnoyMean,
#                            fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
# ggplot(data=predictMeans) +
#   theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
#         axis.text=element_text(family = "serif", size=14)) +
#   
#   geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
#   
#   geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
#   
#   scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
#   scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
#   
#   labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


model1predictNat <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "NationGeo2 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictAtt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "AAM_attitude2 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLang <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "NativeLang [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              #scale_x_continuous(breaks=seq(55, 80, by=5)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(y="Mean change in annoyance")


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                             colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dAnnoyMean,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +  
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x="Number of UAS flyover events", y="Mean change in annoyance")

p5

p6 <- ggplot(data=model1predictNat) +
              theme(panel.grid = element_blank(),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Nat. region", reverse=FALSE),
                     fill=guide_legend(title="Nat. region", reverse=FALSE)) +
  
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p6

p7 <- ggplot(data=model1predictAtt) +
              theme(panel.grid = element_blank(),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="AAM attitude", reverse=TRUE),
                     fill=guide_legend(title="AAM attitude", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p7


p9 <- ggplot(data=model1predictLang) +
              theme(panel.grid = element_blank(),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Language", reverse=TRUE),
                     fill=guide_legend(title="Language", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p9

```

## UAS info only

### Initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                   UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMAvgMaxLR +
                                   UASLAEMaxLRScl:UASFluctOV10ExMaxLR +
                                   UASLAEMaxLRScl:UASImpulsSHMAvgMaxLR +
                                   UASLAEMaxLRScl:UASRoughFZ05ExMaxLR +
                                   UASLAEMaxLRScl:UASSharpAurISO305ExMaxLR +
                                   UASLAEMaxLRScl:UASTonLdECMAPowAvgBin +
                                   TrialNumberCntScl,
                                 maxit=2e3,
                                 data=subjDataNoAmb,
                                 family=gaussian(link='identity'),
                                 id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}


```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                               UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMAvgMaxLR +
                               UASLAEMaxLRScl:UASImpulsSHMAvgMaxLR +
                               UASLAEMaxLRScl:UASTonLdECMAPowAvgBin +
                               UASLAEMaxLRScl:UASSharpAurISO305ExMaxLR +
                               UASLAEMaxLRScl:UASFluctOV10ExMaxLR +
                               UASLAEMaxLRScl:UASRoughFZ05ExMaxLR +
                               TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=gaussian(link='identity'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}

model1 <- mABISxTnLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                        UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                        UASImpulsSHMAvgMaxLR +
                                                        TrialNumberCntScl,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                                         stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p1



```

### omit impulsiveness

```{r}

model1 <- mABSxTnLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                        UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                        TrialNumberCntScl,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABSxTnLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p1



```

### omit sharpness-tonal loudness interaction

```{r}

model1 <- mABSTnLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                      UASTonLdECMAPowAvgBin + UASSharpAurISO305ExMaxLR +
                                                      TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABSxTnLAEx1_QSq.GEE, mABSTnLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p1



```

### substitute loudness for LAE

```{r}

model1 <- mABISxTnNx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLoudECMAPowAvgBin*I(UASEvents^-1) +
                                                        UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                        UASImpulsSHMAvgMaxLR +
                                                        TrialNumberCntScl,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABSxTnLAEx1_QSq.GEE, mABSTnLAEx1_QSq.GEE,
                    mABISxTnNx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +

              labs(x=expression(paste(UAS~italic(N)^"*",",",~sone[SHM])), y="Mean change in annoyance")

p1

```

### LAE, events and trial sequence only

```{r}

model1 <- mABLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                      TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABSxTnLAEx1_QSq.GEE, mABSTnLAEx1_QSq.GEE,
                    mABISxTnNx1_QSq.GEE, mABLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +

              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p1

```

### substitute tonality for tonal loudness

```{r}

model1 <- mABISxTLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                        UASTonalSHMInt05ExMaxLR*UASSharpAurISO305ExMaxLR +
                                                        UASImpulsSHMAvgMaxLR +
                                                        TrialNumberCntScl,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')


geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABSxTnLAEx1_QSq.GEE, mABSTnLAEx1_QSq.GEE,
                    mABISxTnNx1_QSq.GEE, mABLAEx1_QSq.GEE,
                    mABISxTLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxT <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASTonalSHMInt05ExMaxLR [0.25:1.25, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxT) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=UASTonalSHMInt05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.25, 1.25, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3



```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                UASImpulsSHMAvgMaxLR +
                                TrialNumberCntScl,
                                data=subjDataNoAmb,
                                family=gaussian(link='identity'),
                                id=ID.,
                                corstr=corstr)
  print(corstr)
  
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABISxTnLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                      UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                      UASImpulsSHMAvgMaxLR +
                                                      TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABISxTnLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=16),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-1, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3



```

## with env class

### Initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                   UASLAEMaxLRScl*AmbientEnv +
                                 UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMAvgMaxLR +
                                 UASLAEMaxLRScl:UASFluctOV10ExMaxLR +
                                 UASLAEMaxLRScl:UASImpulsSHMAvgMaxLR +
                                 UASLAEMaxLRScl:UASRoughFZ05ExMaxLR +
                                 UASLAEMaxLRScl:UASSharpAurISO305ExMaxLR +
                                 UASLAEMaxLRScl:UASTonLdECMAPowAvgBin +
                                 AmbientEnv:UASFluctOV10ExMaxLR +
                                 AmbientEnv:UASImpulsSHMAvgMaxLR +
                                 AmbientEnv:UASRoughFZ05ExMaxLR +
                                 AmbientEnv:UASSharpAurISO305ExMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                                 maxit=2e3,
                                 data=subjDataNoAmb,
                                 family=gaussian(link='identity'),
                                 id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}


```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                   UASLAEMaxLRScl*AmbientEnv +
                                 UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMAvgMaxLR +
                                 AmbientEnv:UASFluctOV10ExMaxLR +
                                 AmbientEnv:UASImpulsSHMAvgMaxLR +
                                 AmbientEnv:UASRoughFZ05ExMaxLR +
                                 AmbientEnv:UASSharpAurISO305ExMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=gaussian(link='identity'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}

model1 <- mABISxTnxEnvLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl + I(UASEvents^-1) +
                                                      UASImpulsSHMAvgMaxLR +
                                                      UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                      AmbientEnv*UASTonLdECMAPowAvgBin +
                                                      TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABISxTnxEnvLAE1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvS <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                   "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                   "UASLAEMaxLRScl [-11, -5, 1, 6, 7, 12]",
                                                                   "AmbientEnv [all]",
                                                                   "UASEvents [1]"),
                                               margin='marginalmeans', type='fixed', 
                                              vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn$UASLAEMaxLRSclRnd <- model1predictEnvSxTn$facet
model1predictEnvSxTn$AmbientEnv <- model1predictEnvSxTn$panel

stimDataNoAmbTemp <- stimDataNoAmb
numbersIn <- stimDataNoAmbTemp$UASLAEMaxLRScl
numberList <- c(-11, -5, 1, 6, 7, 12)
stimDataNoAmbTemp$UASLAEMaxLRSclRnd <- factor(numberSnap(numbersIn, numberList, rangeVal=0.9))
facetLabels <- c('-11'="56", '-5'="62", '1'="68", '6'="73", '7'="74", '12'="79")

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',], aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 2, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*",",",~sone[SHM])), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictEnvS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 4, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance")

p1 + p2 + p3

p4 <- ggplot(data=model1predictEnvSxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.03) +

              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +

              scale_color_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +

              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              ggnewscale::new_scale_color() +

              geom_point(data=stimDataNoAmbTemp,
                         aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean,
                             colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +

              scale_color_viridis(option='mako', direction=-1, discrete=FALSE, begin = 0.2, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0, 4, by=0.4),
                                 sec.axis=dup_axis(name = expression(paste(UAS~italic(L)[AE], ",", ~dB)),
                                 breaks=NULL, labels=NULL)) +
  
              scale_y_continuous(breaks=seq(-3, 10, by=1)) +

              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance") +
              facet_grid(AmbientEnv ~ UASLAEMaxLRSclRnd,
                         labeller=labeller(UASLAEMaxLRSclRnd=facetLabels))

p4

```

### add LAE interaction with events

```{r}

model1 <- mABISxTnxEnvLAEx1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                      UASImpulsSHMAvgMaxLR +
                                                      UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                      AmbientEnv*UASTonLdECMAPowAvgBin +
                                                      TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE, mABISxTnxEnvLAE1_QSq.GEE,
                    mABISxTnxEnvLAEx1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvS <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                   "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                   "UASLAEMaxLRScl [-11, -5, 1, 6, 7, 12]",
                                                                   "AmbientEnv [all]",
                                                                   "UASEvents [1]"),
                                               margin='marginalmeans', type='fixed', 
                                              vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn$UASLAEMaxLRSclRnd <- model1predictEnvSxTn$facet
model1predictEnvSxTn$AmbientEnv <- model1predictEnvSxTn$panel

stimDataNoAmbTemp <- stimDataNoAmb
numbersIn <- stimDataNoAmbTemp$UASLAEMaxLRScl
numberList <- c(-11, -5, 1, 6, 7, 12)
stimDataNoAmbTemp$UASLAEMaxLRSclRnd <- factor(numberSnap(numbersIn, numberList, rangeVal=0.9))
facetLabels <- c('-11'="56", '-5'="62", '1'="68", '6'="73", '7'="74", '12'="79")

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',], aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 2, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*",",",~sone[SHM])), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictEnvS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 4, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance")

p1 + p2 + p3

p4 <- ggplot(data=model1predictEnvSxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.03) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmbTemp,
                         aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean,
                             colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=-1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE)) +
  
            
              scale_x_continuous(breaks=seq(0, 4, by=0.4),
                                 sec.axis=sec_axis(~ . ,
                                                   name=expression(paste(UAS~italic(L)[AE]~","~dB)),
                                                   breaks = NULL, labels = NULL)) +
              scale_y_continuous(breaks=seq(-3, 10, by=1)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance") +
              facet_grid(AmbientEnv ~ UASLAEMaxLRSclRnd,
                         labeller=labeller(UASLAEMaxLRSclRnd=facetLabels))

p4


```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl + I(UASEvents^-1) +
                                 UASImpulsSHMAvgMaxLR +
                                 UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                 AmbientEnv*UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                                 data=subjDataNoAmb,
                                 family=gaussian(link='identity'),
                                 id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABISxTnxEnvLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl + I(UASEvents^-1) +
                                                      UASImpulsSHMAvgMaxLR +
                                                      UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                      AmbientEnv*UASTonLdECMAPowAvgBin +
                                                      TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvS <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                   "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                   "UASLAEMaxLRScl [-11, -5, 1, 6, 7, 12]",
                                                                   "AmbientEnv [all]",
                                                                   "UASEvents [1]"),
                                               margin='marginalmeans', type='fixed', 
                                              vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn$UASLAEMaxLRSclRnd <- model1predictEnvSxTn$facet
model1predictEnvSxTn$AmbientEnv <- model1predictEnvSxTn$panel

stimDataNoAmbTemp <- stimDataNoAmb
numbersIn <- stimDataNoAmbTemp$UASLAEMaxLRScl
numberList <- c(-11, -5, 1, 6, 7, 12)
stimDataNoAmbTemp$UASLAEMaxLRSclRnd <- factor(numberSnap(numbersIn, numberList, rangeVal=0.9))
facetLabels <- c('-11'="56", '-5'="62", '1'="68", '6'="73", '7'="74", '12'="79")

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',], aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 2, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*",",",~sone[SHM])), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictEnvS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 4, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance")

p1 + p2 + p3

p4 <- ggplot(data=model1predictEnvSxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.03) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmbTemp,
                         aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean,
                             colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=-1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE)) +
  
            
              scale_x_continuous(breaks=seq(0, 4, by=0.4),
                                 sec.axis=sec_axis(~ . ,
                                                   name=expression(paste(UAS~italic(L)[AE]~","~dB)),
                                                   breaks = NULL, labels = NULL)) +
              scale_y_continuous(breaks=seq(-3, 10, by=1)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance") +
              facet_grid(AmbientEnv ~ UASLAEMaxLRSclRnd,
                         labeller=labeller(UASLAEMaxLRSclRnd=facetLabels))

p4

```

### with personal factors

```{r}

model1 <- mABISxTnxEnvLAE1_QSqNatxAtt.GEE <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl + I(UASEvents^-1) +
                                                      UASImpulsSHMAvgMaxLR +
                                                      UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                      AmbientEnv*UASTonLdECMAPowAvgBin +
                                                      TrialNumberCntScl + AAM_attitude3*NationGeo2,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.84, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxEnvLAE1_QSqNatxAtt.GEE)

# predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
#                            response=stimDataNoAmb$dAnnoyMean,
#                            fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))
# 
# # using ggplot, plot the predicted fit against the responses in predictMeans
# ggplot(data=predictMeans) +
#   theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
#         axis.text=element_text(family = "serif", size=14)) +
#   
#   geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
#   
#   geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
#   
#   scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
#   scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
#   
#   labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvS <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn <- ggeffects::predict_response(model1, terms=c("UASSharpAurISO305ExMaxLR [all]",
                                                                   "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                   "UASLAEMaxLRScl [-11, -5, 1, 6, 7, 12]",
                                                                   "AmbientEnv [all]",
                                                                   "UASEvents [1]"),
                                               margin='marginalmeans', type='fixed', 
                                              vcov=vcov(model1, type="bias-corrected"),
                                            rg.limit = 51840)

model1predictNat <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "NationGeo2 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictAtt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "AAM_attitude3 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNatAtt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "AAM_attitude3 [all]",
                                                                   "NationGeo2 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnvSxTn$UASLAEMaxLRSclRnd <- model1predictEnvSxTn$facet
model1predictEnvSxTn$AmbientEnv <- model1predictEnvSxTn$panel

stimDataNoAmbTemp <- stimDataNoAmb
numbersIn <- stimDataNoAmbTemp$UASLAEMaxLRScl
numberList <- c(-11, -5, 1, 6, 7, 12)
stimDataNoAmbTemp$UASLAEMaxLRSclRnd <- factor(numberSnap(numbersIn, numberList, rangeVal=0.9))
facetLabels <- c('-11'="56", '-5'="62", '1'="68", '6'="73", '7'="74", '12'="79")

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',], aes(x=UASLAEMaxLRScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 2, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*",",",~sone[SHM])), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictEnvS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean, colour=AmbientEnv, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              scale_x_continuous(breaks=seq(0, 4, by=0.2)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance")

p1 + p2 + p3

p4 <- ggplot(data=model1predictEnvSxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.03) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmbTemp,
                         aes(x=UASSharpAurISO305ExMaxLR, y=dAnnoyMean,
                             colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=-1, discrete=FALSE, begin = 0.2, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(italic(T)[N]^"*"~","~sone[SHM])), reverse=TRUE)) +
  
            
              scale_x_continuous(breaks=seq(0, 4, by=0.4),
                                 sec.axis=sec_axis(~ . ,
                                                   name=expression(paste(UAS~italic(L)[AE]~","~dB)),
                                                   breaks = NULL, labels = NULL)) +
              scale_y_continuous(breaks=seq(-3, 10, by=1)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"],",",~acum[A~"|"~`M-G-S`])), y="Mean change in annoyance") +
              facet_grid(AmbientEnv ~ UASLAEMaxLRSclRnd,
                         labeller=labeller(UASLAEMaxLRSclRnd=facetLabels))

p4

p5 <- ggplot(data=model1predictNat) +
              theme(panel.grid = element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255)),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Nat. region", reverse=FALSE),
                     fill=guide_legend(title="Nat. region", reverse=FALSE)) +
  
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p5

p6 <- ggplot(data=model1predictAtt) +
              theme(panel.grid = element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255)),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="AAM attitude", reverse=TRUE),
                     fill=guide_legend(title="AAM attitude", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance")

p6

p7 <- ggplot(data=model1predictNatAtt) +
              theme(panel.grid = element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255)),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dAnnoyMean),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="AAM attitude", reverse=TRUE),
                     fill=guide_legend(title="AAM attitude", reverse=TRUE)) +
            
              
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y="Mean change in annoyance") +
              facet_grid(~ facet)

p7

```

## UAS-env loudness diff

### Initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}
for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ LAELAF50diffScl*I(UASEvents^-1) +
                                 LAELAF50diffScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                 LAELAF50diffScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR*UASFluctOV10ExMaxLR +
                                 LAELAF50diffScl*UASRoughFZ05ExMaxLR*UASSharpAurISO305ExMaxLR*UASImpulsSHMAvgMaxLR +
                                 LAELAF50diffScl*UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                                 maxit=2e3,
                                 data=subjDataNoAmb,
                                 family=gaussian(link='identity'),
                                 id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}


```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dAnnoyance ~ LAELAF50diffScl*I(UASEvents^-1) +
                               LAELAF50diffScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                               LAELAF50diffScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR*UASFluctOV10ExMaxLR +
                               LAELAF50diffScl*UASRoughFZ05ExMaxLR*UASSharpAurISO305ExMaxLR*UASImpulsSHMAvgMaxLR +
                               LAELAF50diffScl*UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                               TrialNumberCntScl,
                               maxit=2e3,
                               data=subjDataNoAmb,
                               family=gaussian(link='identity'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}

model1 <- mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(UASEvents^-1) +
                                                                   LAELAF50diffScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### add curvilinearity to LAELAF50diff

```{r}

model1 <- mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(LAELAF50diffScl^2) +
                                                                   I(UASEvents^-1) +
                                                                   LAELAF50diffScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### omit impulsiveness-sharpness interactions

```{r}

model1 <- mABSxdLAEL50xITnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(UASEvents^-1) +
                                                                   LAELAF50diffScl*UASImpulsSHMAvgMaxLR +
                                                                   LAELAF50diffScl*UASSharpAurISO305ExMaxLR +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### omit impulsiveness-dLAELA50 interaction

```{r}

model1 <- mABSxdLAEL50ITnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(UASEvents^-1) +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   LAELAF50diffScl*UASSharpAurISO305ExMaxLR +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### add sharpness-tonal loudness interaction

```{r}

model1 <- mABISxTnxdLAEL50xS1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(UASEvents^-1) +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   LAELAF50diffScl*UASSharpAurISO305ExMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### include sharpness-tonal loudness interaction and omit tonal loudness-dLAEL50 interaction

```{r}

model1 <- mABISxTndLAEL50xS1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                           LAELAF50diffScl +
                                                           I(UASEvents^-1) +
                                                           UASImpulsSHMAvgMaxLR +
                                                           LAELAF50diffScl*UASSharpAurISO305ExMaxLR +
                                                           UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                           TrialNumberCntScl,
                                                          data=subjDataNoAmb,
                                                          family=gaussian(link='identity'),
                                                          id=ID.,
                                                          corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### omit sharpness-tonal loudness interaction and omit tonal loudness-dLAEL50 interaction

```{r}

model1 <- mABISTndLAEL50xS1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                            LAELAF50diffScl +
                                                            UASTonLdECMAPowAvgBin +
                                                           I(UASEvents^-1) +
                                                           UASImpulsSHMAvgMaxLR +
                                                           LAELAF50diffScl*UASSharpAurISO305ExMaxLR +
                                                           TrialNumberCntScl,
                                                          data=subjDataNoAmb,
                                                          family=gaussian(link='identity'),
                                                          id=ID.,
                                                          corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### include tonal loudness-dLAEL50 interaction, omit sharpness-dLAEL50 interaction

```{r}

model1 <- mABISTnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                            LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                           I(UASEvents^-1) +
                                                           UASImpulsSHMAvgMaxLR +
                                                           UASSharpAurISO305ExMaxLR +
                                                           TrialNumberCntScl,
                                                          data=subjDataNoAmb,
                                                          family=gaussian(link='identity'),
                                                          id=ID.,
                                                          corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### omit impulsiveness-sharpness interactions

```{r}

model1 <- mABISxdLAEL50xTn1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                                   I(UASEvents^-1) +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxdLAEL50xTn1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### Hybrid stepwise-backward model selection for best performing

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABSxdLAEL50ITnxdLAEL501_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### Hybrid stepwise-backward model selection for 2nd best performing

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABISxTnxdLAEL50xS1_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### Hybrid stepwise-backward model selection for 3rd best performing

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABISTnxdLAEL501_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}

model1 <- mABISxTnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-1) +
                                                         UASImpulsSHMAvgMaxLR +
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         TrialNumberCntScl,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### add events-dLAEL50 interaction

```{r}

model1 <- mABISxTnxdLAEL50x1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ LAELAF50diffScl*I(UASEvents^-1) +
                                                                   LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### dLAEL50 curvilinearity

```{r}

model1 <- mABISxTnxdLAEL5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) +
                                                                  LAELAF50diffScl +
                                                                   I(LAELAF50diffScl^2)*UASTonLdECMAPowAvgBin +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE, mABISxTnxdLAEL5021_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### dLAEL50 curvilinearity, no interaction with tonal loudness

```{r}

model1 <- mABISxTndLAEL5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) +
                                                                  LAELAF50diffScl +
                                                                   I(LAELAF50diffScl^2) +
                                                                    UASTonLdECMAPowAvgBin +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE, mABISxTnxdLAEL5021_QSq.GEE,
                    mABISxTndLAEL5021_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### dLAEL50 curvilinearity, linear interaction with tonal loudness

```{r}

model1 <- mABLAEL502ISxTnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) +
                                                                  LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(LAELAF50diffScl^2) +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE, mABISxTnxdLAEL5021_QSq.GEE,
                    mABISxTndLAEL5021_QSq.GEE, mABLAEL502ISxTnxdLAEL501_QSq.GEE)


predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### dLAEL50 curvilinearity, linear interaction with tonal loudness

```{r}

model1 <- mABIdLAEL502xTnxS1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) +
                                                                  LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                                   I(LAELAF50diffScl^2)*UASTonLdECMAPowAvgBin +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE, mABISxTnxdLAEL5021_QSq.GEE,
                    mABISxTndLAEL5021_QSq.GEE, mABLAEL502ISxTnxdLAEL501_QSq.GEE,
                    mABIdLAEL502xTnxS1_QSq.GEE)


predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### dLAEL50 curvilinearity, no sharpness interaction with tonal loudness

```{r}

model1 <- mABISTndLAEL5021_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) +
                                                                  LAELAF50diffScl +
                                                                   I(LAELAF50diffScl^2) +
                                                                    UASTonLdECMAPowAvgBin +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE, mABISxTnxdLAEL5021_QSq.GEE,
                    mABISxTndLAEL5021_QSq.GEE, mABLAEL502ISxTnxdLAEL501_QSq.GEE,
                    mABIdLAEL502xTnxS1_QSq.GEE, mABISTndLAEL5021_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### dLAEL50 curvilinearity, no sharpness interaction with tonal loudness

```{r}

model1 <- mABISxTndLAEL502x1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1)*I(LAELAF50diffScl^2) +
                                                                  LAELAF50diffScl +
                                                                    UASTonLdECMAPowAvgBin +
                                                                   UASImpulsSHMAvgMaxLR +
                                                                   UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                                   TrialNumberCntScl,
                                                                  data=subjDataNoAmb,
                                                                  family=gaussian(link='identity'),
                                                                  id=ID.,
                                                                  corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABIxdLAEL50xSxTnxdLAEL501_QSq.GEE,
                    mABIxdLAEL502xSxTnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50xITnxdLAEL501_QSq.GEE,
                    mABSxdLAEL50ITnxdLAEL501_QSq.GEE, mABISxTnxdLAEL50xS1_QSq.GEE,
                    mABISxTndLAEL50xS1_QSq.GEE, mABISTndLAEL50xS1_QSq.GEE,
                    mABISTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABISxTnxdLAEL50x1_QSq.GEE, mABISxTnxdLAEL5021_QSq.GEE,
                    mABISxTndLAEL5021_QSq.GEE, mABLAEL502ISxTnxdLAEL501_QSq.GEE,
                    mABIdLAEL502xTnxS1_QSq.GEE, mABISTndLAEL5021_QSq.GEE,
                    mABISxTndLAEL502x1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [-22:20]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-3, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p1 + p2 + p3

```

### Hybrid stepwise-backward model reselection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABISxTnxdLAEL501_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~
                                 LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                 I(UASEvents^-1) +
                                 UASImpulsSHMAvgMaxLR +
                                 UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                                data=subjDataNoAmb,
                                family=gaussian(link='identity'),
                                id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABISxTnxdLAEL501_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-1) +
                                                         UASImpulsSHMAvgMaxLR +
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         TrialNumberCntScl,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxdLAEL501_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxI <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p4 <- ggplot(data=model1predictLxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASImpulsSHMAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p1 + p2 + p3 + p4

```

### include personal factors

```{r}

model1 <- mABISxTnxdLAEL501_QSqAttNatAoR.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                         LAELAF50diffScl*UASTonLdECMAPowAvgBin +
                                                         I(UASEvents^-1) +
                                                         UASImpulsSHMAvgMaxLR +
                                                         UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                                         TrialNumberCntScl + AAM_attitude2 +
                                                           NationGeo2 + Home_Area2,
                                                        data=subjDataNoAmb,
                                                        family=gaussian(link='identity'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxdLAEL501_QSq.GEE, mABISxTnxdLAEL501_QSqAttNatAoR.GEE)

# predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
#                            response=stimDataNoAmb$dAnnoyMean,
#                            fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl),
#                                      AAM_attitude2='Ambiv_Concern_Neutral',
#                                      NationGeo2='UK',
#                                      Home_Area2='Urban'))
# 
# # using ggplot, plot the predicted fit against the responses in predictMeans
# ggplot(data=predictMeans) +
#   theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
#         axis.text=element_text(family = "serif", size=14)) +
#   
#   geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
#   
#   geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
#   
#   scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
#   scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
#   
#   labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.2:3, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxI <- ggeffects::predict_response(model1, terms=c("LAELAF50diffScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASSharpAurISO305ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p4 <- ggplot(data=model1predictLxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAF50diffScl, y=dAnnoyMean, colour=UASImpulsSHMAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              # scale_x_continuous(breaks=seq(0, 40, by=10)) +
              rescaleTicks(stimDataNoAmb$LAELAF50diff,
                             stimDataNoAmb$LAELAF50diffScl, sep=5) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-2, 8)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[AF50],",",~dB)), y="Mean change in annoyance")


p1 + p2 + p3 + p4

```

## UAS detectability

### Initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}
for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*I(UASEvents^-1) +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR*UASFluctOV10ExMaxLR +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASRoughFZ05ExMaxLR*UASSharpAurISO305ExMaxLR*UASImpulsSHMAvgMaxLR +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                                 maxit=2e3,
                                 data=subjDataNoAmb,
                                 family=gaussian(link='identity'),
                                 id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*I(UASEvents^-1) +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR*UASFluctOV10ExMaxLR +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASRoughFZ05ExMaxLR*UASSharpAurISO305ExMaxLR*UASImpulsSHMAvgMaxLR +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR*UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                               maxit=2e3,
                               data=subjDataNoAmb,
                               family=gaussian(link='identity'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

```{r}

test <- glmtoolbox::glmgee(dAnnoyance ~ UASLAEMaxLRScl + Detect0p5IntMaxLRLogScl + I(UASEvents^-1) + UASFluctOV10ExMaxLR + UASTonLdECMAPowAvgBin + UASImpulsSHMAvgMaxLR + UASSharpAurISO305ExMaxLR + UASRoughFZ05ExMaxLR + TrialNumberCntScl + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl + UASLAEMaxLRScl:UASFluctOV10ExMaxLR + Detect0p5IntMaxLRLogScl:UASFluctOV10ExMaxLR + UASLAEMaxLRScl:UASTonLdECMAPowAvgBin + Detect0p5IntMaxLRLogScl:UASTonLdECMAPowAvgBin + UASFluctOV10ExMaxLR:UASTonLdECMAPowAvgBin + UASLAEMaxLRScl:UASImpulsSHMAvgMaxLR + Detect0p5IntMaxLRLogScl:UASImpulsSHMAvgMaxLR + 
    UASLAEMaxLRScl:UASSharpAurISO305ExMaxLR + Detect0p5IntMaxLRLogScl:UASSharpAurISO305ExMaxLR + UASImpulsSHMAvgMaxLR:UASSharpAurISO305ExMaxLR + UASFluctOV10ExMaxLR:UASImpulsSHMAvgMaxLR + UASFluctOV10ExMaxLR:UASSharpAurISO305ExMaxLR + UASLAEMaxLRScl:UASRoughFZ05ExMaxLR + Detect0p5IntMaxLRLogScl:UASRoughFZ05ExMaxLR + UASSharpAurISO305ExMaxLR:UASRoughFZ05ExMaxLR + UASTonLdECMAPowAvgBin:UASSharpAurISO305ExMaxLR + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl:UASFluctOV10ExMaxLR + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl:UASTonLdECMAPowAvgBin + 
    UASLAEMaxLRScl:UASFluctOV10ExMaxLR:UASTonLdECMAPowAvgBin + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl:UASImpulsSHMAvgMaxLR + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl:UASSharpAurISO305ExMaxLR + UASLAEMaxLRScl:UASImpulsSHMAvgMaxLR:UASSharpAurISO305ExMaxLR + Detect0p5IntMaxLRLogScl:UASImpulsSHMAvgMaxLR:UASSharpAurISO305ExMaxLR + UASLAEMaxLRScl:UASFluctOV10ExMaxLR:UASImpulsSHMAvgMaxLR + Detect0p5IntMaxLRLogScl:UASFluctOV10ExMaxLR:UASImpulsSHMAvgMaxLR + Detect0p5IntMaxLRLogScl:UASFluctOV10ExMaxLR:UASSharpAurISO305ExMaxLR + 
    UASFluctOV10ExMaxLR:UASImpulsSHMAvgMaxLR:UASSharpAurISO305ExMaxLR + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl:UASRoughFZ05ExMaxLR + UASLAEMaxLRScl:UASSharpAurISO305ExMaxLR:UASRoughFZ05ExMaxLR + UASLAEMaxLRScl:UASTonLdECMAPowAvgBin:UASSharpAurISO305ExMaxLR + UASLAEMaxLRScl:Detect0p5IntMaxLRLogScl:UASFluctOV10ExMaxLR:UASImpulsSHMAvgMaxLR + Detect0p5IntMaxLRLogScl:UASFluctOV10ExMaxLR:UASImpulsSHMAvgMaxLR:UASSharpAurISO305ExMaxLR,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeModelPerformance(test)

```
### fit stepwise-selected model

```{r}

model1 <- mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASRoughFZ05ExMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR*UASRoughFZ05ExMaxLR + 
                                                               UASLAEMaxLRScl*UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASRoughFZ05ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASImpulsSHMAvgMaxLR +
                                                               UASImpulsSHMAvgMaxLR*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxTn <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog,
                           stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog,
                           stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-3, 7)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASTonLdECMAPowAvgBin,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog,
                           stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1), limits=c(-3, 7)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p1 + p2 + p3

```

### add curvilinear detectability

```{r}

model1 <- mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASRoughFZ05ExMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR*UASRoughFZ05ExMaxLR + 
                                                               UASLAEMaxLRScl*UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASRoughFZ05ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASImpulsSHMAvgMaxLR +
                                                               UASImpulsSHMAvgMaxLR*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxTn <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog,
                           stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog,
                           stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASTonLdECMAPowAvgBin,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog,
                           stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p1 + p2 + p3


```

### omit roughness

```{r}

model1 <- mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                            I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASImpulsSHMAvgMaxLR +
                                                               UASImpulsSHMAvgMaxLR*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxTn <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASTonLdECMAPowAvgBin,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p1 + p2 + p3


```

### omit impulsiveness

```{r}

model1 <- mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*UASFluctOV10ExMaxLR*UASTonLdECMAPowAvgBin +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR +
                                                               Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxTn <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASTonLdECMAPowAvgBin,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p1 + p2 + p3


```

### omit tonal loudness

```{r}

model1 <- mABLAExDt5ixFxIxSxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASImpulsSHMAvgMaxLR +
                                                               UASImpulsSHMAvgMaxLR*Detect0p5IntMaxLRLogScl*UASFluctOV10ExMaxLR*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxF <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASFluctOV10ExMaxLR [0.1:0.4, by=0.1]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxF) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(F)["10"]~","~vacil[OV])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(F)["10"]~","~vacil[OV])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASFluctOV10ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(F)["10"]~","~vacil[OV])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p4 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3 + p4


```

### omit fluctuation strength

```{r}

model1 <- mABLAExDt5ixIxSxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl*UASImpulsSHMAvgMaxLR +
                                                               UASImpulsSHMAvgMaxLR*Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```



### include curvilinear detectability in interactions

```{r}

model1 <- mABLAExDt5i2xIxSxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~
                                                                 I(UASEvents^-1) + Detect0p5IntMaxLRLogScl +
                                                               UASLAEMaxLRScl*I(Detect0p5IntMaxLRLogScl^2)*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*I(Detect0p5IntMaxLRLogScl^2)*UASImpulsSHMAvgMaxLR +
                                                               UASImpulsSHMAvgMaxLR*I(Detect0p5IntMaxLRLogScl^2)*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
             
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### omit higher order interactions

```{r}

model1 <- mABLAExDt5i2xIxSLAE1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                                I(UASEvents^-1) + Detect0p5IntMaxLRLogScl +
                                                               UASLAEMaxLRScl*I(Detect0p5IntMaxLRLogScl^2) +
                                                                UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                                I(Detect0p5IntMaxLRLogScl^2)*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASImpulsSHMAvgMaxLR +
                                                                UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                                I(Detect0p5IntMaxLRLogScl^2)*UASImpulsSHMAvgMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### Hybrid stepwise-backward reselection with best model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-reselected model

```{r}

model1 <- mABLAExDt5i2xIxS1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                               Detect0p5IntMaxLRLogScl*UASImpulsSHMAvgMaxLR*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```


### omit high order impulsiveness interactions

```{r}

model1 <- mABLAExSxDt5i2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                            Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### substitute 0.1s maximum for 0.5s integrated detectability

```{r}

model1 <- mABLAExSxDt1m2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p1MaxMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                            Detect0p1MaxMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p1MaxMaxLRLogScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p1MaxMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p1MaxMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p1MaxMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1MaxMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p1MaxMaxLRLog, stimDataNoAmb$Detect0p1MaxMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[max~"0.1s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

             rescaleTicks(stimDataNoAmb$Detect0p1MaxMaxLRLog, stimDataNoAmb$Detect0p1MaxMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1MaxMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[max~"0.1s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1MaxMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p1MaxMaxLRLog, stimDataNoAmb$Detect0p1MaxMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[max~"0.1s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### omit high order impulsiveness interactions and include 2nd order detectability

```{r}

model1 <- mABDt5i2xLAExSxDt5i2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                            Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*I(Detect0p5IntMaxLRLogScl^2) +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### omit sharpness interaction with LAE

```{r}

model1 <- mABDt5i2xLAESxDt5i2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                            Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*I(Detect0p5IntMaxLRLogScl^2) +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### omit LAE

```{r}

model1 <- mABDt5i2SxDt5i2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                            Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```
### add events interaction with detectability^2

```{r}

model1 <- mABDt5i2SxDt5i2x1_QISq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1)*I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                            Detect0p5IntMaxLRLogScl*UASSharpAurISO305ExMaxLR +
                                                               UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```


### omit detectability-sharpness interaction

```{r}

model1 <- mABLAExSDt5i2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```


### add detectability-impulsiveness interaction

```{r}

model1 <- mABLAExSIxDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR*Detect0p5IntMaxLRLogScl +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### omit LAE

```{r}

model1 <- mABISDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                               UASSharpAurISO305ExMaxLR +
                                                               Detect0p5IntMaxLRLogScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### Hybrid stepwise-backward reselection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABLAExSDt5i2I1_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### substitute d-discounted-LAE for LAE and detectability

```{r}

model1 <- mABSxDt5LAE2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(UASDisc0p5LAEMaxLRScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                               UASDisc0p5LAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE,
                    mABSxDt5LAE2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~disc.~italic(L~"'")[AE~","~"0.5s"]~")")),
                   y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~disc.~italic(L~"'")[AE~","~"0.5s"]~")")),
                   y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~disc.~italic(L~"'")[AE~","~"0.5s"])),
                   y="Mean change in annoyance")


p1 + p2 + p3


```


### only d-discounted-LAE

```{r}

model1 <- mABDt5LAE3Sq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASDisc0p5LAEMaxLRScl^3) +
                                                      I(UASDisc0p5LAEMaxLRScl^2) + 
                                                             UASDisc0p5LAEMaxLRScl +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE,
                    mABSxDt5LAE2I1_QSq.GEE,
                    mABDt5LAE3Sq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictdL <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictdL) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~disc.~italic(L~"'")[AE~","~"0.5s"]~")")),
                   y="Mean change in annoyance")

p1


```

### reintroduce tonal loudness

```{r}

model1 <- mABLAExSDt5i2ITn1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                             I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                              UASImpulsSHMAvgMaxLR +
                                                               UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                               UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                             UASTonLdECMAPowAvgBin +
                                                             TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE,
                    mABSxDt5LAE2I1_QSq.GEE,
                    mABDt5LAE3Sq.GEE,
                    mABLAExSDt5i2ITn1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### reintroduce tonal loudness-sharpness interaction

```{r}

model1 <- mABLAExSDt5i2ITnxS1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                       I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                        UASImpulsSHMAvgMaxLR +
                                                         UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                         UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE,
                    mABSxDt5LAE2I1_QSq.GEE,
                    mABDt5LAE3Sq.GEE,
                    mABLAExSDt5i2ITn1_QSq.GEE,
                    mABLAExSDt5i2ITnxS1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### omit LAE-sharpness interaction

```{r}

model1 <- mABISxTnLAExDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                       I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                        UASImpulsSHMAvgMaxLR +
                                                         UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE,
                    mABSxDt5LAE2I1_QSq.GEE,
                    mABDt5LAE3Sq.GEE,
                    mABLAExSDt5i2ITn1_QSq.GEE,
                    mABLAExSDt5i2ITnxS1_QSq.GEE,
                    mABISxTnLAExDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```


### omit LAE

```{r}

model1 <- mABISxTnDt5i21_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ 
                                                       I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                        UASImpulsSHMAvgMaxLR +
                                                         Detect0p5IntMaxLRLogScl +
                                                         UASTonLdECMAPowAvgBin*UASSharpAurISO305ExMaxLR +
                                                       TrialNumberCntScl,
                                                      data=subjDataNoAmb,
                                                      family=gaussian(link='identity'),
                                                      id=ID.,
                                                      corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i1_QSq.GEE,
                    mABLAExDt5ixFxIRxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxSxTnxDt5i21_QSq.GEE,
                    mABLAExDt5ixFxIxSxDt5i21_QSq.GEE,
                    mABLAExDt5ixIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSxDt5i21_QSq.GEE,
                    mABLAExDt5i2xIxSLAE1_QSq.GEE,
                    mABLAExDt5i2xIxS1_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE,
                    mABLAExSxDt1m2I1_QSq.GEE,
                    mABDt5i2xLAExSxDt5i2I1_QSq.GEE,
                    mABDt5i2xLAESxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2I1_QSq.GEE,
                    mABDt5i2SxDt5i2x1_QISq.GEE,
                    mABLAExSDt5i2I1_QSq.GEE,
                    mABLAExSIxDt5i21_QSq.GEE,
                    mABISDt5i21_QSq.GEE,
                    mABSxDt5LAE2I1_QSq.GEE,
                    mABDt5LAE3Sq.GEE,
                    mABLAExSDt5i2ITn1_QSq.GEE,
                    mABLAExSDt5i2ITnxS1_QSq.GEE,
                    mABISxTnLAExDt5i21_QSq.GEE,
                    mABISxTnDt5i21_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

### Hybrid stepwise-backward reselection with best performing model

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABLAExSDt5i2I1_QSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                UASImpulsSHMAvgMaxLR +
                                 UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                 UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                               TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=gaussian(link='identity'),
                              id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABLAExSxDt5i2I1_QSq.GEE <- glmtoolbox::glmgee(dAnnoyance ~ I(UASEvents^-1) + I(Detect0p5IntMaxLRLogScl^2) + 
                                                            UASImpulsSHMAvgMaxLR +
                                                             UASLAEMaxLRScl*UASSharpAurISO305ExMaxLR +
                                                             UASLAEMaxLRScl*Detect0p5IntMaxLRLogScl +
                                                           TrialNumberCntScl,
                                                            data=subjDataNoAmb,
                                                            family=gaussian(link='identity'),
                                                            id=ID.,
                                                            corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=FALSE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABLAExTypeOpxLAExEnv1_QxLAESq.GEE, mABISxTnLAEx1_QSq.GEE,
                    mABISxTnxEnvLAE1_QSq.GEE, mABISxTnxdLAEL501_QSq.GEE,
                    mABLAExSxDt5i2I1_QSq.GEE)

predictMeans <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dAnnoyMean,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictMeans
ggplot(data=predictMeans) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  scale_y_continuous(breaks=seq(-10, 10, by=1), limits=c(-0.5, 9)) +
  
  labs(x="Mean change in annoyance (test)", y="Predicted mean change in annoyance")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxS <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                               "UASSharpAurISO305ExMaxLR [1.6:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDxI <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASImpulsSHMAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=factor(UASEvents),
                                                 shape=factor(UASEvents)),
                          alpha=0.35, size=2) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")

p2 <- ggplot(data=model1predictDxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~`M-G-S`])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASSharpAurISO305ExMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p3 <- ggplot(data=model1predictDxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dAnnoyMean,
                                                 colour=UASImpulsSHMAvgMaxLR,
                                                 shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)[av]~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(-2, 10, by=1)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~"0.5s"]~")")), y="Mean change in annoyance")


p1 + p2 + p3


```

# Change in highly annoyed

## Categorical variables - Parts A & B combined analysis

### Initial working correlation structure selection for maximal model based on information from ANOVA

Non-stationary and unstructured are numerically unstable

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*UASType*UASOperation +
                                 UASLAEMaxLRScl*AmbientEnv +
                                 UASType*UASOperation*AmbientEnv +
                                 UASLAEMaxLRScl*I(UASEvents^-1) +
                                 TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### log(events)


```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*UASType*UASOperation +
                                 UASLAEMaxLRScl*AmbientEnv +
                                 UASType*UASOperation*AmbientEnv +
                                 UASLAEMaxLRScl*I(log10(UASEvents)) +
                                 TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```


### events


```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*UASType*UASOperation +
                                 UASLAEMaxLRScl*AmbientEnv +
                                 UASType*UASOperation*AmbientEnv +
                                 UASLAEMaxLRScl*UASEvents +
                                 TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model with linear events

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*UASType*UASOperation +
                                 UASLAEMaxLRScl*AmbientEnv +
                                 UASType*UASOperation*AmbientEnv +
                                 UASLAEMaxLRScl*UASEvents +
                                 TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr='exchangeable')


```

### Hybrid stepwise-backward model selection with linear events

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```


### fit stepwise-selected model with linear events

```{r}

model1 <- mABdHLAExTypexOpxEnvxLAEQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASEvents +
                                                              UASLAEMaxLRScl*AmbientEnv +
                                                              UASLAEMaxLRScl*UASType*UASOperation +
                                                              UASType*UASOperation*AmbientEnv,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAEQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.55)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.55)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dHighAnnoyProp,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8,
                                  breaks=c(73, 79)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, colour=group),
                          linewidth=0.5, linetype=3, fill=NA, alpha=0.25) +

              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5,
                        linewidth=1, linetype=3) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9), labels=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x="Number of UAS flyover events", y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5

```

### fit selected cov structure model with log(events)

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*UASType*UASOperation +
                                 UASLAEMaxLRScl*AmbientEnv +
                                 UASType*UASOperation*AmbientEnv +
                                 UASLAEMaxLRScl*I(log10(UASEvents)) +
                                 TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr='exchangeable')


```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}

model1 <- mABdHLAExTypexOpxEnvxLAElgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                              UASLAEMaxLRScl*AmbientEnv +
                                                              UASLAEMaxLRScl*UASType*UASOperation +
                                                              UASType*UASOperation*AmbientEnv,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAEQ.GEE, mABdHLAExTypexOpxEnvxLAElgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


# fit 1/Q model

mABdHLAExTypexOpxEnvxLAE1_Q.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(UASEvents^-1) +
                                                              UASLAEMaxLRScl*AmbientEnv +
                                                              UASLAEMaxLRScl*UASType*UASOperation +
                                                              UASType*UASOperation*AmbientEnv,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

model1predictEvt2CopyOver <- ggeffects::predict_response(mABdHLAExTypexOpxEnvxLAE1_Q.GEE, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(mABdHLAExTypexOpxEnvxLAE1_Q.GEE, type="bias-corrected"))

model1predictEvt2CopyOver2 <- ggeffects::predict_response(mABdHLAExTypexOpxEnvxLAEQ.GEE, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(mABdHLAExTypexOpxEnvxLAEQ.GEE, type="bias-corrected"))

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dHighAnnoyProp,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8,
                                  breaks=c(73, 79)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(data=model1predictEvt2CopyOver,
                          aes(x=x, ymin=conf.low, ymax=conf.high, fill=group),
                          alpha=0.05) +
  
              geom_ribbon(data=model1predictEvt2CopyOver2,
                          aes(x=x, ymin=conf.low, ymax=conf.high, colour=group),
                          linetype=2, fill=NA, alpha=0.25) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, colour=group),
                          linewidth=0.5, linetype=3, fill=NA, alpha=0.25) +
              
              geom_line(data=model1predictEvt2CopyOver,
                        aes(x=x, y=predicted, colour=group), linewidth=1, alpha=0.5) +
  
              geom_line(data=model1predictEvt2CopyOver2,
                        aes(x=x, y=predicted, colour=group), linewidth=1, linetype=2,
                        alpha=0.5) +
  
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5,
                        linewidth=1, linetype=3) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9), labels=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x="Number of UAS flyover events", y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5

```


Although the linear events model performs better than both the log events and reciprocal events models, it was later found that the SQM-based models performed worse with a linear events term. Moreover, the linear events do not well-fit the events behaviour trend in the data. Therefore, the log events model was selected for the final analysis.


### Hybrid stepwise-forward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### omit env-type-operation and LAE-type-op interactions

```{r}

model1 <- mABdHOpxTypexEnvxLAElgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                              UASLAEMaxLRScl*AmbientEnv +
                                                              UASLAEMaxLRScl*UASType +
                                                              UASLAEMaxLRScl*UASOperation +
                                                                UASType*UASOperation +
                                                              AmbientEnv:UASType +
                                                              AmbientEnv:UASOperation,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)



```

### omit all interactions

```{r}

model1 <- mABdHLAETypeOpEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl + AmbientEnv +
                                                        UASType +
                                                        UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```

### add type-op interaction

```{r}

model1 <- mABdHLAETypexOpEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl + AmbientEnv +
                                                        UASType*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```

### add LAE-env interaction

```{r}

model1 <- mABdHTypexOpLAExEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                        UASType*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE,
                    mABdHTypexOpLAExEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```

### add LAE-op interaction, remove type-op interaction

```{r}

model1 <- mABdHTypeOpxLAExEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                        UASType +
                                                          UASLAEMaxLRScl*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE,
                    mABdHTypexOpLAExEnvlgQ.GEE, mABdHTypeOpxLAExEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```

### add type-env interaction

```{r}

model1 <- mABdHTypexEnvOpxLAExEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                        UASType*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE,
                    mABdHTypexOpLAExEnvlgQ.GEE, mABdHTypeOpxLAExEnvlgQ.GEE,
                    mABdHTypexEnvOpxLAExEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```


### add type-LAE interaction

```{r}

model1 <- mABdHLAExTypexEnvOpxLAExEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                        UASType*AmbientEnv +
                                                          UASType*UASLAEMaxLRScl +
                                                          UASLAEMaxLRScl*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE,
                    mABdHTypexOpLAExEnvlgQ.GEE, mABdHTypeOpxLAExEnvlgQ.GEE,
                    mABdHTypexEnvOpxLAExEnvlgQ.GEE, mABdHLAExTypexEnvOpxLAExEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```

### include type-op, LAE-op and LAE-env interactions only

```{r}

model1 <- mABdHTypexOpxLAExEnvlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation +
                                                        UASType*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE,
                    mABdHTypexOpLAExEnvlgQ.GEE, mABdHTypeOpxLAExEnvlgQ.GEE,
                    mABdHTypexEnvOpxLAExEnvlgQ.GEE, mABdHLAExTypexEnvOpxLAExEnvlgQ.GEE,
                    mABdHTypexOpxLAExEnvlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```

### add LAE-events interaction

```{r}

model1 <- mABdHTypexOpxLAExEnvlgQxLAE.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation +
                                                        UASType*UASOperation,
                                                        data=subjDataNoAmb,
                                                        family=binomial(link='logit'),
                                                        id=ID.,
                                                        corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHLAExTypexOpxEnvxLAElgQ.GEE, mABdHOpxTypexEnvxLAElgQ.GEE,
                    mABdHLAETypeOpEnvlgQ.GEE, mABdHLAETypexOpEnvlgQ.GEE,
                    mABdHTypexOpLAExEnvlgQ.GEE, mABdHTypeOpxLAExEnvlgQ.GEE,
                    mABdHTypexEnvOpxLAExEnvlgQ.GEE, mABdHLAExTypexEnvOpxLAExEnvlgQ.GEE,
                    mABdHTypexOpxLAExEnvlgQ.GEE, mABdHTypexOpxLAExEnvlgQxLAE.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


```


### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdHTypexOpxLAExEnvlgQxLAE.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                UASLAEMaxLRScl*AmbientEnv +
                                  UASLAEMaxLRScl*UASOperation +
                                UASType*UASOperation,
                                  data=subjDataNoAmb,
                                  family=binomial(link='logit'),
                                  id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABdHTypexOpxLAExEnvlgQxLAE.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation +
                                                        UASType*UASOperation,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.525)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.525)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


# fit 1/Q model

mABdHTypexOpxLAExEnv1_QxLAE.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*I(UASEvents^-1) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation +
                                                        UASType*UASOperation,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')


model1predictEvt2CopyOver <- ggeffects::predict_response(mABdHTypexOpxLAExEnv1_QxLAE.GEE, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(mABdHTypexOpxLAExEnv1_QxLAE.GEE, type="bias-corrected"))

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dHighAnnoyProp,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8,
                                  breaks=c(73, 79)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(data=model1predictEvt2CopyOver,
                          aes(x=x, ymin=conf.low, ymax=conf.high, fill=group),
                          alpha=0.05) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, colour=group),
                          linewidth=0.5, linetype=3, fill=NA, alpha=0.25) +
              
              geom_line(data=model1predictEvt2CopyOver,
                        aes(x=x, y=predicted, colour=group), linewidth=1, alpha=0.5) +
  
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5,
                        linewidth=1, linetype=3) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9), labels=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x="Number of UAS flyover events", y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5


```

### refit and compare linear events model

```{r}

model1 <- mABdHLAExTypexOpxEnvxLAEQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASEvents +
                                                              UASLAEMaxLRScl*AmbientEnv +
                                                              UASLAEMaxLRScl*UASType*UASOperation +
                                                              UASType*UASOperation*AmbientEnv,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE, mABdHLAExTypexOpxEnvxLAEQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.525)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.525)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


# fit logQ model

mABdHTypexOpxLAExEnvlgQxLAE.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation +
                                                        UASType*UASOperation,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')


model1predictEvt2CopyOver <- ggeffects::predict_response(mABdHTypexOpxLAExEnvlgQxLAE.GEE, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(mABdHTypexOpxLAExEnvlgQxLAE.GEE, type="bias-corrected"))

model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet

p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)

p5 <- ggplot(data=model1predictEvt2) +
              theme(panel.grid = element_blank(), aspect.ratio=0.8,
                    text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[(stimDataNoAmb$AmbientEnv=='Park')
                                            & (stimDataNoAmb$UASOperation=='Flyover')
                                            & (stimDataNoAmb$SessionPart=='B'),],
                         aes(x=UASEvents, y=dHighAnnoyProp,
                             colour=UASLAEMaxLR, shape=UASType),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='inferno', direction=1, discrete=FALSE, begin = 0.2, end = 0.8,
                                  breaks=c(73, 79)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
  
              geom_ribbon(data=model1predictEvt2CopyOver,
                          aes(x=x, ymin=conf.low, ymax=conf.high, fill=group),
                          alpha=0.05) +
  
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, colour=group),
                          linewidth=0.5, linetype=3, fill=NA, alpha=0.25) +
              
              geom_line(data=model1predictEvt2CopyOver,
                        aes(x=x, y=predicted, colour=group), linewidth=1, alpha=0.5) +
  
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5,
                        linewidth=1, linetype=3) +
              
              scale_color_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_fill_viridis(option='inferno', direction=1, discrete=TRUE, begin = 0.2, end = 0.8,
                                         labels=c(73, 79)) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(L)[AE]~","~dB)), reverse=TRUE),
                     shape=guide_legend(title="UAS type"), reverse=FALSE) +
            
              scale_x_continuous(breaks=c(1, 3, 5, 9), labels=c(1, 3, 5, 9)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x="Number of UAS flyover events", y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5


```

### with personal factors

```{r}

model1 <- mABdHTypexOpxLAExEnvlgQxLAEAtt.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl*I(log10(UASEvents)) +
                                                        UASLAEMaxLRScl*AmbientEnv +
                                                          UASLAEMaxLRScl*UASOperation +
                                                        UASType*UASOperation +
                                                          AAM_attitude3,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE, mABdHTypexOpxLAExEnvlgQxLAEAtt.GEE)

# predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
#                            response=stimDataNoAmb$dHighAnnoyProp)
# 
# # using ggplot, plot the predicted fit against the responses in predictProbs
# ggplot(data=predictProbs) +
#   theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
#         axis.text=element_text(family = "serif", size=14)) +
#   
#   geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
#   
#   geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
#   
#   scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
#   scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
#   
#   labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictTypePk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "UASType [all]",
                                                                   "UASEvents [1]",
                                                                   "AmbientEnv [Park]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                               vcov=vcov(model1, type="bias-corrected"))

model1predictOpPk <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "UASEvents [1]",
                                                                 "AmbientEnv [Park]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                 "UASType [all]",
                                                                 "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                 margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictOp <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                               "UASOperation [all]",
                                                               "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                                margin='marginalmeans',
                                                 type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "AmbientEnv [all]",
                                                                "UASEvents [1]"),
                                                margin='marginalmeans',
                                                type='fixed',
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]",
                                                                "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictEvt2 <- ggeffects::predict_response(model1, terms=c("UASEvents [all]",
                                                                 "UASLAEMaxLRScl [7, 13]",
                                                                 "AmbientEnv [Park]",
                                                                 "UASOperation [Flyover]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictType$AmbientEnv <- model1predictType$facet
model1predictOp$AmbientEnv <- model1predictOp$facet


# model1predictNat <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
#                                                                    "NationGeo2 [all]"),
#                                              margin='marginalmeans', type='fixed', 
#                                             vcov=vcov(model1, type="bias-corrected"))

model1predictAtt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
                                                                   "AAM_attitude3 [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

# model1predictNatAtt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [-12:13]",
#                                                                    "AAM_attitude3 [all]",
#                                                                    "NationGeo2 [all]"),
#                                              margin='marginalmeans', type='fixed', 
#                                             vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictType) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASType, shape=UASType),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='plasma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS type", reverse=FALSE),
                     fill=guide_legend(title="UAS type", reverse=FALSE),
                     shape=guide_legend(title="UAS type", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p2 <- ggplot(data=model1predictOp) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=UASOperation, shape=UASOperation),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='mako', discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(9, 6, 2)) +
              
              guides(colour=guide_legend(title="UAS operation", reverse=TRUE),
                     fill=guide_legend(title="UAS operation", reverse=TRUE),
                     shape=guide_legend(title="UAS operation", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
              facet_grid(rows = vars(AmbientEnv))

p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14),
                    axis.title.x=element_blank(),
                    axis.text.x=element_blank(),
                    axis.ticks.x=element_blank()) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.7) +
              scale_shape_manual(values=c(1, 3)) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=FALSE),
                     fill=guide_legend(title="Amb. env.", reverse=FALSE),
                     shape=guide_legend(title="Amb. env.", reverse=FALSE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb[stimDataNoAmb$AmbientEnv=='Park',],
                         aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


(p1 | p2) + (p3 / p4)


# p6 <- ggplot(data=model1predictNat) +
#               theme(panel.grid = element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255)),
#                     aspect.ratio=1.35, text = element_text(family = "serif", size=16),
#                     axis.text=element_text(family = "serif", size=14)) +
#               
#               # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp),
#               #            alpha=0.35, size=2) +
#               
#               geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
#               
#               geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
#               
#               scale_color_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
#               scale_fill_viridis(option='plasma', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
#               
#               guides(colour=guide_legend(title="Nat. region", reverse=FALSE),
#                      fill=guide_legend(title="Nat. region", reverse=FALSE)) +
#   
#               rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
#                              stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
#               scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
#               
#               labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))
# 
# p6

p7 <- ggplot(data=model1predictAtt) +
              theme(panel.grid = element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255)),
                    aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp),
              #            alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
              
              geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="AAM attitude", reverse=TRUE),
                     fill=guide_legend(title="AAM attitude", reverse=TRUE)) +
            
              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p7
# 
# p8 <- ggplot(data=model1predictNatAtt) +
#               theme(panel.grid = element_line(color = rgb(235, 235, 235, 90, maxColorValue = 255)),
#                     aspect.ratio=1.35, text = element_text(family = "serif", size=16),
#                     axis.text=element_text(family = "serif", size=14)) +
#               
#               # geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp),
#               #            alpha=0.35, size=2) +
#               
#               geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.1) +
#               
#               geom_line(aes(x=x, y=predicted, colour=group), linewidth=1) +
#               
#               scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
#               scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
#               
#               guides(colour=guide_legend(title="AAM attitude", reverse=TRUE),
#                      fill=guide_legend(title="AAM attitude", reverse=TRUE)) +
#             
#               
#               rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
#                              stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
#               scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 1)) +
#               
#               labs(x=expression(paste(UAS~italic(L)[AE],",",~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]))) +
#               facet_grid(~ facet)
# 
# p8


```

## UAS info only

### initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                   UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurSHM05ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMPowAvgMaxLR +
                                   UASLoudECMAPowAvgBin:UASFluctOV10ExMaxLR +
                                   UASLoudECMAPowAvgBin:UASImpulsSHMPowAvgMaxLR +
                                   UASLoudECMAPowAvgBin:UASRoughFZ05ExMaxLR +
                                   UASLoudECMAPowAvgBin:UASSharpAurSHM05ExMaxLR +
                                   UASLoudECMAPowAvgBin:UASTonLdECMAPowAvgBin +
                                   TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurSHM05ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASFluctOV10ExMaxLR +
                               UASLoudECMAPowAvgBin:UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASRoughFZ05ExMaxLR +
                               UASLoudECMAPowAvgBin:UASSharpAurSHM05ExMaxLR +
                               UASLoudECMAPowAvgBin:UASTonLdECMAPowAvgBin +
                               TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}


model1 <- mABdHNxFxRxSxTnxIxNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASFluctOV10ExMaxLR*UASSharpAurSHM05ExMaxLR*UASRoughFZ05ExMaxLR*UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASFluctOV10ExMaxLR +
                               UASLoudECMAPowAvgBin:UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASRoughFZ05ExMaxLR +
                               UASLoudECMAPowAvgBin:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$HighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### Hybrid stepwise-forward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='forward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}


model1 <- mABdHFxIxTnxNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                  UASFluctOV10ExMaxLR*UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxF <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASFluctOV10ExMaxLR [0.1:0.4, by=0.1]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxF) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(F)["10"]~","~acum[OV])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(F)["10"]~","~acum[OV])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +

              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=HighAnnoyProp, colour=UASFluctOV10ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(F)["10"]~","~acum[OV])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=HighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p1 + p2 + p3


```

### omit roughness and fluctuation strength from backwards-selected model

```{r}


model1 <- mABdHNxIxSxTnxNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR*UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.25:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```


### omit impulsiveness interactions

```{r}


model1 <- mABdHISxTnxNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                               UASLoudECMAPowAvgBin:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.25:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### omit loudness interactions

```{r}


model1 <- mABdHISxTnNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.25:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### add trial sequence

```{r}


model1 <- mABdHISxTnNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.25:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### loudness, events and trial sequence only

```{r}


model1 <- mABdHNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1


```

### LAE, events and trial sequence only

```{r}


model1 <- mABdHLAElgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLAEMaxLRScl +
                                                     I(log10(UASEvents)) +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLAEMaxLRScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLAEMaxLRScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$UASLAEMaxLR,
                             stimDataNoAmb$UASLAEMaxLRScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~","~dB)), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1


```

### omit tonal loudness

```{r}


model1 <- mABdHISNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE, mABdHISNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.25:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))



p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3



```


### substitute loudness for tonal loudness

```{r}


model1 <- mABdHISxTnlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASTonLdECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                 UASImpulsSHMPowAvgMaxLR,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE, mABdHISNlgQ.GEE,
                    mABdHISxTnlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxI <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.25:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p2 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictTnxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p1 + p2 + p3



```

### omit impulsiveness

```{r}


model1 <- mABdHSxTnlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASTonLdECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE, mABdHISNlgQ.GEE,
                    mABdHISxTnlgQ.GEE, mABdHSxTnlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p2 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p1 + p2



```

### Reintroduce loudness

```{r}


model1 <- mABdHSxTnNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE, mABdHISNlgQ.GEE,
                    mABdHISxTnlgQ.GEE, mABdHSxTnlgQ.GEE,
                    mABdHSxTnNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p2 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p1 + p2


```

### add trial sequence to best model

```{r}


model1 <- mABdHSxTnNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                   UASTonLdECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')


geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE, mABdHISNlgQ.GEE,
                    mABdHISxTnlgQ.GEE, mABdHSxTnlgQ.GEE,
                    mABdHSxTnNlgQ.GEE, mABdHSxTnNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### substitute tonality for tonal loudness

```{r}


model1 <- mABdHSxTNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonalSHMInt05ExMaxLR,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')


geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHNxFxRxSxTnxIxNxlgQ.GEE,
                    mABdHFxIxTnxNlgQ.GEE, mABdHNxIxSxTnxNxlgQ.GEE,
                    mABdHISxTnxNxlgQ.GEE, mABdHISxTnNlgQ.GEE,
                    mABdHISxTnNlgQSq.GEE, mABdHNlgQSq.GEE,
                    mABdHLAElgQSq.GEE, mABdHISNlgQ.GEE,
                    mABdHISxTnlgQ.GEE, mABdHSxTnlgQ.GEE,
                    mABdHSxTnNlgQ.GEE, mABdHSxTnNlgQSq.GEE, mABdHSxTNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxT <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonalSHMInt05ExMaxLR [0.25:1.25, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTxS <- ggeffects::predict_response(model1, terms=c("UASTonalSHMInt05ExMaxLR [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxT) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonalSHMInt05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.25, 1.25, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonalSHMInt05ExMaxLR, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[Sigma~","~5]~","~tu[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdHSxTnNlgQ.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                 UASTonLdECMAPowAvgBin +
                                   I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin,
                                  data=subjDataNoAmb,
                                  family=binomial(link='logit'),
                                  id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}


model1 <- mABdHSxTnNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                     I(log10(UASEvents)) +
                               UASSharpAurSHM05ExMaxLR*UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')


geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE, mABdHSxTnNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))



model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))
p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

## with env class

### initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                   UASLoudECMAPowAvgBin*AmbientEnv +
                                   UASTonLdECMAPowAvgBin*UASSharpAurISO1PowAvgMaxLR*UASImpulsSHMPowAvgMaxLR +
                                   AmbientEnv:UASImpulsSHMPowAvgMaxLR +
                                   AmbientEnv:UASSharpAurISO1PowAvgMaxLR +
                                   AmbientEnv:UASTonLdECMAPowAvgBin +
                                   TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR*UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASSharpAurSHM05ExMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin +
                               TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model with events included

```{r}


model1 <- mABdHEnvxIxSxTnxEnvxNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASTonLdECMAPowAvgBin*UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASSharpAurSHM05ExMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```


### Hybrid stepwise-forward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='forward',
                                       varest='bias-corrected')

```

### fit forward stepwise-selected model

```{r}


model1 <- mABdHIxTnxEnvxNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                                 UASTonLdECMAPowAvgBin*UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5


```

### omit impulsiveness and tonal loudness-env interaction

```{r}


model1 <- mABdHTnEnvxNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                                 UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### omit loudness-env interaction

```{r}


model1 <- mABdHTnEnvNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin + AmbientEnv +
                                 UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### substitute loudness-events interaction for tonal loudness-events

```{r}


model1 <- mABdHEnvNTnxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASTonLdECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin + AmbientEnv,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```


### add loudness-events interaction with tonal loudness-events

```{r}


model1 <- mABdHEnvNxlgQxTn.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASTonLdECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*I(log10(UASEvents)) + AmbientEnv,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```


### swap loudness-events interaction for loudness-env

```{r}


model1 <- mABdHEnvxNTnxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASTonLdECMAPowAvgBin*I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### add sharpness to model omitting env interaction

```{r}


model1 <- mABdHSTnEnvNxlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASTonLdECMAPowAvgBin +
                                                      UASSharpAurSHM05ExMaxLR +
                                                     UASLoudECMAPowAvgBin*I(log10(UASEvents)) +
                                 AmbientEnv,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```


### omit impulsiveness interactions from backward-stepwise-selected model

```{r}


model1 <- mABdHIEnvxSxTnxEnvxNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASSharpAurSHM05ExMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```


### omit env-sharpness interaction

```{r}


model1 <- mABdHISxTnxEnvxNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 AmbientEnv:UASTonLdECMAPowAvgBin,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```

### omit env-tonal loudness interaction

```{r}


model1 <- mABdHISxTnEnvxNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```

### substitute loudness-env interation for env-tonal loudness interaction

```{r}


model1 <- mABdHISxTnxEnvNlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin +
                                   UASTonLdECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp)

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEnvTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p7 <- ggplot(data=model1predictEnvTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.2, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6 + p7


```

### add trial sequence

```{r}


model1 <- mABdHISxTnEnvxNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE, mABdHISxTnEnvxNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```


### omit loudness-env interaction

```{r}


model1 <- mABdHISxTnEnvNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE, mABdHISxTnEnvxNlgQSq.GEE,
                    mABdHISxTnEnvNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```


### omit loudness and impulsiveness, and add tonal loudness-env interaction

```{r}


model1 <- mABdHSxTnxEnvlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                 AmbientEnv*UASTonLdECMAPowAvgBin +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE, mABdHISxTnEnvxNlgQSq.GEE,
                    mABdHISxTnEnvNlgQSq.GEE, mABdHSxTnxEnvlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### omit tonal loudness-env interaction

```{r}


model1 <- mABdHSxTnEnvlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                 AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE, mABdHISxTnEnvxNlgQSq.GEE,
                    mABdHISxTnEnvNlgQSq.GEE, mABdHSxTnxEnvlgQSq.GEE,
                    mABdHSxTnEnvlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxS <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictTnxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```


### omit sharpness (tonal loudness only with events, env and seq)

```{r}


model1 <- mABdHTnEnvlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                 AmbientEnv +
                               UASTonLdECMAPowAvgBin +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE, mABdHISxTnEnvxNlgQSq.GEE,
                    mABdHISxTnEnvNlgQSq.GEE, mABdHSxTnxEnvlgQSq.GEE,
                    mABdHSxTnEnvlgQSq.GEE, mABdHTnEnvlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p2 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2


```


### omit impulsiveness from best model

```{r}

model1 <- mABdHSxTnEnvxNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHEnvxIxSxTnxEnvxNlgQ.GEE, mABdHIxTnxEnvxNxlgQ.GEE,
                    mABdHTnEnvxNxlgQ.GEE, mABdHTnEnvNxlgQ.GEE, mABdHEnvNTnxlgQ.GEE,
                    mABdHEnvNxlgQxTn.GEE, mABdHEnvxNTnxlgQ.GEE, mABdHSTnEnvNxlgQ.GEE,
                    mABdHIEnvxSxTnxEnvxNlgQ.GEE,
                    mABdHISxTnxEnvxNlgQ.GEE, mABdHISxTnEnvxNlgQ.GEE,
                    mABdHISxTnxEnvNlgQ.GEE, mABdHISxTnEnvxNlgQSq.GEE,
                    mABdHISxTnEnvNlgQSq.GEE, mABdHSxTnxEnvlgQSq.GEE,
                    mABdHSxTnEnvlgQSq.GEE, mABdHTnEnvlgQSq.GEE,
                    mABdHSxTnEnvxNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")), y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5


```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdHISxTnEnvxNlgQSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                 I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 TrialNumberCntScl,
                                  data=subjDataNoAmb,
                                  family=binomial(link='logit'),
                                  id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}


model1 <- mABdHISxTnEnvxNlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASLoudECMAPowAvgBin +
                                                               I(log10(UASEvents)) +
                                 UASLoudECMAPowAvgBin*AmbientEnv +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                 UASImpulsSHMPowAvgMaxLR +
                                 TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE, mABdHSxTnNlgQ.GEE,
                    mABdHISxTnEnvxNlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEnv <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "AmbientEnv [all]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                "UASEvents [all]",
                                                                "AmbientEnv [Park]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxS <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxTn <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictNxI <- ggeffects::predict_response(model1, terms=c("UASLoudECMAPowAvgBin [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictNxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)[italic("5")]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictNxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictNxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p6 <- ggplot(data=model1predictEnv) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASLoudECMAPowAvgBin, y=dHighAnnoyProp, colour=AmbientEnv, shape=AmbientEnv),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(1, 3)) +
              scale_color_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='magma', direction=-1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Amb. env.", reverse=TRUE),
                     fill=guide_legend(title="Amb. env.", reverse=TRUE),
                     shape=guide_legend(title="Amb. env.", reverse=TRUE)) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(N)^"*"~","~sone[SHM])), y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5 + p6


```

## UAS-env loudness diff

### initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAeqdiffScl*I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                               LAELAeqdiffScl*UASImpulsSHMPowAvgMaxLR +
                               LAELAeqdiffScl:UASSharpAurSHM05ExMaxLR +
                               LAELAeqdiffScl:UASTonLdECMAPowAvgBin +
                               TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ LAELAeqdiffScl*I(log10(UASEvents)) +
                               UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                               LAELAeqdiffScl*UASImpulsSHMPowAvgMaxLR +
                               LAELAeqdiffScl:UASSharpAurSHM05ExMaxLR +
                               LAELAeqdiffScl:UASTonLdECMAPowAvgBin +
                               TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}


model1 <- mABdHISxTnxdLAELAeqxlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents))*LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                   LAELAeqdiffScl*UASSharpAurSHM05ExMaxLR +
                                                                   LAELAeqdiffScl*UASTonLdECMAPowAvgBin +
                                                                 UASImpulsSHMPowAvgMaxLR +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHISxTnxdLAELAeqxlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxI <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictLxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5


```

### omit LAE SQM interactions

```{r}


model1 <- mABdHISxTndLAELAeqxlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents))*LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                 UASImpulsSHMPowAvgMaxLR +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHISxTnxdLAELAeqxlgQSq.GEE,
                    mABdHISxTndLAELAeqxlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxI <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictLxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5


```

### add LAE curvilinearity

```{r}

model1 <- mABdHISxTndLAELAeq2xlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents))*LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                I(LAELAeqdiffScl^2) +
                                                                 UASImpulsSHMPowAvgMaxLR +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHISxTnxdLAELAeqxlgQSq.GEE,
                    mABdHISxTndLAELAeqxlgQSq.GEE, mABdHISxTndLAELAeq2xlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxI <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictLxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5


```

### omit events interaction

```{r}

model1 <- mABdHISxTndLAELAeq2lgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) + LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                I(LAELAeqdiffScl^2) +
                                                                 UASImpulsSHMPowAvgMaxLR +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHISxTnxdLAELAeqxlgQSq.GEE,
                    mABdHISxTndLAELAeqxlgQSq.GEE, mABdHISxTndLAELAeq2xlgQSq.GEE,
                    mABdHISxTndLAELAeq2lgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxI <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASImpulsSHMPowAvgMaxLR [0.15:0.35, by=0.05]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictLxI) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASImpulsSHMPowAvgMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(I)^"*"~","~iu[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p5 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4 + p5


```

### omit impulsiveness

```{r}

model1 <- mABdHSxTndLAELAeq2lgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) + LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                I(LAELAeqdiffScl^2) +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHISxTnxdLAELAeqxlgQSq.GEE,
                    mABdHISxTndLAELAeqxlgQSq.GEE, mABdHISxTndLAELAeq2xlgQSq.GEE,
                    mABdHISxTndLAELAeq2lgQSq.GEE, mABdHSxTndLAELAeq2lgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))



p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### omit curvilinearity

```{r}

model1 <- mABdHSxTndLAELAeqlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) + LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHISxTnxdLAELAeqxlgQSq.GEE,
                    mABdHISxTndLAELAeqxlgQSq.GEE, mABdHISxTndLAELAeq2xlgQSq.GEE,
                    mABdHISxTndLAELAeq2lgQSq.GEE, mABdHSxTndLAELAeq2lgQSq.GEE,
                    mABdHSxTndLAELAeqlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))



p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

### Hybrid stepwise-backward model reselection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdHSxTndLAELAeq2lgQSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) + LAELAeqdiffScl +
                                 UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                              I(LAELAeqdiffScl^2) +
                                 TrialNumberCntScl,
                            data=subjDataNoAmb,
                            family=binomial(link='logit'),
                            id=ID.,
                            corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABdHSxTndLAELAeq2lgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) + LAELAeqdiffScl +
                                                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                                I(LAELAeqdiffScl^2) +
                                                                   TrialNumberCntScl,
                                                              data=subjDataNoAmb,
                                                              family=binomial(link='logit'),
                                                              id=ID.,
                                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE, mABdHSxTnNlgQ.GEE,
                    mABdHISxTnEnvxNlgQSq.GEE, mABdHSxTndLAELAeq2lgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.5)) +
  
  labs(x=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb]~"("~test~")")),
       y=expression(paste(Predicted~"%"~highly~annoyed~"|"~HA~"'"[amb])))


model1predictEvt <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxS <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                               "UASSharpAurSHM05ExMaxLR [1.2:2.8, by=0.4]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictLxTn <- ggeffects::predict_response(model1, terms=c("LAELAeqdiffScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTn <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "UASEvents [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictLxS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
            
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(1.2, 2.8, by=0.4)) +

              guides(colour=guide_legend(title=expression(paste(UAS~italic(S)["5"]~","~acum[A~"|"~SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +  

              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASSharpAurSHM05ExMaxLR, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p3 <- ggplot(data=model1predictLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=LAELAeqdiffScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$LAELAeqdiff,
                             stimDataNoAmb$LAELAeqdiffScl, sep=5) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L)[AE]~-~amb.~env.~italic(L)[Aeq]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))


p4 <- ggplot(data=model1predictTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=factor(UASEvents), shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="UAS events", reverse=TRUE),
                     fill=guide_legend(title="UAS events", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              scale_x_continuous(breaks=seq(0.5, 1.5, by=0.25)) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4

```

## UAS detectability

### initial working correlation structure selection for maximal model based on information from random forest analysis and SQM data

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASDisc0p5LAEMaxLRScl*I(log10(UASEvents)) +
                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                    UASDisc0p5LAEMaxLRScl*UASImpulsSHMPowAvgMaxLR +
                                    UASDisc0p5LAEMaxLRScl*UASSharpAurSHM05ExMaxLR +
                                    UASDisc0p5LAEMaxLRScl*UASTonLdECMAPowAvgBin +
                                 UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl +
                                   TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ UASDisc0p5LAEMaxLRScl*I(log10(UASEvents)) +
                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                    UASDisc0p5LAEMaxLRScl*UASImpulsSHMPowAvgMaxLR +
                                    UASDisc0p5LAEMaxLRScl*UASSharpAurSHM05ExMaxLR +
                                    UASDisc0p5LAEMaxLRScl*UASTonLdECMAPowAvgBin +
                                 UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl +
                                   TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model selection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model, with events

```{r}


model1 <- mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASDisc0p5LAEMaxLRScl*I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                      UASDisc0p5LAEMaxLRScl*UASImpulsSHMPowAvgMaxLR +
                                                      UASDisc0p5LAEMaxLRScl*UASSharpAurSHM05ExMaxLR +
                                                      UASDisc0p5LAEMaxLRScl*UASTonLdECMAPowAvgBin +
                                                   UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl +
                                                     TrialNumberCntScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```


### omit DLAE-tonal loudness and sharpness interactions

```{r}


model1 <- mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ UASDisc0p5LAEMaxLRScl*I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                      UASDisc0p5LAEMaxLRScl*UASImpulsSHMPowAvgMaxLR +
                                                   UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl +
                                                     TrialNumberCntScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### omit impulsiveness and events interactions

```{r}


model1 <- mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                      UASImpulsSHMPowAvgMaxLR +
                                                   UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl +
                                                     TrialNumberCntScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### omit tonal loudness-sharpness interaction

```{r}

model1 <- mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin +
                                                       UASSharpAurSHM05ExMaxLR +
                                                      UASImpulsSHMPowAvgMaxLR +
                                                   UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl +
                                                     TrialNumberCntScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```


### omit trial number, add DLAE-sharpness interaction

```{r}


model1 <- mABdHDLAE5xSITnDLAE5xIrlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin +
                                                       UASDisc0p5LAEMaxLRScl*UASSharpAurSHM05ExMaxLR +
                                                      UASImpulsSHMPowAvgMaxLR +
                                                   UASDisc0p5LAEMaxLRScl*IntermitRatioC3MaxLRScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### Hybrid stepwise-backward model reselection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-reselected model

```{r}


model1 <- mABdHDLAE5xSTnDLAE5IrlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin +
                                                       UASDisc0p5LAEMaxLRScl*UASSharpAurSHM05ExMaxLR +
                                                   UASDisc0p5LAEMaxLRScl +
                                                     IntermitRatioC3MaxLRScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                    mABdHDLAE5xSTnDLAE5IrlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("UASDisc0p5LAEMaxLRScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASDisc0p5LAEMaxLRScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$UASDisc0p5LAEMaxLR, stimDataNoAmb$UASDisc0p5LAEMaxLRScl, sep=10) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(L~"'")[AE~",0.5s"]~","~dB)),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### substitute DLAE with detectability

```{r}


model1 <- mABdHDt1ixSTnDt1i2IrlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin +
                                                       Detect0p1IntMaxLRLogScl*UASSharpAurSHM05ExMaxLR +
                                                   I(Detect0p1IntMaxLRLogScl^2) +
                                                     IntermitRatioC3MaxLRScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                    mABdHDLAE5xSTnDLAE5IrlgQ.GEE, mABdHDt1ixSTnDt1i2IrlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.5s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.5s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### substitute DLAE with detectability

```{r}


model1 <- mABdHDt5ixSTnDt5i2IrlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     UASTonLdECMAPowAvgBin +
                                                       Detect0p5IntMaxLRLogScl*UASSharpAurSHM05ExMaxLR +
                                                   I(Detect0p5IntMaxLRLogScl^2) +
                                                     IntermitRatioC3MaxLRScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                    mABdHDLAE5xSTnDLAE5IrlgQ.GEE, mABdHDt1ixSTnDt1i2IrlgQ.GEE,
                    mABdHDt5ixSTnDt5i2IrlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("Detect0p5IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p5IntMaxLRLogScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p5IntMaxLRLog, stimDataNoAmb$Detect0p5IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### substitute tonal loudness-sharpness interaction for detectability-sharpness

```{r}


model1 <- mABdHSxTnDt1i2IrlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     Detect0p1IntMaxLRLogScl +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                   I(Detect0p1IntMaxLRLogScl^2) +
                                                     IntermitRatioC3MaxLRScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                    mABdHDLAE5xSTnDLAE5IrlgQ.GEE, mABdHDt1ixSTnDt1i2IrlgQ.GEE,
                    mABdHDt5ixSTnDt5i2IrlgQ.GEE, mABdHSxTnDt1i2IrlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### add impulsiveness

```{r}


model1 <- mABdHISxTnDt1i2IrlgQ.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     Detect0p1IntMaxLRLogScl +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                   I(Detect0p1IntMaxLRLogScl^2) +
                                                     UASImpulsSHMPowAvgMaxLR +
                                                     IntermitRatioC3MaxLRScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                    mABdHDLAE5xSTnDLAE5IrlgQ.GEE, mABdHDt1ixSTnDt1i2IrlgQ.GEE,
                    mABdHDt5ixSTnDt5i2IrlgQ.GEE, mABdHSxTnDt1i2IrlgQ.GEE,
                    mABdHISxTnDt1i2IrlgQ.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### add trial sequence

```{r}


model1 <- mABdHSxTnDt1i2IrlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     Detect0p1IntMaxLRLogScl +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                   I(Detect0p1IntMaxLRLogScl^2) +
                                                     IntermitRatioC3MaxLRScl +
                                                     TrialNumberCntScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHIrxDLAE5xISxTnxDLAE5xlgQSq.GEE,
                    mABdHIrxDLAE5xISxTnDLAE5xlgQSq.GEE,
                    mABdHDLAE5ISxTnDLAE5xIrlgQSq.GEE,
                    mABdHDLAE5ISTnDLAE5xIrlgQSq.GEE, mABdHDLAE5xSITnDLAE5xIrlgQ.GEE,
                    mABdHDLAE5xSTnDLAE5IrlgQ.GEE, mABdHDt1ixSTnDt1i2IrlgQ.GEE,
                    mABdHDt5ixSTnDt5i2IrlgQ.GEE, mABdHSxTnDt1i2IrlgQ.GEE,
                    mABdHISxTnDt1i2IrlgQ.GEE, mABdHSxTnDt1i2IrlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3


```

### Hybrid stepwise-backward model reselection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=mABdHSxTnDt1i2IrlgQSq.GEE,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### refit correlation structure to best performing model

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                 Detect0p1IntMaxLRLogScl +
                                   UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                               I(Detect0p1IntMaxLRLogScl^2) +
                                 IntermitRatioC3MaxLRScl +
                                 TrialNumberCntScl,
                                  data=subjDataNoAmb,
                                  family=binomial(link='logit'),
                                  id=ID.,
                                 corstr=corstr)
  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

}

```

### refit and examine final model

```{r}

model1 <- mABdHSxTnDt1i2IrlgQSq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents)) +
                                                     Detect0p1IntMaxLRLogScl +
                                                       UASTonLdECMAPowAvgBin*UASSharpAurSHM05ExMaxLR +
                                                   I(Detect0p1IntMaxLRLogScl^2) +
                                                     IntermitRatioC3MaxLRScl +
                                                     TrialNumberCntScl,
                                              data=subjDataNoAmb,
                                              family=binomial(link='logit'),
                                              id=ID.,
                                              corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABdHTypexOpxLAExEnvlgQxLAE.GEE, mABdHSxTnNlgQ.GEE,
                    mABdHISxTnEnvxNlgQSq.GEE, mABdHSxTndLAELAeq2lgQSq.GEE,
                    mABdHSxTnDt1i2IrlgQSq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictEvt <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictDLxTn <- ggeffects::predict_response(model1, terms=c("Detect0p1IntMaxLRLogScl [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictTnxIr <- ggeffects::predict_response(model1, terms=c("UASTonLdECMAPowAvgBin [all]",
                                                                 "IntermitRatioC3MaxLRScl [0:0.9, by=0.3]",
                                                                 "UASEvents [1]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

model1predictSxTn <- ggeffects::predict_response(model1, terms=c("UASSharpAurSHM05ExMaxLR [all]",
                                                                 "UASTonLdECMAPowAvgBin [0.5:1.5, by=0.25]",
                                                                 "IntermitRatioC3MaxLRScl [0.5]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))

p1 <- ggplot(data=model1predictEvt) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='viridis', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_shape_manual(values=c(4, 5, 7, 8)) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     shape=guide_legend(title="UAS events", reverse=TRUE)) +

              ggnewscale::new_scale_colour() +
            
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp,
                                                 colour=IntermitRatioC3MaxLRScl, shape=factor(UASEvents)),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='viridis', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +
  
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p2 <- ggplot(data=model1predictDLxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=Detect0p1IntMaxLRLogScl, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              rescaleTicks(stimDataNoAmb$Detect0p1IntMaxLRLog, stimDataNoAmb$Detect0p1IntMaxLRLogScl, sep=1) +
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~lg~"("~italic(d~"'")[Sigma~",0.1s"]~")")),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p3 <- ggplot(data=model1predictTnxIr) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title="Intermit. ratio", reverse=TRUE),
                     fill=guide_legend(title="Intermit. ratio", reverse=TRUE)) +
  
              ggnewscale::new_scale_color() +
              
              geom_point(data=stimDataNoAmb, aes(x=UASTonLdECMAPowAvgBin, y=dHighAnnoyProp, colour=IntermitRatioC3MaxLRScl),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8) +

              guides(colour=guide_legend(title="Intermit. ratio"), reverse=TRUE) +  
              labs(x=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p4 <- ggplot(data=model1predictSxTn) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +

              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high, fill=group), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted, colour=group), alpha=0.5, linewidth=1) +
              
              scale_color_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              scale_fill_viridis(option='mako', direction=1, discrete=TRUE, begin = 0.1, end = 0.8) +
              
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE),
                     fill=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              ggnewscale::new_scale_color() +
  
              geom_point(data=stimDataNoAmb, aes(x=UASSharpAurSHM05ExMaxLR, y=dHighAnnoyProp, colour=UASTonLdECMAPowAvgBin),
                         alpha=0.35, size=2) +
  
              scale_color_viridis(option='mako', direction=1, discrete=FALSE, begin = 0.1, end = 0.8,
                                  breaks=seq(0.5, 1.5, by=0.25)) +
  
              guides(colour=guide_legend(title=expression(paste(UAS~italic(T)[italic(N)]^"*"~","~sone[SHM])), reverse=TRUE)) +
              
              
              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~italic(S)["5"]~acum[A~"|"~SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1 + p2 + p3 + p4


```

## UAS and ambient env difference SQM

### Initial working correlation structure

```{r}

for (corstr in c("Exchangeable", "AR-M-dependent(1)", "Stationary-M-dependent(1)",
                 "Independence")){
  modelMax <- glmtoolbox::glmgee(dHighAnnoy ~ I(log10(UASEvents))*dSharpAurSHMPowAvgMaxLR +
                                   LAELAeqdiff*dSharpAurSHMPowAvgMaxLR +
                                   IntermitRatioC3MaxLRScl +
                                   dSharpAurSHMPowAvgMaxLR*dTonalSHMIntAvgMaxLR +
                                   dRoughFZ05ExMaxLR*dFluctSHM10ExBin +
                                   dImpulsSHMAvgMaxLR +
                                   TrialNumberCntScl,
                                 data=subjDataNoAmb, family=binomial(link='logit'),
                                 id=ID., corstr=corstr)

  print(corstr)
  
  geeModelPerformance(modelMax, verbose=TRUE)

  }

```

### fit selected cov structure model

```{r}

modelMax <- glmtoolbox::glmgee(dHighAnnoy ~  I(log10(UASEvents))*dSharpAurSHMPowAvgMaxLR +
                                   LAELAeqdiff*dSharpAurSHMPowAvgMaxLR +
                                   IntermitRatioC3MaxLRScl +
                                   dSharpAurSHMPowAvgMaxLR*dTonalSHMIntAvgMaxLR +
                                   dRoughFZ05ExMaxLR*dFluctSHM10ExBin +
                                   dImpulsSHMAvgMaxLR +
                                   TrialNumberCntScl,
                              data=subjDataNoAmb,
                              family=binomial(link='logit'),
                              id=ID.,
                              corstr='exchangeable')

```

### Hybrid stepwise-backward model reselection

```{r}

modelStep <- glmtoolbox::stepCriterion(model=modelMax,
                                       criterion='agpc', test='score',
                                       direction='backward',
                                       varest='bias-corrected')

```

### fit stepwise-selected model

```{r}


model1 <- mABdHdLAELAeqxdSxdTndFdISq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ 
                                               LAELAeqdiff*dSharpAurSHMPowAvgMaxLR +
                                               IntermitRatioC3MaxLRScl +
                                               dSharpAurSHMPowAvgMaxLR*dTonalSHMIntAvgMaxLR +
                                               dFluctSHM10ExBin +
                                               dImpulsSHMAvgMaxLR +
                                                 TrialNumberCntScl,
                                                data=subjDataNoAmb,
                                                family=binomial(link='logit'),
                                                id=ID.,
                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypexOpxLAExEnvlgQ.GEE, mABHISxTnNlgQ.GEE,
                    mABHISxTnEnvxNlgQ.GEE, mABdHSxTndLAELAeq2xlgQSq.GEE,
                    mABdHSxTnDt1i2IrlgQSq.GEE, mABdHdLAELAeqxdSxdTndFdISq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictdS <- ggeffects::predict_response(model1, terms=c("dSharpAurSHMPowAvgMaxLR [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictdS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted), alpha=0.5, linewidth=1) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~Delta~italic(S)^"*"~","~Delta~acum[A~"|"~SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1


```

### omit dLAELAeq interaction with dSharp

```{r}


model1 <- mABdHdLAELAeqdSxdTndFdISq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ 
                                               LAELAeqdiff +
                                               IntermitRatioC3MaxLRScl +
                                               dSharpAurSHMPowAvgMaxLR*dTonalSHMIntAvgMaxLR +
                                               dFluctSHM10ExBin +
                                               dImpulsSHMAvgMaxLR +
                                                 TrialNumberCntScl,,
                                                data=subjDataNoAmb,
                                                family=binomial(link='logit'),
                                                id=ID.,
                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypexOpxLAExEnvlgQ.GEE, mABHISxTnNlgQ.GEE,
                    mABHISxTnEnvxNlgQ.GEE, mABdHSxTndLAELAeq2xlgQSq.GEE,
                    mABdHSxTnDt1i2IrlgQSq.GEE, mABdHdLAELAeqxdSxdTndFdISq.GEE,
                    mABdHdLAELAeqdSxdTndFdISq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictdS <- ggeffects::predict_response(model1, terms=c("dSharpAurSHMPowAvgMaxLR [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictdS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted), alpha=0.5, linewidth=1) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~Delta~italic(S)^"*"~","~Delta~acum[A~"|"~SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1


```

### omit dTonality interaction with dSharp

```{r}


model1 <- mABdHdLAELAeqdSdTndFdISq.GEE <- glmtoolbox::glmgee(dHighAnnoy ~ 
                                               LAELAeqdiff +
                                               IntermitRatioC3MaxLRScl +
                                               dSharpAurSHMPowAvgMaxLR + dTonalSHMIntAvgMaxLR +
                                               dFluctSHM10ExBin +
                                               dImpulsSHMAvgMaxLR +
                                                 TrialNumberCntScl,,
                                                data=subjDataNoAmb,
                                                family=binomial(link='logit'),
                                                id=ID.,
                                                corstr='exchangeable')

geeParams(model1, ci=0.843, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)
geeParams(model1, ci=0.95, exponentiate=TRUE, varest='bias-corrected', verbose=FALSE)

geeModelPerformance(mABHTypexOpxLAExEnvlgQ.GEE, mABHISxTnNlgQ.GEE,
                    mABHISxTnEnvxNlgQ.GEE, mABdHSxTndLAELAeq2xlgQSq.GEE,
                    mABdHSxTnDt1i2IrlgQSq.GEE, mABdHdLAELAeqxdSxdTndFdISq.GEE,
                    mABdHdLAELAeqdSxdTndFdISq.GEE, mABdHdLAELAeqdSdTndFdISq.GEE)

predictProbs <- predictNew(model=model1, newData=stimDataNoAmb,
                           response=stimDataNoAmb$dHighAnnoyProp,
                           fixVars=c(TrialNumberCntScl=mean(subjDataNoAmb$TrialNumberCntScl)))

# using ggplot, plot the predicted fit against the responses in predictProbs
ggplot(data=predictProbs) +
  theme(panel.grid = element_blank(), aspect.ratio=1, text=element_text(family = "serif", size=12),
        axis.text=element_text(family = "serif", size=14)) +
  
  geom_point(mapping=aes(x=response, y=fit), size=2.5, shape=1, colour=mycolours[1], alpha=0.5) +
  
  geom_abline(aes(intercept=0, slope=1), colour='grey', alpha=0.5) +
  
  scale_x_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  scale_y_continuous(breaks=seq(0, 1, by=0.1), labels=seq(0, 100, by=10), limits=c(0, 0.7)) +
  
  labs(x="% Highly annoyed (test)", y="Predicted % highly annoyed")


model1predictdS <- ggeffects::predict_response(model1, terms=c("dSharpAurSHMPowAvgMaxLR [all]"),
                                             margin='marginalmeans', type='fixed', 
                                            vcov=vcov(model1, type="bias-corrected"))


p1 <- ggplot(data=model1predictdS) +
              theme(panel.grid = element_blank(), aspect.ratio=1.35, text = element_text(family = "serif", size=16),
                    axis.text=element_text(family = "serif", size=14)) +
              
              geom_point(data=stimDataNoAmb, aes(x=dSharpAurSHMPowAvgMaxLR, y=dHighAnnoyProp),
                         alpha=0.35, size=2) +
              
              geom_ribbon(aes(x=x, ymin=conf.low, ymax=conf.high), alpha=0.05) +
              
              geom_line(aes(x=x, y=predicted), alpha=0.5, linewidth=1) +

              scale_y_continuous(breaks=seq(0, 1, by=0.1), limits=c(0, 1), labels=seq(0, 100, by=10)) +
              
              labs(x=expression(paste(UAS~Delta~italic(S)^"*"~","~Delta~acum[A~"|"~SHM])),
                   y=expression(paste("%"~Highly~annoyed~"|"~HA~"'"[amb])))

p1


```























